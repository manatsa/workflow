import{h as Z}from"./chunk-L5MAMNEM.js";import{b as X,c as Y}from"./chunk-TN4AHATL.js";import"./chunk-HAECDJ4T.js";import{a as K,b as Q}from"./chunk-5IID7QRZ.js";import{b as D,i as z,j as G,l as H,m as J}from"./chunk-QPNPC3UF.js";import{d as q,h as A,l as V,u as O}from"./chunk-PTVBPAL6.js";import{a as F,h as U}from"./chunk-FDHOQCIP.js";import"./chunk-YPEK7DFO.js";import{a as N}from"./chunk-P6EGYZ4O.js";import{a as T,c as P}from"./chunk-7HWBNCDZ.js";import{i as S,p as b,ta as L,u as k,ua as j,wa as B,ya as R,za as W}from"./chunk-SKGZNIDJ.js";import{Cb as p,Fb as E,Mb as i,Nb as t,Ob as h,Sb as x,Wb as g,Xb as s,cb as r,fc as o,gc as I,hb as _,hc as c,jc as C,kc as w,lc as M,oa as d,ob as y,pa as u,ub as v}from"./chunk-2CONVDTD.js";function ee(a,f){a&1&&(i(0,"div",7),h(1,"mat-spinner",8),i(2,"p"),o(3,"Validating your request..."),t()())}function te(a,f){if(a&1){let e=x();i(0,"div",9)(1,"mat-icon",10),o(2,"error"),t(),i(3,"h2"),o(4,"Unable to Process Request"),t(),i(5,"p"),o(6),t(),i(7,"button",11),g("click",function(){d(e);let n=s();return u(n.goToLogin())}),o(8," Go to Login "),t()()}if(a&2){let e=s();r(6),I(e.error)}}function ne(a,f){a&1&&h(0,"mat-spinner",22)}function ie(a,f){a&1&&(i(0,"span"),o(1,"Login & Continue"),t())}function oe(a,f){if(a&1){let e=x();i(0,"div",12)(1,"mat-icon",13),o(2,"lock"),t(),i(3,"h2"),o(4,"Authentication Required"),t(),i(5,"p"),o(6),t(),i(7,"div",14)(8,"p")(9,"strong"),o(10,"Workflow:"),t(),o(11),t(),i(12,"p")(13,"strong"),o(14,"Reference:"),t(),o(15),t(),i(16,"p")(17,"strong"),o(18,"Submitted by:"),t(),o(19),t()(),i(20,"div",15)(21,"mat-form-field",16)(22,"mat-label"),o(23,"Username"),t(),i(24,"input",17),M("ngModelChange",function(n){d(e);let m=s();return w(m.username,n)||(m.username=n),u(n)}),t()(),i(25,"mat-form-field",16)(26,"mat-label"),o(27,"Password"),t(),i(28,"input",18),M("ngModelChange",function(n){d(e);let m=s();return w(m.password,n)||(m.password=n),u(n)}),g("keyup.enter",function(){d(e);let n=s();return u(n.login())}),t()(),i(29,"button",19),g("click",function(){d(e);let n=s();return u(n.login())}),v(30,ne,1,0,"mat-spinner",20)(31,ie,2,0,"span",21),t()()()}if(a&2){let e=s();r(6),c("Please log in to ",e.actionType==="approve"?"approve":"reject"," this request."),r(5),c(" ",e.requestInfo==null?null:e.requestInfo.workflowName,""),r(4),c(" ",e.requestInfo==null?null:e.requestInfo.referenceNumber,""),r(4),c(" ",e.requestInfo==null?null:e.requestInfo.initiatorName,""),r(5),C("ngModel",e.username),r(4),C("ngModel",e.password),r(),p("disabled",e.loginLoading),r(),p("ngIf",e.loginLoading),r(),p("ngIf",!e.loginLoading)}}function re(a,f){if(a&1){let e=x();i(0,"mat-form-field",16)(1,"mat-label"),o(2),t(),i(3,"textarea",28),M("ngModelChange",function(n){d(e);let m=s(2);return w(m.comments,n)||(m.comments=n),u(n)}),t()()}if(a&2){let e=s(2);r(2),c("Comments ",e.actionType==="reject"?"(Required)":"",""),r(),C("ngModel",e.comments)}}function ae(a,f){a&1&&h(0,"mat-spinner",22)}function le(a,f){if(a&1&&(i(0,"span"),o(1),t()),a&2){let e=s(2);r(),c(" ",e.actionType==="approve"?"Confirm Approval":"Confirm Rejection"," ")}}function se(a,f){if(a&1){let e=x();i(0,"div",23)(1,"mat-icon"),o(2),t(),i(3,"h2"),o(4),t(),i(5,"div",14)(6,"p")(7,"strong"),o(8,"Workflow:"),t(),o(9),t(),i(10,"p")(11,"strong"),o(12,"Reference:"),t(),o(13),t(),i(14,"p")(15,"strong"),o(16,"Submitted by:"),t(),o(17),t()(),v(18,re,4,2,"mat-form-field",24),i(19,"div",25)(20,"button",26),g("click",function(){d(e);let n=s();return u(n.cancel())}),o(21,"Cancel"),t(),i(22,"button",27),g("click",function(){d(e);let n=s();return u(n.processAction())}),v(23,ae,1,0,"mat-spinner",20)(24,le,2,1,"span",21),t()()()}if(a&2){let e=s();r(),E(e.actionType==="approve"?"approve-icon":"reject-icon"),r(),c(" ",e.actionType==="approve"?"check_circle":"cancel"," "),r(2),c("",e.actionType==="approve"?"Approve":"Reject"," Request"),r(5),c(" ",e.requestInfo==null?null:e.requestInfo.workflowName,""),r(4),c(" ",e.requestInfo==null?null:e.requestInfo.referenceNumber,""),r(4),c(" ",e.requestInfo==null?null:e.requestInfo.initiatorName,""),r(),p("ngIf",e.actionType==="reject"||e.commentsMandatory),r(4),p("color",e.actionType==="approve"?"primary":"warn")("disabled",e.processing||e.actionType==="reject"&&!e.comments.trim()),r(),p("ngIf",e.processing),r(),p("ngIf",!e.processing)}}function ce(a,f){if(a&1){let e=x();i(0,"div",29)(1,"mat-icon",30),o(2,"check_circle"),t(),i(3,"h2"),o(4),t(),i(5,"p"),o(6),t(),i(7,"button",11),g("click",function(){d(e);let n=s();return u(n.goToDashboard())}),o(8," Go to Dashboard "),t()()}if(a&2){let e=s();r(4),c("",e.actionType==="approve"?"Approved":"Rejected"," Successfully"),r(2),c("The request has been ",e.actionType==="approve"?"approved":"rejected",".")}}var Oe=(()=>{class a{route;router;http;authService;snackBar;loading=!0;error=null;token=null;actionType="view";requestInfo=null;requiresLogin=!1;showConfirmation=!1;success=!1;processing=!1;loginLoading=!1;commentsMandatory=!1;username="";password="";comments="";apiUrl=W.apiUrl;constructor(e,l,n,m,$){this.route=e,this.router=l,this.http=n,this.authService=m,this.snackBar=$}ngOnInit(){this.route.queryParams.subscribe(e=>{if(this.token=e.token,this.actionType=e.action||"view",!this.token){this.error="No token provided",this.loading=!1;return}this.validateToken()})}validateToken(){this.http.get(`${this.apiUrl}/email-approval/validate?token=${this.token}`).subscribe({next:e=>{e.success?(this.requestInfo=e.data,this.loading=!1,this.authService.isAuthenticated?this.showConfirmation=!0:this.requiresLogin=!0):(this.error=e.message||"Invalid token",this.loading=!1)},error:e=>{this.error=e.error?.message||"Failed to validate token",this.loading=!1}})}login(){if(!this.username||!this.password){this.snackBar.open("Please enter username and password","Close",{duration:3e3});return}this.loginLoading=!0,this.authService.login({username:this.username,password:this.password}).subscribe({next:()=>{this.loginLoading=!1,this.requiresLogin=!1,this.showConfirmation=!0},error:e=>{this.loginLoading=!1,this.snackBar.open(e.error?.message||"Login failed","Close",{duration:3e3})}})}processAction(){if(this.actionType==="reject"&&!this.comments?.trim()){this.snackBar.open("Comments are required for rejection","Close",{duration:3e3});return}this.processing=!0;let e=new URLSearchParams;e.set("token",this.token),e.set("action",this.actionType.toUpperCase()),this.comments&&e.set("comments",this.comments),this.http.post(`${this.apiUrl}/email-approval/process?${e.toString()}`,{}).subscribe({next:l=>{this.processing=!1,l.success?(this.success=!0,this.showConfirmation=!1):this.snackBar.open(l.message||"Failed to process","Close",{duration:3e3})},error:l=>{this.processing=!1,this.snackBar.open(l.error?.message||"Failed to process action","Close",{duration:3e3})}})}cancel(){this.router.navigate(["/dashboard"])}goToLogin(){this.router.navigate(["/login"])}goToDashboard(){this.router.navigate(["/dashboard"])}static \u0275fac=function(l){return new(l||a)(_(T),_(P),_(k),_(N),_(X))};static \u0275cmp=y({type:a,selectors:[["app-email-approval"]],decls:7,vars:5,consts:[[1,"email-approval-container"],[1,"approval-card"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","login-required",4,"ngIf"],["class","confirmation-state",4,"ngIf"],["class","success-state",4,"ngIf"],[1,"loading-state"],["diameter","50"],[1,"error-state"],[1,"error-icon"],["mat-raised-button","","color","primary",3,"click"],[1,"login-required"],[1,"info-icon"],[1,"request-info"],[1,"login-form"],["appearance","outline",1,"full-width"],["matInput","","placeholder","Enter your username",3,"ngModelChange","ngModel"],["matInput","","type","password","placeholder","Enter your password",3,"ngModelChange","keyup.enter","ngModel"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20",4,"ngIf"],[4,"ngIf"],["diameter","20"],[1,"confirmation-state"],["appearance","outline","class","full-width",4,"ngIf"],[1,"action-buttons"],["mat-raised-button","",3,"click"],["mat-raised-button","",3,"click","color","disabled"],["matInput","","rows","3","placeholder","Enter your comments...",3,"ngModelChange","ngModel"],[1,"success-state"],[1,"success-icon"]],template:function(l,n){l&1&&(i(0,"div",0)(1,"mat-card",1),v(2,ee,4,0,"div",2)(3,te,9,1,"div",3)(4,oe,32,9,"div",4)(5,se,25,12,"div",5)(6,ce,9,2,"div",6),t()()),l&2&&(r(2),p("ngIf",n.loading),r(),p("ngIf",n.error&&!n.loading),r(),p("ngIf",n.requiresLogin&&!n.loading&&!n.error),r(),p("ngIf",n.showConfirmation&&!n.loading&&!n.error),r(),p("ngIf",n.success&&!n.loading))},dependencies:[b,S,O,q,A,V,U,F,R,B,j,L,Q,K,G,z,D,J,H,Y,Z],styles:[".email-approval-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}.approval-card[_ngcontent-%COMP%]{max-width:500px;width:100%;padding:40px;text-align:center}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .login-required[_ngcontent-%COMP%], .confirmation-state[_ngcontent-%COMP%], .success-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px}.error-icon[_ngcontent-%COMP%], .info-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px}.error-icon[_ngcontent-%COMP%]{color:#f44336}.info-icon[_ngcontent-%COMP%]{color:#1976d2}.approve-icon[_ngcontent-%COMP%]{color:#4caf50;font-size:64px;width:64px;height:64px}.reject-icon[_ngcontent-%COMP%]{color:#f44336;font-size:64px;width:64px;height:64px}.success-icon[_ngcontent-%COMP%]{color:#4caf50;font-size:64px;width:64px;height:64px}.request-info[_ngcontent-%COMP%]{background:#f5f5f5;padding:16px;border-radius:8px;width:100%;text-align:left;margin:16px 0}.request-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0}.login-form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:16px}.full-width[_ngcontent-%COMP%]{width:100%}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:16px;justify-content:center;margin-top:16px}h2[_ngcontent-%COMP%]{margin:0;color:#333}p[_ngcontent-%COMP%]{color:#666;margin:8px 0}mat-spinner[_ngcontent-%COMP%]{margin:0 auto}"]})}return a})();export{Oe as EmailApprovalComponent};
