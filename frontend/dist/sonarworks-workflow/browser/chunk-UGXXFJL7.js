import{a as Et}from"./chunk-EGDSWC2Z.js";import{b as Mt,c as ht,d as St}from"./chunk-PJFAPQP2.js";import{a as U}from"./chunk-3ZFOP54I.js";import{a as at,b as ot,c as lt,d as rt}from"./chunk-FUIEYQGH.js";import{a as nt,b as it}from"./chunk-QSHSHEBT.js";import{b as ct}from"./chunk-WS3LSTPP.js";import{c as tt,h as et}from"./chunk-L5MAMNEM.js";import{b as Y,c as Z}from"./chunk-TN4AHATL.js";import"./chunk-HAECDJ4T.js";import{a as Q,b as X}from"./chunk-5IID7QRZ.js";import"./chunk-QPNPC3UF.js";import"./chunk-PTVBPAL6.js";import{a as dt,b as st,c as _t,d as pt,e as ft,f as ut,g as Ct,h as xt,i as gt,j as vt,k as bt}from"./chunk-6LTOGVZP.js";import{a as G,b as W,c as J,f as K,h as q}from"./chunk-FDHOQCIP.js";import{a as mt}from"./chunk-72SFJ5UH.js";import"./chunk-SPXEAC7E.js";import"./chunk-CRE6EOZT.js";import"./chunk-YPEK7DFO.js";import{a as R,c as F,d as B,g as V}from"./chunk-7HWBNCDZ.js";import{l as A,p as L,ta as N,ua as j,va as H,wa as z,ya as $}from"./chunk-SKGZNIDJ.js";import{Cb as x,Fb as b,Hb as _,Kb as E,Lb as w,Mb as n,Nb as i,Ob as M,Pb as h,Qb as S,Sb as g,Wb as v,Xb as s,cb as l,ec as P,fc as o,gc as m,hb as f,hc as D,ic as y,oa as u,ob as T,pa as C,pc as O,rc as I,tc as k,ub as d}from"./chunk-2CONVDTD.js";var kt=t=>["/approvals",t],Tt=(t,r)=>r.fieldName,wt=(t,r)=>r.id;function Pt(t,r){t&1&&(n(0,"div",2),M(1,"mat-spinner",3),i())}function yt(t,r){if(t&1){let e=g();n(0,"button",25),v("click",function(){u(e);let c=s(2);return C(c.editSubmission())}),n(1,"mat-icon"),o(2,"edit"),i(),n(3,"span"),o(4,"Edit Submission"),i()()}}function Ot(t,r){if(t&1){let e=g();n(0,"button",25),v("click",function(){u(e);let c=s(2);return C(c.deleteSubmission())}),n(1,"mat-icon"),o(2,"delete"),i(),n(3,"span"),o(4,"Delete Submission"),i()()}}function At(t,r){if(t&1&&(n(0,"div",15)(1,"span",16),o(2,"Current Approval Level"),i(),n(3,"span",17),o(4),i()()),t&2){let e=s(2);l(4),D("Level ",e.instance.currentApprovalLevel,"")}}function Lt(t,r){if(t&1&&(n(0,"div",15)(1,"span",16),o(2),i(),n(3,"span",17),o(4),i()()),t&2){let e=r.$implicit;l(2),m(e.fieldLabel),l(2),m(e.value||"-")}}function Rt(t,r){if(t&1&&(M(0,"mat-divider"),n(1,"div",15)(2,"span",16),o(3,"Comments"),i(),n(4,"span",17),o(5),i()()),t&2){let e=s(2);l(5),m(e.instance.comments)}}function Ft(t,r){if(t&1){let e=g();n(0,"div",27)(1,"mat-icon"),o(2,"description"),i(),n(3,"span",28),o(4),i(),n(5,"span",29),o(6),i(),n(7,"button",5),v("click",function(){let c=u(e).$implicit,p=s(3);return C(p.downloadAttachment(c))}),n(8,"mat-icon"),o(9,"download"),i()()()}if(t&2){let e=r.$implicit,a=s(3);l(4),m(e.originalFileName),l(2),D("(",a.formatFileSize(e.fileSize),")")}}function Bt(t,r){if(t&1&&(n(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),o(3,"Attachments"),i()(),n(4,"mat-card-content")(5,"div",26),E(6,Ft,10,2,"div",27,wt),i()()()),t&2){let e=s(2);l(6),w(e.instance.attachments)}}function Vt(t,r){t&1&&(n(0,"div",20)(1,"mat-icon"),o(2,"history"),i(),n(3,"p"),o(4,"No approval actions yet"),i()())}function Nt(t,r){t&1&&(n(0,"mat-icon"),o(1,"check"),i())}function jt(t,r){t&1&&(n(0,"mat-icon"),o(1,"close"),i())}function Ht(t,r){t&1&&(n(0,"mat-icon"),o(1,"arrow_upward"),i())}function zt(t,r){t&1&&(n(0,"mat-icon"),o(1,"undo"),i())}function $t(t,r){t&1&&(n(0,"mat-icon"),o(1,"pending"),i())}function Ut(t,r){if(t&1&&(n(0,"div",35),o(1),i()),t&2){let e=s().$implicit;l(),D(' "',e.comments,'" ')}}function Gt(t,r){if(t&1&&(n(0,"div",30)(1,"div",31),d(2,Nt,2,0,"mat-icon")(3,jt,2,0,"mat-icon")(4,Ht,2,0,"mat-icon")(5,zt,2,0,"mat-icon")(6,$t,2,0,"mat-icon"),i(),n(7,"div",32)(8,"div",33)(9,"strong"),o(10),i(),n(11,"span",8),o(12),i()(),n(13,"div",34),o(14),I(15,"date"),i(),d(16,Ut,2,1,"div",35),i()()),t&2){let e,a=r.$implicit;l(),b(a.action.toLowerCase()),l(),_((e=a.action)==="APPROVED"?2:e==="REJECTED"?3:e==="ESCALATED"?4:e==="RECALLED"?5:6),l(8),m(a.approverName),l(),b(a.action.toLowerCase()),l(),m(a.action),l(2),y(" Level ",a.level," - ",k(15,10,a.createdAt,"medium")," "),l(2),_(a.comments?16:-1)}}function Wt(t,r){if(t&1&&(n(0,"div",21),E(1,Gt,17,13,"div",30,wt),i()),t&2){let e=s(2);l(),w(e.approvalHistory)}}function Jt(t,r){t&1&&(n(0,"div",20)(1,"mat-icon"),o(2,"receipt_long"),i(),n(3,"p"),o(4,"No audit logs available"),i()())}function Kt(t,r){t&1&&(n(0,"th",44),o(1,"Date"),i())}function qt(t,r){if(t&1&&(n(0,"td",45),o(1),I(2,"date"),i()),t&2){let e=r.$implicit;l(),m(k(2,1,e.createdAt,"medium"))}}function Qt(t,r){t&1&&(n(0,"th",44),o(1,"Action"),i())}function Xt(t,r){if(t&1&&(n(0,"td",45)(1,"span",8),o(2),i()()),t&2){let e=r.$implicit;l(2),m(e.action)}}function Yt(t,r){t&1&&(n(0,"th",44),o(1,"User"),i())}function Zt(t,r){if(t&1&&(n(0,"td",45),o(1),i()),t&2){let e=r.$implicit;l(),m(e.performedBy)}}function te(t,r){t&1&&(n(0,"th",44),o(1,"Details"),i())}function ee(t,r){if(t&1&&(n(0,"td",45),o(1),i()),t&2){let e=r.$implicit;l(),m(e.details)}}function ne(t,r){t&1&&M(0,"tr",46)}function ie(t,r){t&1&&M(0,"tr",47)}function ae(t,r){if(t&1&&(n(0,"table",23),h(1,36),d(2,Kt,2,0,"th",37)(3,qt,3,4,"td",38),S(),h(4,39),d(5,Qt,2,0,"th",37)(6,Xt,3,1,"td",38),S(),h(7,40),d(8,Yt,2,0,"th",37)(9,Zt,2,1,"td",38),S(),h(10,41),d(11,te,2,0,"th",37)(12,ee,2,1,"td",38),S(),d(13,ne,1,0,"tr",42)(14,ie,1,0,"tr",43),i()),t&2){let e=s(2);x("dataSource",e.auditLogs),l(13),x("matHeaderRowDef",e.auditColumns),l(),x("matRowDefColumns",e.auditColumns)}}function oe(t,r){if(t&1){let e=g();n(0,"button",50),v("click",function(){u(e);let c=s(3);return C(c.editSubmission())}),n(1,"mat-icon"),o(2,"edit"),i(),o(3," Edit Submission "),i()}}function le(t,r){if(t&1&&(n(0,"button",49)(1,"mat-icon"),o(2,"approval"),i(),o(3," Review & Approve "),i()),t&2){let e=s(3);x("routerLink",O(1,kt,e.instance.id))}}function re(t,r){if(t&1&&(n(0,"div",24),d(1,oe,4,0,"button",48)(2,le,4,3,"button",49),i()),t&2){let e=s(2);l(),_(e.canEdit?1:-1),l(),_(e.canTakeAction?2:-1)}}function ce(t,r){if(t&1){let e=g();n(0,"div",4)(1,"button",5),v("click",function(){u(e);let c=s();return C(c.goBack())}),n(2,"mat-icon"),o(3,"arrow_back"),i()(),n(4,"div",6)(5,"h1"),o(6),i(),n(7,"p",7),o(8),i()(),n(9,"span",8),o(10),i(),n(11,"button",9)(12,"mat-icon"),o(13,"more_vert"),i()(),n(14,"mat-menu",null,0),d(16,yt,5,0,"button",10)(17,Ot,5,0,"button",10),i()(),n(18,"mat-tab-group")(19,"mat-tab",11)(20,"div",12)(21,"div",13)(22,"mat-card",14)(23,"mat-card-header")(24,"mat-card-title"),o(25,"Submission Info"),i()(),n(26,"mat-card-content")(27,"div",15)(28,"span",16),o(29,"Reference Number"),i(),n(30,"span",17),o(31),i()(),n(32,"div",15)(33,"span",16),o(34,"Submitted By"),i(),n(35,"span",17),o(36),i()(),n(37,"div",15)(38,"span",16),o(39,"Submitted At"),i(),n(40,"span",17),o(41),I(42,"date"),i()(),n(43,"div",15)(44,"span",16),o(45,"Status"),i(),n(46,"span",8),o(47),i()(),d(48,At,5,1,"div",15),i()(),n(49,"mat-card",18)(50,"mat-card-header")(51,"mat-card-title"),o(52,"Form Data"),i()(),n(53,"mat-card-content"),E(54,Lt,5,2,"div",15,Tt),d(56,Rt,6,1),i()()(),d(57,Bt,8,0,"mat-card"),i()(),n(58,"mat-tab",19)(59,"div",12)(60,"mat-card")(61,"mat-card-content"),d(62,Vt,5,0,"div",20)(63,Wt,3,0,"div",21),i()()()(),n(64,"mat-tab",22)(65,"div",12)(66,"mat-card")(67,"mat-card-content"),d(68,Jt,5,0,"div",20)(69,ae,15,3,"table",23),i()()()()(),d(70,re,3,2,"div",24)}if(t&2){let e=P(15),a=s();l(6),m(a.instance.referenceNumber),l(2),m(a.instance.workflowName),l(),b(a.instance.status.toLowerCase()),l(),m(a.instance.status),l(),x("matMenuTriggerFor",e),l(5),_(a.canEdit?16:-1),l(),_(a.canDelete?17:-1),l(14),m(a.instance.referenceNumber),l(5),m(a.instance.initiatorName),l(5),m(k(42,20,a.instance.createdAt,"medium")),l(5),b(a.instance.status.toLowerCase()),l(),m(a.instance.status),l(),_(a.instance.status==="PENDING"?48:-1),l(6),w(a.getFieldValuesArray()),l(2),_(a.instance.comments?56:-1),l(),_(a.instance.attachments&&a.instance.attachments.length>0?57:-1),l(5),_(a.approvalHistory.length===0?62:63),l(6),_(a.auditLogs.length===0?68:69),l(2),_(a.canTakeAction||a.canEdit?70:-1)}}var Ve=(()=>{class t{workflowService;settingService;route;router;dialog;snackBar;instance=null;approvalHistory=[];auditLogs=[];loading=!0;canTakeAction=!1;canEdit=!1;canDelete=!1;auditColumns=["createdAt","action","performedBy","details"];getFieldValuesArray(){return this.instance?.fieldValues?Array.isArray(this.instance.fieldValues)?this.instance.fieldValues:Object.entries(this.instance.fieldValues).map(([e,a])=>({fieldName:e,fieldLabel:e,value:a})):[]}constructor(e,a,c,p,Dt,It){this.workflowService=e,this.settingService=a,this.route=c,this.router=p,this.dialog=Dt,this.snackBar=It}ngOnInit(){let e=this.route.snapshot.paramMap.get("instanceId");e&&this.loadInstance(e)}loadInstance(e){this.workflowService.getInstance(e).subscribe({next:a=>{this.loading=!1,a.success&&(this.instance=a.data,this.approvalHistory=a.data.approvalHistory||[],this.canTakeAction=a.data.status==="PENDING",this.canEdit=a.data.status==="DRAFT"||a.data.status==="RECALLED",this.canDelete=a.data.status==="DRAFT"||a.data.status==="RECALLED",this.loadAuditLogs(e))},error:()=>{this.loading=!1}})}loadAuditLogs(e){this.settingService.getAuditLogs("WorkflowInstance",e).subscribe(a=>{a.success&&(this.auditLogs=a.data)})}goBack(){this.instance?this.router.navigate(["/workflows",this.instance.workflowCode,"instances"]):this.router.navigate(["/dashboard"])}formatFileSize(e){if(e===0)return"0 Bytes";let a=1024,c=["Bytes","KB","MB","GB"],p=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,p)).toFixed(2))+" "+c[p]}downloadAttachment(e){this.workflowService.downloadAttachment(e.id).subscribe(a=>{let c=window.URL.createObjectURL(a),p=document.createElement("a");p.href=c,p.download=e.originalFileName,p.click(),window.URL.revokeObjectURL(c)})}editSubmission(){this.instance&&this.router.navigate(["/workflows",this.instance.workflowCode,"edit",this.instance.id])}deleteSubmission(){if(!this.instance)return;this.dialog.open(Et,{width:"400px",data:{title:"Delete Submission",message:`Are you sure you want to delete submission "${this.instance.referenceNumber}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed().subscribe(a=>{a&&this.instance&&this.workflowService.deleteInstance(this.instance.id).subscribe({next:c=>{c.success&&(this.snackBar.open("Submission deleted successfully","Close",{duration:3e3}),this.router.navigate(["/my-submissions"]))},error:()=>{this.snackBar.open("Failed to delete submission","Close",{duration:3e3})}})})}static \u0275fac=function(a){return new(a||t)(f(mt),f(U),f(R),f(F),f(tt),f(Y))};static \u0275cmp=T({type:t,selectors:[["app-instance-detail"]],decls:3,vars:1,consts:[["actionsMenu","matMenu"],[1,"instance-detail-container"],[1,"loading"],["diameter","40"],[1,"header"],["mat-icon-button","",3,"click"],[1,"header-info"],[1,"subtitle"],[1,"badge"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item",""],["label","Details"],[1,"tab-content"],[1,"details-grid"],[1,"info-card"],[1,"info-row"],[1,"label"],[1,"value"],[1,"data-card"],["label","Approval History"],[1,"empty-state"],[1,"timeline"],["label","Audit"],["mat-table","",1,"audit-table",3,"dataSource"],[1,"action-bar"],["mat-menu-item","",3,"click"],[1,"attachments-list"],[1,"attachment-item"],[1,"name"],[1,"size"],[1,"timeline-item"],[1,"timeline-marker"],[1,"timeline-content"],[1,"timeline-header"],[1,"timeline-meta"],[1,"timeline-comments"],["matColumnDef","createdAt"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["matColumnDef","performedBy"],["matColumnDef","details"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],["mat-raised-button","","color","accent"],["mat-raised-button","","color","primary",3,"routerLink"],["mat-raised-button","","color","accent",3,"click"]],template:function(a,c){a&1&&(n(0,"div",1),d(1,Pt,2,0,"div",2)(2,ce,71,23),i()),a&2&&(l(),_(c.loading?1:c.instance?2:-1))},dependencies:[L,A,V,B,q,G,J,K,W,St,Mt,ht,$,z,H,j,N,ct,bt,dt,_t,Ct,pt,st,xt,ft,ut,gt,vt,it,nt,X,Q,rt,ot,at,lt,et,Z],styles:[".instance-detail-container[_ngcontent-%COMP%]{padding:1rem;max-width:1200px;margin:0 auto}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.header-info[_ngcontent-%COMP%]{flex:1}.header-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.tab-content[_ngcontent-%COMP%]{padding:1rem 0}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #eee}.info-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#666;font-size:.875rem}.info-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.badge.recalled[_ngcontent-%COMP%]{background:#fce4ec;color:#c2185b}.badge.cancelled[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.badge.on_hold[_ngcontent-%COMP%]{background:#fff8e1;color:#f57f17}.attachments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.attachment-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px}.attachment-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.attachment-item[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{color:#666;font-size:.75rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.timeline[_ngcontent-%COMP%]{padding:1rem 0}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem 0}.timeline-marker[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#f5f5f5}.timeline-marker.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.timeline-marker.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.timeline-marker.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.timeline-marker.recalled[_ngcontent-%COMP%]{background:#fce4ec;color:#c2185b}.timeline-content[_ngcontent-%COMP%]{flex:1}.timeline-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.timeline-meta[_ngcontent-%COMP%]{font-size:.75rem;color:#666;margin-top:.25rem}.timeline-comments[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px;font-style:italic}.audit-table[_ngcontent-%COMP%]{width:100%}.action-bar[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding:1rem 0;margin-top:1rem;border-top:1px solid #eee}"]})}return t})();export{Ve as InstanceDetailComponent};
