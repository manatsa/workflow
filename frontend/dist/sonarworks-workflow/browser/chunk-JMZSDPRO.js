import{a as de,b as ue}from"./chunk-FLU67HGO.js";import"./chunk-MS4AQ6UA.js";import{b as le}from"./chunk-OJT3OVWQ.js";import{a as me,b as se}from"./chunk-M4AVZ6G2.js";import"./chunk-WPDQKNTD.js";import{c as A}from"./chunk-5LBLILVL.js";import"./chunk-LAGNR76Q.js";import"./chunk-T6FL6ZBG.js";import{a as ae}from"./chunk-YFSTPTS4.js";import{a as ne,b as oe}from"./chunk-AIS23OW2.js";import{a as te,c as ie,d as re}from"./chunk-XZVKBWV7.js";import{b as Q,c as W,e as Z,i as ee}from"./chunk-IGML5J3D.js";import"./chunk-DLMMVLF7.js";import"./chunk-X4PFBHKL.js";import"./chunk-ORAJKTE5.js";import{b as q,d as p,f as O,g as R,j as B,l as L,m as V,o as D,q as G}from"./chunk-DUSDXFBS.js";import{a as H,c as J,h as K}from"./chunk-PWNKGTLH.js";import"./chunk-PSOPTTCW.js";import"./chunk-NMO4AZKI.js";import{a as P,c as T,d as U,g as k}from"./chunk-JQUVUDJB.js";import{m as y,qa as j,ra as $,sa as X,ta as Y,va as z}from"./chunk-A3I6STGM.js";import{Ab as f,Fb as l,Hb as I,Ib as S,Jb as b,Kb as i,Lb as e,Mb as u,Ub as w,Vb as g,bb as m,dc as n,ec as _,fc as N,gb as h,nb as F,tb as c}from"./chunk-2HR56SRD.js";var C=function(t){return t.SYSTEM="SYSTEM",t.STAFF="STAFF",t.MANAGER="MANAGER",t.EXTERNAL="EXTERNAL",t}(C||{});var pe=(t,s)=>s.id;function ce(t,s){t&1&&(i(0,"mat-error"),n(1,"Username is required"),e())}function fe(t,s){t&1&&(i(0,"mat-error"),n(1,"Email is required"),e())}function he(t,s){t&1&&(i(0,"mat-error"),n(1,"Please enter a valid email"),e())}function Ce(t,s){t&1&&(i(0,"mat-error"),n(1,"Password is required"),e())}function _e(t,s){t&1&&(i(0,"mat-error"),n(1,"Password must be at least 8 characters"),e())}function Ee(t,s){t&1&&(i(0,"mat-error"),n(1,"Passwords do not match"),e())}function Se(t,s){if(t&1&&(i(0,"div",5)(1,"mat-form-field",6)(2,"mat-label"),n(3,"Password"),e(),u(4,"input",26),i(5,"mat-icon",8),n(6,"lock"),e(),c(7,Ce,2,0,"mat-error")(8,_e,2,0,"mat-error"),e(),i(9,"mat-form-field",6)(10,"mat-label"),n(11,"Confirm Password"),e(),u(12,"input",27),i(13,"mat-icon",8),n(14,"lock_outline"),e(),c(15,Ee,2,0,"mat-error"),e()()),t&2){let r,o,a=g();m(7),l((r=a.userForm.get("password"))!=null&&r.hasError("required")?7:-1),m(),l((o=a.userForm.get("password"))!=null&&o.hasError("minlength")?8:-1),m(7),l(a.userForm.hasError("passwordMismatch")?15:-1)}}function be(t,s){t&1&&(i(0,"mat-error"),n(1,"First name is required"),e())}function ge(t,s){t&1&&(i(0,"mat-error"),n(1,"Last name is required"),e())}function xe(t,s){if(t&1&&(i(0,"mat-option",17),n(1),e()),t&2){let r=s.$implicit;f("value",r),m(),_(r)}}function ve(t,s){if(t&1&&(i(0,"mat-option",17),n(1),e()),t&2){let r=s.$implicit;f("value",r.id),m(),_(r.name)}}function Me(t,s){if(t&1&&(i(0,"mat-option",17),n(1),e()),t&2){let r=s.$implicit;f("value",r.id),m(),_(r.name)}}function Fe(t,s){t&1&&n(0," Saving... ")}function Ie(t,s){if(t&1&&n(0),t&2){let r=g();N(" ",r.isEdit?"Update User":"Create User"," ")}}var Ze=(()=>{class t{fb;userService;router;route;snackBar;userForm;isEdit=!1;loading=!1;userId=null;roles=[];sbus=[];userTypes=[C.SYSTEM,C.STAFF,C.MANAGER,C.EXTERNAL];constructor(r,o,a,d,E){this.fb=r,this.userService=o,this.router=a,this.route=d,this.snackBar=E,this.userForm=this.fb.group({username:["",p.required],email:["",[p.required,p.email]],password:[""],confirmPassword:[""],firstName:["",p.required],lastName:["",p.required],phone:[""],staffId:[""],department:[""],userType:["STAFF",p.required],roleIds:[[]],sbuIds:[[]],enabled:[!0],mustChangePassword:[!0]},{validators:this.passwordMatchValidator})}ngOnInit(){this.loadRoles(),this.loadSbus(),this.userId=this.route.snapshot.paramMap.get("id"),this.userId&&this.userId!=="new"?(this.isEdit=!0,this.loadUser()):(this.userForm.get("password")?.setValidators([p.required,p.minLength(8)]),this.userForm.get("confirmPassword")?.setValidators([p.required]))}passwordMatchValidator(r){let o=r.get("password")?.value,a=r.get("confirmPassword")?.value;return!o&&!a||o===a?null:{passwordMismatch:!0}}loadRoles(){this.userService.getRoles().subscribe(r=>{r.success&&(this.roles=r.data)})}loadSbus(){this.userService.getSbus().subscribe(r=>{r.success&&(this.sbus=r.data)})}loadUser(){this.userId&&this.userService.getUser(this.userId).subscribe(r=>{if(r.success){let o=r.data;this.userForm.patchValue({username:o.username,email:o.email,firstName:o.firstName,lastName:o.lastName,phone:o.phone,staffId:o.staffId,department:o.department,userType:o.userType,roleIds:o.roleIds||[],sbuIds:o.sbuIds||[],enabled:o.enabled??o.isActive,mustChangePassword:o.mustChangePassword})}})}onSubmit(){if(this.userForm.invalid)return;this.loading=!0;let r=this.userForm.value,o={username:r.username,email:r.email,password:r.password||void 0,firstName:r.firstName,lastName:r.lastName,phone:r.phone,staffId:r.staffId,department:r.department,userType:r.userType,roleIds:r.roleIds,sbuIds:r.sbuIds,enabled:r.enabled,mustChangePassword:r.mustChangePassword};(this.isEdit?this.userService.updateUser(this.userId,o):this.userService.createUser(o)).subscribe({next:d=>{this.loading=!1,d.success?(this.snackBar.open(this.isEdit?"User updated successfully":"User created successfully","Close",{duration:3e3}),this.router.navigate(["/users"])):this.snackBar.open(d.message||"Operation failed","Close",{duration:3e3})},error:d=>{this.loading=!1,this.snackBar.open(d.error?.message||"An error occurred","Close",{duration:3e3})}})}static \u0275fac=function(o){return new(o||t)(h(D),h(ae),h(T),h(P),h(ne))};static \u0275cmp=F({type:t,selectors:[["app-user-form"]],decls:96,vars:11,consts:[[1,"user-form-container"],[1,"header"],["mat-icon-button","","routerLink","/users"],[3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","username",3,"readonly"],["matPrefix",""],["matInput","","formControlName","email","type","email"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["matInput","","formControlName","phone"],["matInput","","formControlName","staffId"],["appearance","outline",1,"form-field","full-width"],["matInput","","formControlName","department"],["formControlName","userType"],[3,"value"],["formControlName","roleIds","multiple",""],["formControlName","sbuIds","multiple",""],[1,"checkbox-row"],["formControlName","enabled"],["formControlName","mustChangePassword"],[1,"form-actions"],["mat-button","","type","button","routerLink","/users"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["matInput","","formControlName","password","type","password"],["matInput","","formControlName","confirmPassword","type","password"]],template:function(o,a){if(o&1&&(i(0,"div",0)(1,"div",1)(2,"button",2)(3,"mat-icon"),n(4,"arrow_back"),e()(),i(5,"h1"),n(6),e()(),i(7,"mat-card")(8,"mat-card-content")(9,"form",3),w("ngSubmit",function(){return a.onSubmit()}),i(10,"div",4)(11,"h3"),n(12,"Account Information"),e(),i(13,"div",5)(14,"mat-form-field",6)(15,"mat-label"),n(16,"Username"),e(),u(17,"input",7),i(18,"mat-icon",8),n(19,"person"),e(),c(20,ce,2,0,"mat-error"),e(),i(21,"mat-form-field",6)(22,"mat-label"),n(23,"Email"),e(),u(24,"input",9),i(25,"mat-icon",8),n(26,"email"),e(),c(27,fe,2,0,"mat-error")(28,he,2,0,"mat-error"),e()(),c(29,Se,16,3,"div",5),e(),i(30,"div",4)(31,"h3"),n(32,"Personal Information"),e(),i(33,"div",5)(34,"mat-form-field",6)(35,"mat-label"),n(36,"First Name"),e(),u(37,"input",10),c(38,be,2,0,"mat-error"),e(),i(39,"mat-form-field",6)(40,"mat-label"),n(41,"Last Name"),e(),u(42,"input",11),c(43,ge,2,0,"mat-error"),e()(),i(44,"div",5)(45,"mat-form-field",6)(46,"mat-label"),n(47,"Phone"),e(),u(48,"input",12),i(49,"mat-icon",8),n(50,"phone"),e()(),i(51,"mat-form-field",6)(52,"mat-label"),n(53,"Staff ID"),e(),u(54,"input",13),i(55,"mat-icon",8),n(56,"badge"),e()()(),i(57,"mat-form-field",14)(58,"mat-label"),n(59,"Department"),e(),u(60,"input",15),i(61,"mat-icon",8),n(62,"business"),e()()(),i(63,"div",4)(64,"h3"),n(65,"Access & Permissions"),e(),i(66,"div",5)(67,"mat-form-field",6)(68,"mat-label"),n(69,"User Type"),e(),i(70,"mat-select",16),S(71,xe,2,2,"mat-option",17,I),e()(),i(73,"mat-form-field",6)(74,"mat-label"),n(75,"Roles"),e(),i(76,"mat-select",18),S(77,ve,2,2,"mat-option",17,pe),e()()(),i(79,"mat-form-field",14)(80,"mat-label"),n(81,"SBUs"),e(),i(82,"mat-select",19),S(83,Me,2,2,"mat-option",17,pe),e()(),i(85,"div",20)(86,"mat-checkbox",21),n(87,"Account Enabled"),e(),i(88,"mat-checkbox",22),n(89,"Must Change Password on Next Login"),e()()(),i(90,"div",23)(91,"button",24),n(92,"Cancel"),e(),i(93,"button",25),c(94,Fe,1,0)(95,Ie,1,1),e()()()()()()),o&2){let d,E,x,v,M;m(6),_(a.isEdit?"Edit User":"Create User"),m(3),f("formGroup",a.userForm),m(8),f("readonly",a.isEdit),m(3),l((d=a.userForm.get("username"))!=null&&d.hasError("required")?20:-1),m(7),l((E=a.userForm.get("email"))!=null&&E.hasError("required")?27:-1),m(),l((x=a.userForm.get("email"))!=null&&x.hasError("email")?28:-1),m(),l(a.isEdit?-1:29),m(9),l((v=a.userForm.get("firstName"))!=null&&v.hasError("required")?38:-1),m(5),l((M=a.userForm.get("lastName"))!=null&&M.hasError("required")?43:-1),m(28),b(a.userTypes),m(6),b(a.roles),m(6),b(a.sbus),m(10),f("disabled",a.loading),m(),l(a.loading?94:95)}},dependencies:[y,G,B,q,O,R,L,V,k,U,K,H,J,te,ee,Q,W,Z,re,ie,se,me,A,z,Y,X,$,j,ue,de,le,oe],styles:[".user-form-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.form-section[_ngcontent-%COMP%]{margin-bottom:1.5rem;padding-bottom:1.5rem;border-bottom:1px solid #eee}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#333}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.form-field[_ngcontent-%COMP%]{flex:1}.full-width[_ngcontent-%COMP%]{width:100%}.checkbox-row[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-top:.5rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem}"]})}return t})();export{Ze as UserFormComponent};
