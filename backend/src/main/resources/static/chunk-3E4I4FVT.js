import{a as ke}from"./chunk-WXX6UXQ6.js";import"./chunk-F5X5MWHG.js";import{a as Fe,b as Te}from"./chunk-26MIDNQT.js";import{a as Ie}from"./chunk-3U3ZRNJ5.js";import{a as ye}from"./chunk-KHA6H2VC.js";import"./chunk-MS4AQ6UA.js";import{a as de,b as se}from"./chunk-5B5KDLSZ.js";import{d as B}from"./chunk-WNUHNPS4.js";import{a as fe,c as _e}from"./chunk-IVI3BL2S.js";import{b as ce,c as ue}from"./chunk-C5XODKZL.js";import"./chunk-LU6VCXUA.js";import"./chunk-AGZT6V36.js";import{b as ne,c as re,d as ae,i as oe,j as me,l as le,m as pe}from"./chunk-2AGPTHDJ.js";import{d as N,f as M,i as A,j as H,m as R,n as $,q as j,r as q,v as G,w as W,x as U}from"./chunk-QGDZCCER.js";import{a as Ce,b as he,c as xe,d as De,e as ge,f as we,g as Ee,h as Se,i as ve,j as Me,k as be}from"./chunk-ZLHYE5PR.js";import{a as Y,b as Z,c as ee,f as te,h as ie}from"./chunk-BTSRKJZZ.js";import"./chunk-MNRHFUYD.js";import"./chunk-UF7Y5AYJ.js";import"./chunk-PMYQJTBZ.js";import{Aa as X,q as P,va as z,wa as J,xa as K,ya as Q}from"./chunk-37H25STD.js";import{Eb as f,Gb as I,Jb as E,Mb as b,Nb as y,Ob as n,Pb as t,Qb as C,Rb as D,Sb as g,Ub as v,Yb as u,Zb as S,eb as l,gc as k,hc as r,ic as h,jb as w,jc as F,lc as L,mc as O,nc as V,oa as d,pa as s,qb as T,wb as c}from"./chunk-UYCZSUYP.js";var Le=(i,m)=>m.id;function Oe(i,m){if(i&1&&(n(0,"mat-option",11),r(1),t()),i&2){let e=m.$implicit;f("value",e.id),l(),h(e.name)}}function Ve(i,m){i&1&&(n(0,"th",28),r(1,"Code"),t())}function Pe(i,m){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=m.$implicit;l(),h(e.code)}}function Be(i,m){i&1&&(n(0,"th",28),r(1,"Name"),t())}function Ne(i,m){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=m.$implicit;l(),h(e.name)}}function Ae(i,m){i&1&&(n(0,"th",28),r(1,"Corporate"),t())}function He(i,m){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=m.$implicit;l(),h(e.corporateName||"Global")}}function Re(i,m){i&1&&(n(0,"th",28),r(1,"Head of Department"),t())}function $e(i,m){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=m.$implicit;l(),h(e.headOfDepartment||"-")}}function je(i,m){i&1&&(n(0,"th",28),r(1,"Status"),t())}function qe(i,m){if(i&1&&(n(0,"td",29)(1,"mat-chip",30),r(2),t()()),i&2){let e=m.$implicit;l(),f("color",e.isActive?"primary":"warn"),l(),F(" ",e.isActive?"Active":"Inactive"," ")}}function Ge(i,m){i&1&&(n(0,"th",28),r(1,"Actions"),t())}function We(i,m){if(i&1){let e=v();n(0,"td",29)(1,"button",31),u("click",function(){let a=d(e).$implicit,o=S();return s(o.editDepartment(a))}),n(2,"mat-icon"),r(3,"edit"),t()(),n(4,"button",32),u("click",function(){let a=d(e).$implicit,o=S();return s(o.deleteDepartment(a))}),n(5,"mat-icon"),r(6,"delete"),t()()()}}function Ue(i,m){i&1&&C(0,"tr",33)}function ze(i,m){i&1&&C(0,"tr",34)}function Je(i,m){i&1&&(n(0,"div",26)(1,"mat-icon"),r(2,"business"),t(),n(3,"p"),r(4,"No departments found. Add your first department."),t()())}function Ke(i,m){i&1&&(n(0,"mat-error"),r(1,"Code is required"),t())}function Qe(i,m){i&1&&(n(0,"mat-error"),r(1,"Name is required"),t())}function Xe(i,m){if(i&1&&(n(0,"mat-option",11),r(1),t()),i&2){let e=m.$implicit;f("value",e.id),l(),h(e.name)}}function Ye(i,m){i&1&&(n(0,"mat-error"),r(1,"Invalid email format"),t())}function Ze(i,m){if(i&1){let e=v();n(0,"mat-card",27)(1,"mat-card-header")(2,"mat-card-title"),r(3),t()(),n(4,"mat-card-content")(5,"form",35),u("ngSubmit",function(){d(e);let a=S();return s(a.saveDepartment())}),n(6,"div",36)(7,"mat-form-field",37)(8,"mat-label"),r(9,"Code"),t(),C(10,"input",38),c(11,Ke,2,0,"mat-error"),t(),n(12,"mat-form-field",37)(13,"mat-label"),r(14,"Name"),t(),C(15,"input",39),c(16,Qe,2,0,"mat-error"),t()(),n(17,"mat-form-field",40)(18,"mat-label"),r(19,"Corporate (Optional)"),t(),n(20,"mat-select",41)(21,"mat-option",11),r(22,"-- Global (All Corporates) --"),t(),b(23,Xe,2,2,"mat-option",11,Le),t(),n(25,"mat-hint"),r(26,"Leave empty for global department accessible to all corporates"),t()(),n(27,"mat-form-field",40)(28,"mat-label"),r(29,"Description"),t(),C(30,"textarea",42),t(),n(31,"mat-form-field",40)(32,"mat-label"),r(33,"Head of Department"),t(),C(34,"input",43),t(),n(35,"div",36)(36,"mat-form-field",37)(37,"mat-label"),r(38,"Contact Email"),t(),C(39,"input",44),c(40,Ye,2,0,"mat-error"),t(),n(41,"mat-form-field",37)(42,"mat-label"),r(43,"Contact Phone"),t(),C(44,"input",45),t()(),n(45,"div",46)(46,"button",47),u("click",function(){d(e);let a=S();return s(a.showForm=!1)}),r(47,"Cancel"),t(),n(48,"button",48),r(49),t()()()()()}if(i&2){let e,p,a,o=S();l(3),h(o.editingDepartment?"Edit Department":"Add Department"),l(2),f("formGroup",o.departmentForm),l(6),E((e=o.departmentForm.get("code"))!=null&&e.hasError("required")?11:-1),l(5),E((p=o.departmentForm.get("name"))!=null&&p.hasError("required")?16:-1),l(5),f("value",null),l(2),y(o.corporates),l(17),E((a=o.departmentForm.get("contactEmail"))!=null&&a.hasError("email")?40:-1),l(8),f("disabled",o.loading||o.departmentForm.invalid),l(),F(" ",o.editingDepartment?"Update":"Create"," ")}}var yt=(()=>{class i{fb;departmentService;userService;importExportService;snackBar;departments=[];displayedDepartments=[];corporates=[];displayedColumns=["code","name","corporate","headOfDepartment","status","actions"];showForm=!1;editingDepartment=null;loading=!1;departmentForm;filterCorporateId=null;constructor(e,p,a,o,_){this.fb=e,this.departmentService=p,this.userService=a,this.importExportService=o,this.snackBar=_,this.departmentForm=this.fb.group({code:["",M.required],name:["",M.required],description:[""],corporateId:[null],headOfDepartment:[""],contactEmail:["",M.email],contactPhone:[""]})}ngOnInit(){this.loadDepartments(),this.loadCorporates()}loadDepartments(){this.departmentService.getDepartments().subscribe(e=>{e.success&&(this.departments=e.data,this.applyFilters())})}loadCorporates(){this.userService.getActiveCorporates().subscribe(e=>{e.success&&(this.corporates=e.data)})}applyFilters(){let e=[...this.departments];this.filterCorporateId&&(e=e.filter(p=>p.corporateId===this.filterCorporateId)),this.displayedDepartments=e}clearFilters(){this.filterCorporateId=null,this.applyFilters()}openNewForm(){this.showForm=!0,this.editingDepartment=null,this.departmentForm.reset()}editDepartment(e){this.editingDepartment=e,this.showForm=!0,this.departmentForm.patchValue({code:e.code,name:e.name,description:e.description,corporateId:e.corporateId||null,headOfDepartment:e.headOfDepartment,contactEmail:e.contactEmail,contactPhone:e.contactPhone})}saveDepartment(){if(this.departmentForm.invalid)return;this.loading=!0;let e=this.departmentForm.value;(this.editingDepartment?this.departmentService.updateDepartment(this.editingDepartment.id,e):this.departmentService.createDepartment(e)).subscribe({next:a=>{this.loading=!1,a.success&&(this.snackBar.open(this.editingDepartment?"Department updated":"Department created","Close",{duration:3e3}),this.showForm=!1,this.editingDepartment=null,this.departmentForm.reset(),this.loadDepartments())},error:a=>{this.loading=!1,this.snackBar.open(a.error?.message||"Operation failed","Close",{duration:3e3})}})}deleteDepartment(e){confirm(`Are you sure you want to delete "${e.name}"?`)&&this.departmentService.deleteDepartment(e.id).subscribe({next:()=>{this.snackBar.open("Department deleted","Close",{duration:3e3}),this.loadDepartments()},error:p=>{this.snackBar.open(p.error?.message||"Failed to delete","Close",{duration:3e3})}})}downloadTemplate(){this.importExportService.downloadTemplate("departments").subscribe({next:e=>{this.importExportService.downloadFile(e,"Departments_Template.xlsx"),this.snackBar.open("Template downloaded","Close",{duration:3e3})},error:()=>this.snackBar.open("Failed to download template","Close",{duration:3e3})})}importFromExcel(e){let p=e.target;if(!p.files?.length)return;let a=p.files[0];this.importExportService.importFromExcel("departments",a).subscribe({next:o=>{o.success?(this.snackBar.open(o.message||"Departments imported","Close",{duration:3e3}),this.loadDepartments()):this.snackBar.open(o.message||"Failed to import","Close",{duration:3e3}),p.value=""},error:o=>{this.snackBar.open(o.error?.message||"Failed to import","Close",{duration:3e3}),p.value=""}})}exportToExcel(){this.importExportService.exportToExcel("departments").subscribe({next:e=>{this.importExportService.downloadFile(e,"Departments_Export.xlsx"),this.snackBar.open("Departments exported","Close",{duration:3e3})},error:()=>this.snackBar.open("Failed to export","Close",{duration:3e3})})}static \u0275fac=function(p){return new(p||i)(w(G),w(ke),w(ye),w(Ie),w(ce))};static \u0275cmp=T({type:i,selectors:[["app-department-list"]],decls:64,vars:9,consts:[["fileInput",""],[1,"department-list-container"],[1,"header"],[1,"header-actions"],["mat-stroked-button","",3,"click"],["hidden","","type","file","accept",".xlsx",3,"change"],["mat-raised-button","","color","primary",3,"click"],[1,"filter-card"],[1,"filter-row"],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value"],["mat-button","",3,"click"],[1,"content-grid"],[1,"table-card"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","corporate"],["matColumnDef","headOfDepartment"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"no-data"],[1,"form-card"],["mat-header-cell",""],["mat-cell",""],["selected","",3,"color"],["mat-icon-button","","matTooltip","Edit",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-header-row",""],["mat-row",""],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","code"],["matInput","","formControlName","name"],["appearance","outline",1,"form-field","full-width"],["formControlName","corporateId"],["matInput","","formControlName","description","rows","2"],["matInput","","formControlName","headOfDepartment"],["matInput","","formControlName","contactEmail","type","email"],["matInput","","formControlName","contactPhone"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(p,a){if(p&1){let o=v();n(0,"div",1)(1,"div",2)(2,"h1"),r(3,"Departments"),t(),n(4,"div",3)(5,"button",4),u("click",function(){return d(o),s(a.downloadTemplate())}),n(6,"mat-icon"),r(7,"description"),t(),r(8," Template "),t(),n(9,"button",4),u("click",function(){d(o);let x=k(14);return s(x.click())}),n(10,"mat-icon"),r(11,"upload"),t(),r(12," Import "),t(),n(13,"input",5,0),u("change",function(x){return d(o),s(a.importFromExcel(x))}),t(),n(15,"button",4),u("click",function(){return d(o),s(a.exportToExcel())}),n(16,"mat-icon"),r(17,"download"),t(),r(18," Export "),t(),n(19,"button",6),u("click",function(){return d(o),s(a.openNewForm())}),n(20,"mat-icon"),r(21,"add"),t(),r(22," Add Department "),t()()(),n(23,"mat-card",7)(24,"mat-card-content")(25,"div",8)(26,"mat-form-field",9)(27,"mat-label"),r(28,"Filter by Corporate"),t(),n(29,"mat-select",10),V("ngModelChange",function(x){return d(o),O(a.filterCorporateId,x)||(a.filterCorporateId=x),s(x)}),u("selectionChange",function(){return d(o),s(a.applyFilters())}),n(30,"mat-option",11),r(31,"-- All Corporates --"),t(),b(32,Oe,2,2,"mat-option",11,Le),t()(),n(34,"button",12),u("click",function(){return d(o),s(a.clearFilters())}),n(35,"mat-icon"),r(36,"clear"),t(),r(37," Clear Filters "),t()()()(),n(38,"div",13)(39,"mat-card",14)(40,"mat-card-content")(41,"table",15),D(42,16),c(43,Ve,2,0,"th",17)(44,Pe,2,1,"td",18),g(),D(45,19),c(46,Be,2,0,"th",17)(47,Ne,2,1,"td",18),g(),D(48,20),c(49,Ae,2,0,"th",17)(50,He,2,1,"td",18),g(),D(51,21),c(52,Re,2,0,"th",17)(53,$e,2,1,"td",18),g(),D(54,22),c(55,je,2,0,"th",17)(56,qe,3,2,"td",18),g(),D(57,23),c(58,Ge,2,0,"th",17)(59,We,7,0,"td",18),g(),c(60,Ue,1,0,"tr",24)(61,ze,1,0,"tr",25),t(),c(62,Je,5,0,"div",26),t()(),c(63,Ze,50,8,"mat-card",27),t()()}p&2&&(l(29),L("ngModel",a.filterCorporateId),l(),f("value",null),l(2),y(a.corporates),l(6),I("with-form",a.showForm),l(3),f("dataSource",a.displayedDepartments),l(19),f("matHeaderRowDef",a.displayedColumns),l(),f("matRowDefColumns",a.displayedColumns),l(),E(a.displayedDepartments.length===0?62:-1),l(),E(a.showForm?63:-1))},dependencies:[P,W,$,N,A,H,R,U,j,q,ie,Y,ee,te,Z,be,Ce,xe,Ee,De,he,Se,ge,we,ve,Me,me,oe,ne,ae,re,pe,le,X,Q,K,J,z,ue,_e,fe,se,de,B,Te,Fe],styles:[".department-list-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.filter-card[_ngcontent-%COMP%]{margin-bottom:1rem}.filter-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}.filter-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:200px}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:1rem}.content-grid.with-form[_ngcontent-%COMP%]{grid-template-columns:1fr 500px}@media (max-width: 1100px){.content-grid.with-form[_ngcontent-%COMP%]{grid-template-columns:1fr}}.full-width[_ngcontent-%COMP%]{width:100%}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.form-field[_ngcontent-%COMP%]{flex:1;margin-bottom:.5rem}.form-field.full-width[_ngcontent-%COMP%]{width:100%}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;margin-top:1rem}table[_ngcontent-%COMP%]{width:100%}.mat-column-actions[_ngcontent-%COMP%]{width:120px;text-align:center}"]})}return i})();export{yt as DepartmentListComponent};
