import{c as u}from"./chunk-7HWBNCDZ.js";import{u as l,za as r}from"./chunk-SKGZNIDJ.js";import{Fa as c,Z as a,a as o,aa as h,fa as n}from"./chunk-2CONVDTD.js";var d=(()=>{class s{http;router;TOKEN_KEY="auth_token";REFRESH_TOKEN_KEY="refresh_token";USER_KEY="current_user";currentUserSignal=c(null);constructor(t,e){this.http=t,this.router=e,this.loadStoredUser()}get currentUser(){return this.currentUserSignal()}get token(){return localStorage.getItem(this.TOKEN_KEY)}get isAuthenticated(){return!!this.token}login(t){return this.http.post(`${r.apiUrl}/auth/login`,t).pipe(a(e=>{e.success&&e.data&&this.setSession(e.data)}))}logout(){this.http.post(`${r.apiUrl}/auth/logout`,{}).subscribe({complete:()=>this.clearSession()})}refreshToken(){let t=localStorage.getItem(this.REFRESH_TOKEN_KEY);return this.http.post(`${r.apiUrl}/auth/refresh?refreshToken=${t}`,{}).pipe(a(e=>{e.success&&e.data&&this.setSession(e.data)}))}hasRole(t){return this.currentUser?.roles?.includes(t)??!1}hasPrivilege(t){return this.currentUser?.privileges?.includes(t)??!1}hasAnyPrivilege(t){return t.some(e=>this.hasPrivilege(e))}changePassword(t,e,i){return this.http.post(`${r.apiUrl}/password/change`,{currentPassword:t,newPassword:e,confirmPassword:i||e})}forgotPassword(t){return this.http.post(`${r.apiUrl}/auth/forgot-password`,{email:t})}resetPassword(t,e){return this.http.post(`${r.apiUrl}/auth/reset-password`,{token:t,newPassword:e})}refreshCurrentUser(){this.http.get(`${r.apiUrl}/auth/me`).subscribe({next:t=>{if(t.success&&t.data){let e=this.currentUser;if(e){let i=o(o({},e),t.data);localStorage.setItem(this.USER_KEY,JSON.stringify(i)),this.currentUserSignal.set(i)}}}})}setSession(t){localStorage.setItem(this.TOKEN_KEY,t.token),localStorage.setItem(this.REFRESH_TOKEN_KEY,t.refreshToken),localStorage.setItem(this.USER_KEY,JSON.stringify(t)),this.currentUserSignal.set(t)}clearSession(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSignal.set(null),this.router.navigate(["/login"])}loadStoredUser(){let t=localStorage.getItem(this.USER_KEY);if(t)try{let e=JSON.parse(t);this.currentUserSignal.set(e)}catch{this.clearSession()}}static \u0275fac=function(e){return new(e||s)(n(l),n(u))};static \u0275prov=h({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{d as a};
