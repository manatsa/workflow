import{b as mt}from"./chunk-RORH5LGT.js";import{h as dt}from"./chunk-K3UXCVE5.js";import{b as st}from"./chunk-L6PTED5A.js";import{a as lt,b as ct}from"./chunk-D7HGT47B.js";import{a as ut}from"./chunk-3AZ62B2F.js";import{b as pt,c as _t}from"./chunk-LNAKRYVP.js";import"./chunk-3WEQTSJY.js";import{b as et,c as nt,i as it,j as at,l as ot,m as rt}from"./chunk-W7HGFPQV.js";import{d as V,f as B,h as j,i as N,m as z,p as R,q,t as $,v as H}from"./chunk-MFE2U5AV.js";import{a as Y,b as Q,c as X,f as Z,h as tt}from"./chunk-XRACF4N4.js";import"./chunk-KNH3VKXQ.js";import"./chunk-OWVO723I.js";import{a as I,c as D,d as T,g as L}from"./chunk-GMPFJIFP.js";import{l as y,p as F,ta as G,ua as U,va as W,wa as J,ya as K}from"./chunk-ZJGSEVKG.js";import{Cb as g,Eb as w,Fb as A,Hb as p,Kb as x,Lb as h,Mb as i,Nb as e,Ob as S,Sb as b,Wb as M,Xb as m,cb as r,fc as o,gc as s,hb as f,hc as u,ic as k,oa as C,ob as E,pa as v,rc as P,tc as O,ub as _}from"./chunk-BMOUMNDR.js";var vt=(a,l)=>l.fieldName,gt=(a,l)=>l.level,ft=(a,l)=>l.id;function xt(a,l){a&1&&(i(0,"div",1),S(1,"mat-spinner",2),e())}function ht(a,l){if(a&1&&(i(0,"div",14)(1,"span",28),o(2),e(),i(3,"span",29),o(4),e()()),a&2){let t=l.$implicit;r(2),s(t.fieldLabel),r(2),s(t.value||"-")}}function Mt(a,l){if(a&1){let t=b();i(0,"div",31)(1,"mat-icon"),o(2,"description"),e(),i(3,"span",32),o(4),e(),i(5,"span",33),o(6),e(),i(7,"button",34),M("click",function(){let c=C(t).$implicit,d=m(3);return v(d.downloadAttachment(c))}),i(8,"mat-icon"),o(9,"download"),e()()()}if(a&2){let t=l.$implicit,n=m(3);r(4),s(t.originalFileName),r(2),u("(",n.formatFileSize(t.fileSize),")")}}function bt(a,l){if(a&1&&(i(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),o(3,"Attachments"),e()(),i(4,"mat-card-content")(5,"div",30),x(6,Mt,10,2,"div",31,ft),e()()()),a&2){let t=m(2);r(6),h(t.instance.attachments)}}function St(a,l){if(a&1&&(i(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),o(3,"Submitter Comments"),e()(),i(4,"mat-card-content")(5,"p",35),o(6),e()()()),a&2){let t=m(2);r(6),s(t.instance.comments)}}function Pt(a,l){a&1&&(i(0,"mat-error"),o(1,"Comments are required"),e())}function Ot(a,l){if(a&1){let t=b();i(0,"button",36),M("click",function(){C(t);let c=m(2);return v(c.escalate())}),i(1,"mat-icon"),o(2,"arrow_upward"),e(),o(3," Escalate "),e()}if(a&2){let t=m(2);g("disabled",t.submitting)}}function Et(a,l){a&1&&(i(0,"p",24),o(1,"No previous approvals"),e())}function wt(a,l){if(a&1&&(i(0,"div",42),o(1),e()),a&2){let t=m().$implicit;r(),u('"',t.comments,'"')}}function At(a,l){if(a&1&&(i(0,"div",37)(1,"div",38)(2,"span",39),o(3),e(),i(4,"span",40),o(5),e()(),i(6,"div",41),o(7),P(8,"date"),e(),_(9,wt,2,1,"div",42),e()),a&2){let t=l.$implicit;r(3),s(t.approverName),r(),A(t.action.toLowerCase()),r(),u(" ",t.action," "),r(2),k(" Level ",t.level," - ",O(8,7,t.createdAt,"short")," "),r(2),p(t.comments?9:-1)}}function kt(a,l){if(a&1&&(i(0,"div",25),x(1,At,10,10,"div",37,ft),e()),a&2){let t=m(2);r(),h(t.approvalHistory)}}function yt(a,l){a&1&&(i(0,"mat-icon"),o(1,"check_circle"),e())}function Ft(a,l){a&1&&(i(0,"mat-icon"),o(1,"pending"),e())}function It(a,l){a&1&&(i(0,"mat-icon"),o(1,"radio_button_unchecked"),e())}function Dt(a,l){if(a&1&&(i(0,"div",43)(1,"div",44),_(2,yt,2,0,"mat-icon")(3,Ft,2,0,"mat-icon")(4,It,2,0,"mat-icon"),e(),i(5,"div",45)(6,"strong"),o(7),e(),i(8,"span"),o(9),e()()()),a&2){let t=l.$implicit,n=m(2);w("current",t.level===n.instance.currentApprovalLevel)("completed",t.level<n.instance.currentApprovalLevel),r(2),p(t.level<n.instance.currentApprovalLevel?2:t.level===n.instance.currentApprovalLevel?3:4),r(5),u("Level ",t.level,""),r(2),s(t.label)}}function Tt(a,l){if(a&1){let t=b();i(0,"div",3)(1,"button",4)(2,"mat-icon"),o(3,"arrow_back"),e()(),i(4,"div",5)(5,"h1"),o(6),e(),i(7,"p",6),o(8),e()(),i(9,"span",7),o(10,"Pending Your Approval"),e()(),i(11,"div",8)(12,"div",9)(13,"mat-card")(14,"mat-card-header")(15,"mat-card-title"),o(16,"Submission Details"),e()(),i(17,"mat-card-content")(18,"div",10)(19,"div",11)(20,"span",12),o(21,"Submitted By"),e(),i(22,"span",13),o(23),e()(),i(24,"div",11)(25,"span",12),o(26,"Submitted At"),e(),i(27,"span",13),o(28),P(29,"date"),e()(),i(30,"div",11)(31,"span",12),o(32,"Current Level"),e(),i(33,"span",13),o(34),e()()()()(),i(35,"mat-card")(36,"mat-card-header")(37,"mat-card-title"),o(38,"Form Data"),e()(),i(39,"mat-card-content"),x(40,ht,5,2,"div",14,vt),e()(),_(42,bt,8,0,"mat-card")(43,St,7,1,"mat-card"),e(),i(44,"div",15)(45,"mat-card",16)(46,"mat-card-header")(47,"mat-card-title"),o(48,"Take Action"),e()(),i(49,"mat-card-content")(50,"form",17)(51,"mat-form-field",18)(52,"mat-label"),o(53,"Comments"),e(),S(54,"textarea",19),_(55,Pt,2,0,"mat-error"),e()(),i(56,"div",20)(57,"button",21),M("click",function(){C(t);let c=m();return v(c.approve())}),i(58,"mat-icon"),o(59,"check"),e(),o(60," Approve "),e(),_(61,Ot,4,1,"button",22),i(62,"button",23),M("click",function(){C(t);let c=m();return v(c.reject())}),i(63,"mat-icon"),o(64,"close"),e(),o(65," Reject "),e()()()(),i(66,"mat-card")(67,"mat-card-header")(68,"mat-card-title"),o(69,"Approval History"),e()(),i(70,"mat-card-content"),_(71,Et,2,0,"p",24)(72,kt,3,0,"div",25),e()(),i(73,"mat-card")(74,"mat-card-header")(75,"mat-card-title"),o(76,"Approval Chain"),e()(),i(77,"mat-card-content")(78,"div",26),x(79,Dt,10,7,"div",27,gt),e()()()()()}if(a&2){let t,n=m();r(6),s(n.instance.referenceNumber),r(2),u("",n.instance.workflowName," - Approval Request"),r(15),s(n.instance.initiatorName),r(5),s(O(29,13,n.instance.createdAt,"medium")),r(6),u("Level ",n.instance.currentApprovalLevel,""),r(6),h(n.getFieldValuesArray()),r(2),p(n.instance.attachments&&n.instance.attachments.length>0?42:-1),r(),p(n.instance.comments?43:-1),r(7),g("formGroup",n.actionForm),r(5),p(n.requireComment&&((t=n.actionForm.get("comments"))!=null&&t.hasError("required"))?55:-1),r(2),g("disabled",n.submitting),r(4),p(n.canEscalate?61:-1),r(),g("disabled",n.submitting),r(9),p(n.approvalHistory.length===0?71:72),r(8),h(n.approvalChain)}}var re=(()=>{class a{fb;workflowService;router;route;snackBar;instance=null;approvalHistory=[];approvalChain=[];actionForm;loading=!0;submitting=!1;requireComment=!1;canEscalate=!0;getFieldValuesArray(){return this.instance?.fieldValues?Array.isArray(this.instance.fieldValues)?this.instance.fieldValues:Object.entries(this.instance.fieldValues).map(([t,n])=>({fieldName:t,fieldLabel:t,value:n})):[]}constructor(t,n,c,d,Ct){this.fb=t,this.workflowService=n,this.router=c,this.route=d,this.snackBar=Ct,this.actionForm=this.fb.group({comments:[""]})}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&this.loadInstance(t)}loadInstance(t){this.workflowService.getInstance(t).subscribe({next:n=>{this.loading=!1,n.success&&(this.instance=n.data,this.approvalHistory=n.data.approvalHistory||[],this.loadWorkflowApprovers(n.data.workflowId))},error:()=>{this.loading=!1,this.snackBar.open("Failed to load approval request","Close",{duration:3e3})}})}loadWorkflowApprovers(t){this.workflowService.getWorkflow(t).subscribe(n=>{if(n.success){this.approvalChain=n.data.approvers||[];let c=this.approvalChain.find(d=>d.level===this.instance?.currentApprovalLevel);c&&(this.requireComment=c.requireComment,this.canEscalate=c.canEscalate,this.requireComment&&this.actionForm.get("comments")?.setValidators(B.required))}})}approve(){this.submitAction("APPROVE")}escalate(){this.submitAction("ESCALATE")}reject(){this.submitAction("REJECT")}submitAction(t){if(this.requireComment&&!this.actionForm.value.comments?.trim()){this.snackBar.open("Comments are required","Close",{duration:3e3});return}this.submitting=!0;let n={instanceId:this.instance.id,action:t,comments:this.actionForm.value.comments};this.workflowService.submitApproval(n).subscribe({next:c=>{this.submitting=!1,c.success&&(this.snackBar.open(`Request ${t.toLowerCase()}d successfully`,"Close",{duration:3e3}),this.router.navigate(["/approvals"]))},error:c=>{this.submitting=!1,this.snackBar.open(c.error?.message||"Action failed","Close",{duration:3e3})}})}formatFileSize(t){if(t===0)return"0 Bytes";let n=1024,c=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/Math.pow(n,d)).toFixed(2))+" "+c[d]}downloadAttachment(t){this.workflowService.downloadAttachment(t.id).subscribe(n=>{let c=window.URL.createObjectURL(n),d=document.createElement("a");d.href=c,d.download=t.originalFileName,d.click(),window.URL.revokeObjectURL(c)})}static \u0275fac=function(n){return new(n||a)(f($),f(ut),f(D),f(I),f(pt))};static \u0275cmp=E({type:a,selectors:[["app-approval-detail"]],decls:3,vars:1,consts:[[1,"approval-detail-container"],[1,"loading"],["diameter","40"],[1,"header"],["mat-icon-button","","routerLink","/approvals"],[1,"header-info"],[1,"subtitle"],[1,"badge","pending"],[1,"content-grid"],[1,"main-content"],[1,"details-grid"],[1,"detail-item"],[1,"label"],[1,"value"],[1,"field-row"],[1,"sidebar"],[1,"action-card"],[3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","comments","rows","4","placeholder","Add your comments..."],[1,"action-buttons"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","color","primary",3,"disabled"],["mat-raised-button","","color","warn",3,"click","disabled"],[1,"no-history"],[1,"history-list"],[1,"approval-chain"],[1,"chain-item",3,"current","completed"],[1,"field-label"],[1,"field-value"],[1,"attachments-list"],[1,"attachment-item"],[1,"name"],[1,"size"],["mat-icon-button","",3,"click"],[1,"comments-text"],["mat-stroked-button","","color","primary",3,"click","disabled"],[1,"history-item"],[1,"history-header"],[1,"approver"],[1,"badge"],[1,"history-meta"],[1,"history-comments"],[1,"chain-item"],[1,"chain-marker"],[1,"chain-info"]],template:function(n,c){n&1&&(i(0,"div",0),_(1,xt,2,0,"div",1)(2,Tt,81,16),e()),n&2&&(r(),p(c.loading?1:c.instance?2:-1))},dependencies:[F,y,H,z,V,j,N,R,q,L,T,tt,Y,X,Z,Q,at,it,et,nt,rt,ot,K,J,W,U,G,st,mt,ct,lt,_t,dt],styles:[".approval-detail-container[_ngcontent-%COMP%]{padding:1rem;max-width:1400px;margin:0 auto}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.header-info[_ngcontent-%COMP%]{flex:1}.header-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 400px;gap:1rem}.main-content[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{margin-bottom:1rem}.sidebar[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{margin-bottom:1rem}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:#666}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500}.field-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #eee}.field-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.field-label[_ngcontent-%COMP%]{color:#666}.field-value[_ngcontent-%COMP%]{font-weight:500}.attachments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.attachment-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px}.attachment-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.attachment-item[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{color:#666;font-size:.75rem}.comments-text[_ngcontent-%COMP%]{margin:0;padding:1rem;background:#f5f5f5;border-radius:4px;font-style:italic}.action-card[_ngcontent-%COMP%]{border:2px solid #1976d2}.full-width[_ngcontent-%COMP%]{width:100%}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.no-history[_ngcontent-%COMP%]{color:#666;text-align:center;font-style:italic}.history-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.history-item[_ngcontent-%COMP%]{padding:.75rem;background:#f5f5f5;border-radius:4px}.history-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.history-header[_ngcontent-%COMP%]   .approver[_ngcontent-%COMP%]{font-weight:500}.history-meta[_ngcontent-%COMP%]{font-size:.75rem;color:#666;margin-top:.25rem}.history-comments[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.875rem;font-style:italic}.approval-chain[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.chain-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem;border-radius:4px}.chain-item.current[_ngcontent-%COMP%]{background:#fff3e0}.chain-item.completed[_ngcontent-%COMP%]{background:#e8f5e9}.chain-marker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.chain-item.completed[_ngcontent-%COMP%]   .chain-marker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2e7d32}.chain-item.current[_ngcontent-%COMP%]   .chain-marker[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#e65100}.chain-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.chain-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.75rem;color:#666}"]})}return a})();export{re as ApprovalDetailComponent};
