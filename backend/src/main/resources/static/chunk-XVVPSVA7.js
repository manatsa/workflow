import{a as Te,b as Pe,c as E,d as Fe,e as Ve}from"./chunk-NQ5ZHPOQ.js";import"./chunk-26MIDNQT.js";import{a as De}from"./chunk-3U3ZRNJ5.js";import{a as ye}from"./chunk-KHA6H2VC.js";import"./chunk-MS4AQ6UA.js";import{a as se,b as me}from"./chunk-DCGWK6OW.js";import{d as O}from"./chunk-WNUHNPS4.js";import{a as fe,c as _e}from"./chunk-INV3KQYA.js";import{c as pe,h as ue}from"./chunk-ZLEDUOR5.js";import{b as ce,c as de}from"./chunk-C5XODKZL.js";import"./chunk-LU6VCXUA.js";import"./chunk-AGZT6V36.js";import{b as ne,i as oe,j as re,l as le,m as ae}from"./chunk-ZS434AQM.js";import{d as A,f as V,i as $,j as N,n as H,q as j,r as q,u as Q,v as G,w as z}from"./chunk-M3VCE5SG.js";import{a as ge,b as ve,c as Ce,d as he,e as xe,f as Se,g as be,h as Re,i as we,j as Me,k as Ee,l as ke}from"./chunk-ZLHYE5PR.js";import{a as Y,b as Z,c as ee,f as te,h as ie}from"./chunk-BTSRKJZZ.js";import"./chunk-MNRHFUYD.js";import"./chunk-UF7Y5AYJ.js";import"./chunk-PMYQJTBZ.js";import{Aa as X,q as B,va as U,wa as J,xa as K,ya as W}from"./chunk-37H25STD.js";import{Eb as _,Jb as x,Mb as b,Nb as R,Ob as i,Pb as n,Qb as g,Rb as w,Sb as M,Ub as S,Yb as p,Zb as u,bc as y,cc as T,dc as P,eb as s,gc as I,hc as r,ic as C,jb as h,jc as F,oa as c,pa as d,qb as L,wb as f}from"./chunk-UYCZSUYP.js";var D=(t,m)=>m.id;function Le(t,m){if(t&1&&(i(0,"mat-option",29),r(1),n()),t&2){let e=m.$implicit;_("value",e.id),s(),C(e.name)}}function Ie(t,m){if(t&1){let e=S();i(0,"div",9)(1,"form",24),p("ngSubmit",function(){c(e);let o=u();return d(o.saveRole())}),i(2,"mat-form-field",25)(3,"mat-label"),r(4,"Role Name"),n(),g(5,"input",26),n(),i(6,"mat-form-field",25)(7,"mat-label"),r(8,"Description"),n(),g(9,"input",27),n(),i(10,"mat-form-field",25)(11,"mat-label"),r(12,"Privileges"),n(),i(13,"mat-select",28),b(14,Le,2,2,"mat-option",29,D),n()(),i(16,"div",30)(17,"button",31),p("click",function(){c(e);let o=u();return d(o.cancelEdit())}),r(18,"Cancel"),n(),i(19,"button",32),r(20),n()()()()}if(t&2){let e=u();s(),_("formGroup",e.roleForm),s(13),R(e.privileges),s(6),F(" ",e.editingRole?"Update":"Create"," ")}}function Be(t,m){t&1&&(i(0,"th",33),r(1,"Name"),n())}function Oe(t,m){if(t&1&&(i(0,"div",35),r(1),n()),t&2){let e=u().$implicit;s(),C(e.description)}}function Ae(t,m){if(t&1&&(i(0,"td",34)(1,"strong"),r(2),n(),f(3,Oe,2,1,"div",35),n()),t&2){let e=m.$implicit;s(2),C(e.name),s(),x(e.description?3:-1)}}function $e(t,m){t&1&&(i(0,"th",36),r(1,"Privileges"),n())}function Ne(t,m){if(t&1&&(i(0,"mat-chip"),r(1),n()),t&2){let e=m.$implicit;s(),C(e.name)}}function He(t,m){if(t&1&&(i(0,"span",37),r(1),n()),t&2){let e=u().$implicit;s(),F("+",e.privileges.length-3," more")}}function je(t,m){if(t&1&&(i(0,"td",34),b(1,Ne,2,1,"mat-chip",null,D),f(3,He,2,1,"span",37),n()),t&2){let e=m.$implicit;s(),R(e.privileges==null?null:e.privileges.slice(0,3)),s(2),x((e.privileges==null?null:e.privileges.length)>3?3:-1)}}function qe(t,m){t&1&&g(0,"th",36)}function Qe(t,m){if(t&1){let e=S();i(0,"td",34)(1,"button",20),p("click",function(){let o=c(e).$implicit,a=u();return d(a.editRole(o))}),i(2,"mat-icon"),r(3,"edit"),n()(),i(4,"button",38),p("click",function(){let o=c(e).$implicit,a=u();return d(a.deleteRole(o))}),i(5,"mat-icon"),r(6,"delete"),n()()()}}function Ge(t,m){t&1&&g(0,"tr",39)}function ze(t,m){t&1&&g(0,"tr",40)}function Ue(t,m){if(t&1){let e=S();i(0,"div",21)(1,"form",24),p("ngSubmit",function(){c(e);let o=u();return d(o.savePrivilege())}),i(2,"mat-form-field",25)(3,"mat-label"),r(4,"Privilege Name"),n(),g(5,"input",26),n(),i(6,"mat-form-field",25)(7,"mat-label"),r(8,"Description"),n(),g(9,"input",27),n(),i(10,"div",30)(11,"button",31),p("click",function(){c(e);let o=u();return d(o.showAddPrivilege=!1)}),r(12,"Cancel"),n(),i(13,"button",32),r(14,"Create"),n()()()()}if(t&2){let e=u();s(),_("formGroup",e.privilegeForm)}}function Je(t,m){if(t&1&&(i(0,"span",35),r(1),n()),t&2){let e=u().$implicit;s(),C(e.description)}}function Ke(t,m){if(t&1){let e=S();i(0,"div",23)(1,"div",41)(2,"strong"),r(3),n(),f(4,Je,2,1,"span",35),n(),i(5,"button",42),p("click",function(){let o=c(e).$implicit,a=u();return d(a.deletePrivilege(o))}),i(6,"mat-icon"),r(7,"delete"),n()()()}if(t&2){let e=m.$implicit;s(3),C(e.name),s(),x(e.description?4:-1),s(),_("disabled",e.name==="ADMIN")}}var Mt=(()=>{class t{fb;userService;importExportService;snackBar;dialog;rolesColumns=["name","privileges","actions"];rolesDataSource=new ke([]);privileges=[];showAddRole=!1;showAddPrivilege=!1;editingRole=null;roleForm;privilegeForm;paginator;sort;constructor(e,l,o,a,v){this.fb=e,this.userService=l,this.importExportService=o,this.snackBar=a,this.dialog=v,this.roleForm=this.fb.group({name:["",V.required],description:[""],privilegeIds:[[]]}),this.privilegeForm=this.fb.group({name:["",V.required],description:[""]})}ngOnInit(){this.loadRoles(),this.loadPrivileges()}ngAfterViewInit(){this.rolesDataSource.paginator=this.paginator,this.rolesDataSource.sort=this.sort}loadRoles(){this.userService.getRoles().subscribe(e=>{e.success&&(this.rolesDataSource.data=e.data)})}loadPrivileges(){this.userService.getPrivileges().subscribe(e=>{e.success&&(this.privileges=e.data)})}editRole(e){this.editingRole=e,this.showAddRole=!0,this.roleForm.patchValue({name:e.name,description:e.description,privilegeIds:e.privilegeIds||[]})}cancelEdit(){this.showAddRole=!1,this.editingRole=null,this.roleForm.reset()}saveRole(){if(this.roleForm.invalid)return;let e=this.roleForm.value;(this.editingRole?this.userService.updateRole(this.editingRole.id,e):this.userService.createRole(e)).subscribe({next:o=>{o.success&&(this.snackBar.open(this.editingRole?"Role updated successfully":"Role created successfully","Close",{duration:3e3}),this.cancelEdit(),this.loadRoles())},error:o=>{this.snackBar.open(o.error?.message||"Operation failed","Close",{duration:3e3})}})}deleteRole(e){confirm(`Are you sure you want to delete the role "${e.name}"?`)&&this.userService.deleteRole(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Role deleted successfully","Close",{duration:3e3}),this.loadRoles())},error:l=>{this.snackBar.open(l.error?.message||"Failed to delete role","Close",{duration:3e3})}})}savePrivilege(){this.privilegeForm.invalid||this.userService.createPrivilege(this.privilegeForm.value).subscribe({next:e=>{e.success&&(this.snackBar.open("Privilege created successfully","Close",{duration:3e3}),this.showAddPrivilege=!1,this.privilegeForm.reset(),this.loadPrivileges())},error:e=>{this.snackBar.open(e.error?.message||"Failed to create privilege","Close",{duration:3e3})}})}deletePrivilege(e){if(e.name==="ADMIN"){this.snackBar.open("Cannot delete system privilege","Close",{duration:3e3});return}confirm(`Are you sure you want to delete the privilege "${e.name}"?`)&&this.userService.deletePrivilege(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Privilege deleted successfully","Close",{duration:3e3}),this.loadPrivileges())},error:l=>{this.snackBar.open(l.error?.message||"Failed to delete privilege","Close",{duration:3e3})}})}downloadTemplate(){this.importExportService.downloadTemplate("roles").subscribe({next:e=>{this.importExportService.downloadFile(e,"Roles_Template.xlsx"),this.snackBar.open("Template downloaded","Close",{duration:3e3})},error:()=>this.snackBar.open("Failed to download template","Close",{duration:3e3})})}importFromExcel(e){let l=e.target;if(!l.files?.length)return;let o=l.files[0];this.importExportService.importFromExcel("roles",o).subscribe({next:a=>{a.success?(this.snackBar.open(a.message||"Roles imported","Close",{duration:3e3}),this.loadRoles()):this.snackBar.open(a.message||"Failed to import","Close",{duration:3e3}),l.value=""},error:a=>{this.snackBar.open(a.error?.message||"Failed to import","Close",{duration:3e3}),l.value=""}})}exportToExcel(){this.importExportService.exportToExcel("roles").subscribe({next:e=>{this.importExportService.downloadFile(e,"Roles_Export.xlsx"),this.snackBar.open("Roles exported","Close",{duration:3e3})},error:()=>this.snackBar.open("Failed to export","Close",{duration:3e3})})}static \u0275fac=function(l){return new(l||t)(h(Q),h(ye),h(De),h(ce),h(pe))};static \u0275cmp=L({type:t,selectors:[["app-role-list"]],viewQuery:function(l,o){if(l&1&&(y(Te,5),y(E,5)),l&2){let a;T(a=P())&&(o.paginator=a.first),T(a=P())&&(o.sort=a.first)}},decls:54,vars:5,consts:[["fileInput",""],[1,"role-list-container"],[1,"header"],[1,"header-actions"],["mat-stroked-button","",3,"click"],["hidden","","type","file","accept",".xlsx",3,"change"],["mat-raised-button","","color","primary",3,"click"],[1,"content-grid"],[1,"roles-card"],[1,"add-role-form"],["mat-table","","matSort","",1,"data-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","privileges"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"privileges-card"],["mat-icon-button","",3,"click"],[1,"add-privilege-form"],[1,"privilege-list"],[1,"privilege-item"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"form-field"],["matInput","","formControlName","name"],["matInput","","formControlName","description"],["formControlName","privilegeIds","multiple",""],[3,"value"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"description"],["mat-header-cell",""],[1,"more"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"privilege-info"],["mat-icon-button","","color","warn",3,"click","disabled"]],template:function(l,o){if(l&1){let a=S();i(0,"div",1)(1,"div",2)(2,"h1"),r(3,"Roles & Privileges"),n(),i(4,"div",3)(5,"button",4),p("click",function(){return c(a),d(o.downloadTemplate())}),i(6,"mat-icon"),r(7,"description"),n(),r(8," Template "),n(),i(9,"button",4),p("click",function(){c(a);let k=I(14);return d(k.click())}),i(10,"mat-icon"),r(11,"upload"),n(),r(12," Import "),n(),i(13,"input",5,0),p("change",function(k){return c(a),d(o.importFromExcel(k))}),n(),i(15,"button",4),p("click",function(){return c(a),d(o.exportToExcel())}),i(16,"mat-icon"),r(17,"download"),n(),r(18," Export "),n(),i(19,"button",6),p("click",function(){return c(a),d(o.showAddRole=!0)}),i(20,"mat-icon"),r(21,"add"),n(),r(22," Add Role "),n()()(),i(23,"div",7)(24,"mat-card",8)(25,"mat-card-header")(26,"mat-card-title"),r(27,"Roles"),n()(),i(28,"mat-card-content"),f(29,Ie,21,2,"div",9),i(30,"table",10),w(31,11),f(32,Be,2,0,"th",12)(33,Ae,4,2,"td",13),M(),w(34,14),f(35,$e,2,0,"th",15)(36,je,4,1,"td",13),M(),w(37,16),f(38,qe,1,0,"th",15)(39,Qe,7,0,"td",13),M(),f(40,Ge,1,0,"tr",17)(41,ze,1,0,"tr",18),n()()(),i(42,"mat-card",19)(43,"mat-card-header")(44,"mat-card-title"),r(45,"Privileges"),n(),i(46,"button",20),p("click",function(){return c(a),d(o.showAddPrivilege=!0)}),i(47,"mat-icon"),r(48,"add"),n()()(),i(49,"mat-card-content"),f(50,Ue,15,1,"div",21),i(51,"div",22),b(52,Ke,8,3,"div",23,D),n()()()()()}l&2&&(s(29),x(o.showAddRole?29:-1),s(),_("dataSource",o.rolesDataSource),s(10),_("matHeaderRowDef",o.rolesColumns),s(),_("matRowDefColumns",o.rolesColumns),s(9),x(o.showAddPrivilege?50:-1),s(2),R(o.privileges))},dependencies:[B,G,H,A,$,N,z,j,q,ie,Y,ee,te,Z,Ee,ge,Ce,be,he,ve,Re,xe,Se,we,Me,Pe,Ve,E,Fe,re,oe,ne,ae,le,X,W,K,J,U,_e,fe,me,se,O,ue,de],styles:[".role-list-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:1rem}.add-role-form[_ngcontent-%COMP%], .add-privilege-form[_ngcontent-%COMP%]{background:#f5f5f5;padding:1rem;border-radius:4px;margin-bottom:1rem}.form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:.5rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}.data-table[_ngcontent-%COMP%]{width:100%}.description[_ngcontent-%COMP%]{font-size:.75rem;color:#666}.more[_ngcontent-%COMP%]{font-size:.75rem;color:#666;margin-left:.25rem}.privilege-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.privilege-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border-bottom:1px solid #eee}.privilege-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.privilege-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.privilege-info[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:.75rem;color:#666}"]})}return t})();export{Mt as RoleListComponent};
