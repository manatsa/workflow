import{a as Et}from"./chunk-KCZEURGJ.js";import{b as bt,c as ht,d as St}from"./chunk-NCIUZOAL.js";import{a as U}from"./chunk-EZFPBO3O.js";import{a as tt,b as et,c as nt,d as it}from"./chunk-GTA6LP7E.js";import{a as Y,b as Z}from"./chunk-RORH5LGT.js";import{c as at,h as ot}from"./chunk-K3UXCVE5.js";import{b as lt}from"./chunk-L6PTED5A.js";import{a as Q,b as X}from"./chunk-D7HGT47B.js";import{a as dt,b as st,c as pt,d as _t,e as ft,f as ut,g as Ct,h as gt,i as xt,j as vt,k as Mt}from"./chunk-XSCQ4HOZ.js";import{a as mt}from"./chunk-3AZ62B2F.js";import"./chunk-2HMVGF7U.js";import{b as rt,c as ct}from"./chunk-LNAKRYVP.js";import"./chunk-3WEQTSJY.js";import"./chunk-W7HGFPQV.js";import"./chunk-MFE2U5AV.js";import{a as G,b as W,c as q,f as J,h as K}from"./chunk-XRACF4N4.js";import"./chunk-KNH3VKXQ.js";import"./chunk-OWVO723I.js";import{a as R,c as F,d as B,g as V}from"./chunk-GMPFJIFP.js";import{l as A,p as L,ta as N,ua as j,va as H,wa as z,ya as $}from"./chunk-ZJGSEVKG.js";import{Cb as u,Fb as x,Hb as p,Kb as E,Lb as w,Mb as n,Nb as i,Ob as v,Pb as M,Qb as b,Sb as h,Wb as S,Xb as s,cb as l,ec as y,fc as o,gc as m,hb as f,hc as D,ic as P,oa as C,ob as T,pa as g,pc as O,rc as I,tc as k,ub as d}from"./chunk-BMOUMNDR.js";var kt=t=>["/approvals",t],Tt=(t,r)=>r.fieldName,wt=(t,r)=>r.id;function yt(t,r){t&1&&(n(0,"div",2),v(1,"mat-spinner",3),i())}function Pt(t,r){if(t&1){let e=h();n(0,"button",25),S("click",function(){C(e);let c=s(2);return g(c.editSubmission())}),n(1,"mat-icon"),o(2,"edit"),i(),n(3,"span"),o(4,"Edit Submission"),i()()}}function Ot(t,r){if(t&1){let e=h();n(0,"button",25),S("click",function(){C(e);let c=s(2);return g(c.deleteSubmission())}),n(1,"mat-icon"),o(2,"delete"),i(),n(3,"span"),o(4,"Delete Submission"),i()()}}function At(t,r){if(t&1&&(n(0,"div",15)(1,"span",16),o(2,"Current Approval Level"),i(),n(3,"span",17),o(4),i()()),t&2){let e=s(2);l(4),D("Level ",e.instance.currentApprovalLevel,"")}}function Lt(t,r){if(t&1&&(n(0,"div",15)(1,"span",16),o(2),i(),n(3,"span",17),o(4),i()()),t&2){let e=r.$implicit;l(2),m(e.fieldLabel),l(2),m(e.value||"-")}}function Rt(t,r){if(t&1&&(v(0,"mat-divider"),n(1,"div",15)(2,"span",16),o(3,"Comments"),i(),n(4,"span",17),o(5),i()()),t&2){let e=s(2);l(5),m(e.instance.comments)}}function Ft(t,r){if(t&1){let e=h();n(0,"div",27)(1,"mat-icon"),o(2,"description"),i(),n(3,"span",28),o(4),i(),n(5,"span",29),o(6),i(),n(7,"button",5),S("click",function(){let c=C(e).$implicit,_=s(3);return g(_.downloadAttachment(c))}),n(8,"mat-icon"),o(9,"download"),i()()()}if(t&2){let e=r.$implicit,a=s(3);l(4),m(e.originalFileName),l(2),D("(",a.formatFileSize(e.fileSize),")")}}function Bt(t,r){if(t&1&&(n(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),o(3,"Attachments"),i()(),n(4,"mat-card-content")(5,"div",26),E(6,Ft,10,2,"div",27,wt),i()()()),t&2){let e=s(2);l(6),w(e.instance.attachments)}}function Vt(t,r){t&1&&(n(0,"div",20)(1,"mat-icon"),o(2,"history"),i(),n(3,"p"),o(4,"No approval actions yet"),i()())}function Nt(t,r){t&1&&(n(0,"mat-icon"),o(1,"check"),i())}function jt(t,r){t&1&&(n(0,"mat-icon"),o(1,"close"),i())}function Ht(t,r){t&1&&(n(0,"mat-icon"),o(1,"arrow_upward"),i())}function zt(t,r){t&1&&(n(0,"mat-icon"),o(1,"pending"),i())}function $t(t,r){if(t&1&&(n(0,"div",35),o(1),i()),t&2){let e=s().$implicit;l(),D(' "',e.comments,'" ')}}function Ut(t,r){if(t&1&&(n(0,"div",30)(1,"div",31),d(2,Nt,2,0,"mat-icon")(3,jt,2,0,"mat-icon")(4,Ht,2,0,"mat-icon")(5,zt,2,0,"mat-icon"),i(),n(6,"div",32)(7,"div",33)(8,"strong"),o(9),i(),n(10,"span",8),o(11),i()(),n(12,"div",34),o(13),I(14,"date"),i(),d(15,$t,2,1,"div",35),i()()),t&2){let e,a=r.$implicit;l(),x(a.action.toLowerCase()),l(),p((e=a.action)==="APPROVED"?2:e==="REJECTED"?3:e==="ESCALATED"?4:5),l(7),m(a.approverName),l(),x(a.action.toLowerCase()),l(),m(a.action),l(2),P(" Level ",a.level," - ",k(14,10,a.createdAt,"medium")," "),l(2),p(a.comments?15:-1)}}function Gt(t,r){if(t&1&&(n(0,"div",21),E(1,Ut,16,13,"div",30,wt),i()),t&2){let e=s(2);l(),w(e.approvalHistory)}}function Wt(t,r){t&1&&(n(0,"div",20)(1,"mat-icon"),o(2,"receipt_long"),i(),n(3,"p"),o(4,"No audit logs available"),i()())}function qt(t,r){t&1&&(n(0,"th",44),o(1,"Date"),i())}function Jt(t,r){if(t&1&&(n(0,"td",45),o(1),I(2,"date"),i()),t&2){let e=r.$implicit;l(),m(k(2,1,e.createdAt,"medium"))}}function Kt(t,r){t&1&&(n(0,"th",44),o(1,"Action"),i())}function Qt(t,r){if(t&1&&(n(0,"td",45)(1,"span",8),o(2),i()()),t&2){let e=r.$implicit;l(2),m(e.action)}}function Xt(t,r){t&1&&(n(0,"th",44),o(1,"User"),i())}function Yt(t,r){if(t&1&&(n(0,"td",45),o(1),i()),t&2){let e=r.$implicit;l(),m(e.performedBy)}}function Zt(t,r){t&1&&(n(0,"th",44),o(1,"Details"),i())}function te(t,r){if(t&1&&(n(0,"td",45),o(1),i()),t&2){let e=r.$implicit;l(),m(e.details)}}function ee(t,r){t&1&&v(0,"tr",46)}function ne(t,r){t&1&&v(0,"tr",47)}function ie(t,r){if(t&1&&(n(0,"table",23),M(1,36),d(2,qt,2,0,"th",37)(3,Jt,3,4,"td",38),b(),M(4,39),d(5,Kt,2,0,"th",37)(6,Qt,3,1,"td",38),b(),M(7,40),d(8,Xt,2,0,"th",37)(9,Yt,2,1,"td",38),b(),M(10,41),d(11,Zt,2,0,"th",37)(12,te,2,1,"td",38),b(),d(13,ee,1,0,"tr",42)(14,ne,1,0,"tr",43),i()),t&2){let e=s(2);u("dataSource",e.auditLogs),l(13),u("matHeaderRowDef",e.auditColumns),l(),u("matRowDefColumns",e.auditColumns)}}function ae(t,r){if(t&1&&(n(0,"div",24)(1,"button",48)(2,"mat-icon"),o(3,"approval"),i(),o(4," Review & Approve "),i()()),t&2){let e=s(2);l(),u("routerLink",O(1,kt,e.instance.id))}}function oe(t,r){if(t&1){let e=h();n(0,"div",4)(1,"button",5),S("click",function(){C(e);let c=s();return g(c.goBack())}),n(2,"mat-icon"),o(3,"arrow_back"),i()(),n(4,"div",6)(5,"h1"),o(6),i(),n(7,"p",7),o(8),i()(),n(9,"span",8),o(10),i(),n(11,"button",9)(12,"mat-icon"),o(13,"more_vert"),i()(),n(14,"mat-menu",null,0),d(16,Pt,5,0,"button",10)(17,Ot,5,0,"button",10),i()(),n(18,"mat-tab-group")(19,"mat-tab",11)(20,"div",12)(21,"div",13)(22,"mat-card",14)(23,"mat-card-header")(24,"mat-card-title"),o(25,"Submission Info"),i()(),n(26,"mat-card-content")(27,"div",15)(28,"span",16),o(29,"Reference Number"),i(),n(30,"span",17),o(31),i()(),n(32,"div",15)(33,"span",16),o(34,"Submitted By"),i(),n(35,"span",17),o(36),i()(),n(37,"div",15)(38,"span",16),o(39,"Submitted At"),i(),n(40,"span",17),o(41),I(42,"date"),i()(),n(43,"div",15)(44,"span",16),o(45,"Status"),i(),n(46,"span",8),o(47),i()(),d(48,At,5,1,"div",15),i()(),n(49,"mat-card",18)(50,"mat-card-header")(51,"mat-card-title"),o(52,"Form Data"),i()(),n(53,"mat-card-content"),E(54,Lt,5,2,"div",15,Tt),d(56,Rt,6,1),i()()(),d(57,Bt,8,0,"mat-card"),i()(),n(58,"mat-tab",19)(59,"div",12)(60,"mat-card")(61,"mat-card-content"),d(62,Vt,5,0,"div",20)(63,Gt,3,0,"div",21),i()()()(),n(64,"mat-tab",22)(65,"div",12)(66,"mat-card")(67,"mat-card-content"),d(68,Wt,5,0,"div",20)(69,ie,15,3,"table",23),i()()()()(),d(70,ae,5,3,"div",24)}if(t&2){let e=y(15),a=s();l(6),m(a.instance.referenceNumber),l(2),m(a.instance.workflowName),l(),x(a.instance.status.toLowerCase()),l(),m(a.instance.status),l(),u("matMenuTriggerFor",e),l(5),p(a.canEdit?16:-1),l(),p(a.canDelete?17:-1),l(14),m(a.instance.referenceNumber),l(5),m(a.instance.initiatorName),l(5),m(k(42,20,a.instance.createdAt,"medium")),l(5),x(a.instance.status.toLowerCase()),l(),m(a.instance.status),l(),p(a.instance.status==="PENDING"?48:-1),l(6),w(a.getFieldValuesArray()),l(2),p(a.instance.comments?56:-1),l(),p(a.instance.attachments&&a.instance.attachments.length>0?57:-1),l(5),p(a.approvalHistory.length===0?62:63),l(6),p(a.auditLogs.length===0?68:69),l(2),p(a.canTakeAction?70:-1)}}var Re=(()=>{class t{workflowService;settingService;route;router;dialog;snackBar;instance=null;approvalHistory=[];auditLogs=[];loading=!0;canTakeAction=!1;canEdit=!1;canDelete=!1;auditColumns=["createdAt","action","performedBy","details"];getFieldValuesArray(){return this.instance?.fieldValues?Array.isArray(this.instance.fieldValues)?this.instance.fieldValues:Object.entries(this.instance.fieldValues).map(([e,a])=>({fieldName:e,fieldLabel:e,value:a})):[]}constructor(e,a,c,_,Dt,It){this.workflowService=e,this.settingService=a,this.route=c,this.router=_,this.dialog=Dt,this.snackBar=It}ngOnInit(){let e=this.route.snapshot.paramMap.get("instanceId");e&&this.loadInstance(e)}loadInstance(e){this.workflowService.getInstance(e).subscribe({next:a=>{this.loading=!1,a.success&&(this.instance=a.data,this.approvalHistory=a.data.approvalHistory||[],this.canTakeAction=a.data.status==="PENDING",this.canEdit=a.data.status==="DRAFT"||a.data.status==="RECALLED",this.canDelete=a.data.status==="DRAFT"||a.data.status==="RECALLED",this.loadAuditLogs(e))},error:()=>{this.loading=!1}})}loadAuditLogs(e){this.settingService.getAuditLogs("WorkflowInstance",e).subscribe(a=>{a.success&&(this.auditLogs=a.data)})}goBack(){this.instance?this.router.navigate(["/workflows",this.instance.workflowCode,"instances"]):this.router.navigate(["/dashboard"])}formatFileSize(e){if(e===0)return"0 Bytes";let a=1024,c=["Bytes","KB","MB","GB"],_=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,_)).toFixed(2))+" "+c[_]}downloadAttachment(e){this.workflowService.downloadAttachment(e.id).subscribe(a=>{let c=window.URL.createObjectURL(a),_=document.createElement("a");_.href=c,_.download=e.originalFileName,_.click(),window.URL.revokeObjectURL(c)})}editSubmission(){this.instance&&this.router.navigate(["/workflows",this.instance.workflowCode,"submit"],{queryParams:{edit:this.instance.id}})}deleteSubmission(){if(!this.instance)return;this.dialog.open(Et,{width:"400px",data:{title:"Delete Submission",message:`Are you sure you want to delete submission "${this.instance.referenceNumber}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed().subscribe(a=>{a&&this.instance&&this.workflowService.deleteInstance(this.instance.id).subscribe({next:c=>{c.success&&(this.snackBar.open("Submission deleted successfully","Close",{duration:3e3}),this.router.navigate(["/my-submissions"]))},error:()=>{this.snackBar.open("Failed to delete submission","Close",{duration:3e3})}})})}static \u0275fac=function(a){return new(a||t)(f(mt),f(U),f(R),f(F),f(at),f(rt))};static \u0275cmp=T({type:t,selectors:[["app-instance-detail"]],decls:3,vars:1,consts:[["actionsMenu","matMenu"],[1,"instance-detail-container"],[1,"loading"],["diameter","40"],[1,"header"],["mat-icon-button","",3,"click"],[1,"header-info"],[1,"subtitle"],[1,"badge"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item",""],["label","Details"],[1,"tab-content"],[1,"details-grid"],[1,"info-card"],[1,"info-row"],[1,"label"],[1,"value"],[1,"data-card"],["label","Approval History"],[1,"empty-state"],[1,"timeline"],["label","Audit"],["mat-table","",1,"audit-table",3,"dataSource"],[1,"action-bar"],["mat-menu-item","",3,"click"],[1,"attachments-list"],[1,"attachment-item"],[1,"name"],[1,"size"],[1,"timeline-item"],[1,"timeline-marker"],[1,"timeline-content"],[1,"timeline-header"],[1,"timeline-meta"],[1,"timeline-comments"],["matColumnDef","createdAt"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["matColumnDef","performedBy"],["matColumnDef","details"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],["mat-raised-button","","color","primary",3,"routerLink"]],template:function(a,c){a&1&&(n(0,"div",1),d(1,yt,2,0,"div",2)(2,oe,71,23),i()),a&2&&(l(),p(c.loading?1:c.instance?2:-1))},dependencies:[L,A,V,B,K,G,q,J,W,St,bt,ht,$,z,H,j,N,lt,Mt,dt,pt,Ct,_t,st,gt,ft,ut,xt,vt,Z,Y,X,Q,it,et,tt,nt,ot,ct],styles:[".instance-detail-container[_ngcontent-%COMP%]{padding:1rem;max-width:1200px;margin:0 auto}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.header-info[_ngcontent-%COMP%]{flex:1}.header-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.tab-content[_ngcontent-%COMP%]{padding:1rem 0}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #eee}.info-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#666;font-size:.875rem}.info-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.badge.recalled[_ngcontent-%COMP%]{background:#fce4ec;color:#c2185b}.badge.cancelled[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.badge.on_hold[_ngcontent-%COMP%]{background:#fff8e1;color:#f57f17}.attachments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.attachment-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px}.attachment-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.attachment-item[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{color:#666;font-size:.75rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.timeline[_ngcontent-%COMP%]{padding:1rem 0}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem 0}.timeline-marker[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#f5f5f5}.timeline-marker.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.timeline-marker.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.timeline-marker.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.timeline-content[_ngcontent-%COMP%]{flex:1}.timeline-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.timeline-meta[_ngcontent-%COMP%]{font-size:.75rem;color:#666;margin-top:.25rem}.timeline-comments[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px;font-style:italic}.audit-table[_ngcontent-%COMP%]{width:100%}.action-bar[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding:1rem 0;margin-top:1rem;border-top:1px solid #eee}"]})}return t})();export{Re as InstanceDetailComponent};
