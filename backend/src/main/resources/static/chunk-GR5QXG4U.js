import{c as Pe,g as ke}from"./chunk-SHMTZN3K.js";import"./chunk-MS4AQ6UA.js";import{c as Se,d as Re,e as w,f as be,g as we}from"./chunk-JR55QIKH.js";import{a as Ee,b as ye}from"./chunk-OJT3OVWQ.js";import{a as xe,b as Me}from"./chunk-M4AVZ6G2.js";import{c as I}from"./chunk-5LBLILVL.js";import"./chunk-LAGNR76Q.js";import{a as re,b as le,c as ae,d as me,e as se,f as de,g as ce,h as pe,i as ue,j as fe,k as _e,l as ge}from"./chunk-FEDFXP2D.js";import"./chunk-T6FL6ZBG.js";import{a as he}from"./chunk-YFSTPTS4.js";import{a as ve,b as Ce}from"./chunk-AIS23OW2.js";import{a as ie,c as ne,d as oe}from"./chunk-XZVKBWV7.js";import{b as ee,i as te}from"./chunk-IGML5J3D.js";import"./chunk-DLMMVLF7.js";import"./chunk-X4PFBHKL.js";import"./chunk-ORAJKTE5.js";import{b as V,d as D,f as O,g as A,j as B,l as $,m as N,o as H,p as j,q}from"./chunk-DUSDXFBS.js";import{a as K,b as W,c as X,f as Y,h as Z}from"./chunk-PWNKGTLH.js";import"./chunk-PSOPTTCW.js";import"./chunk-NMO4AZKI.js";import{m as L,qa as Q,ra as G,sa as z,ta as U,va as J}from"./chunk-A3I6STGM.js";import{$b as P,Ab as _,Fb as C,Ib as M,Jb as S,Kb as i,Lb as n,Mb as g,Nb as R,Ob as b,Qb as x,Ub as p,Vb as d,Zb as E,_b as y,bb as a,dc as r,ec as v,fc as k,gb as h,na as u,nb as T,oa as f,tb as c}from"./chunk-2HR56SRD.js";var F=(t,m)=>m.id;function De(t,m){if(t&1&&(i(0,"mat-option",25),r(1),n()),t&2){let e=m.$implicit;_("value",e.id),a(),v(e.name)}}function Fe(t,m){if(t&1){let e=x();i(0,"div",5)(1,"form",20),p("ngSubmit",function(){u(e);let o=d();return f(o.saveRole())}),i(2,"mat-form-field",21)(3,"mat-label"),r(4,"Role Name"),n(),g(5,"input",22),n(),i(6,"mat-form-field",21)(7,"mat-label"),r(8,"Description"),n(),g(9,"input",23),n(),i(10,"mat-form-field",21)(11,"mat-label"),r(12,"Privileges"),n(),i(13,"mat-select",24),M(14,De,2,2,"mat-option",25,F),n()(),i(16,"div",26)(17,"button",27),p("click",function(){u(e);let o=d();return f(o.cancelEdit())}),r(18,"Cancel"),n(),i(19,"button",28),r(20),n()()()()}if(t&2){let e=d();a(),_("formGroup",e.roleForm),a(13),S(e.privileges),a(6),k(" ",e.editingRole?"Update":"Create"," ")}}function Te(t,m){t&1&&(i(0,"th",29),r(1,"Name"),n())}function Le(t,m){if(t&1&&(i(0,"div",31),r(1),n()),t&2){let e=d().$implicit;a(),v(e.description)}}function Ie(t,m){if(t&1&&(i(0,"td",30)(1,"strong"),r(2),n(),c(3,Le,2,1,"div",31),n()),t&2){let e=m.$implicit;a(2),v(e.name),a(),C(e.description?3:-1)}}function Ve(t,m){t&1&&(i(0,"th",32),r(1,"Privileges"),n())}function Oe(t,m){if(t&1&&(i(0,"mat-chip"),r(1),n()),t&2){let e=m.$implicit;a(),v(e.name)}}function Ae(t,m){if(t&1&&(i(0,"span",33),r(1),n()),t&2){let e=d().$implicit;a(),k("+",e.privileges.length-3," more")}}function Be(t,m){if(t&1&&(i(0,"td",30),M(1,Oe,2,1,"mat-chip",null,F),c(3,Ae,2,1,"span",33),n()),t&2){let e=m.$implicit;a(),S(e.privileges==null?null:e.privileges.slice(0,3)),a(2),C((e.privileges==null?null:e.privileges.length)>3?3:-1)}}function $e(t,m){t&1&&g(0,"th",32)}function Ne(t,m){if(t&1){let e=x();i(0,"td",30)(1,"button",16),p("click",function(){let o=u(e).$implicit,s=d();return f(s.editRole(o))}),i(2,"mat-icon"),r(3,"edit"),n()(),i(4,"button",34),p("click",function(){let o=u(e).$implicit,s=d();return f(s.deleteRole(o))}),i(5,"mat-icon"),r(6,"delete"),n()()()}}function He(t,m){t&1&&g(0,"tr",35)}function je(t,m){t&1&&g(0,"tr",36)}function qe(t,m){if(t&1){let e=x();i(0,"div",17)(1,"form",20),p("ngSubmit",function(){u(e);let o=d();return f(o.savePrivilege())}),i(2,"mat-form-field",21)(3,"mat-label"),r(4,"Privilege Name"),n(),g(5,"input",22),n(),i(6,"mat-form-field",21)(7,"mat-label"),r(8,"Description"),n(),g(9,"input",23),n(),i(10,"div",26)(11,"button",27),p("click",function(){u(e);let o=d();return f(o.showAddPrivilege=!1)}),r(12,"Cancel"),n(),i(13,"button",28),r(14,"Create"),n()()()()}if(t&2){let e=d();a(),_("formGroup",e.privilegeForm)}}function Qe(t,m){if(t&1&&(i(0,"span",31),r(1),n()),t&2){let e=d().$implicit;a(),v(e.description)}}function Ge(t,m){if(t&1){let e=x();i(0,"div",19)(1,"div",37)(2,"strong"),r(3),n(),c(4,Qe,2,1,"span",31),n(),i(5,"button",38),p("click",function(){let o=u(e).$implicit,s=d();return f(s.deletePrivilege(o))}),i(6,"mat-icon"),r(7,"delete"),n()()()}if(t&2){let e=m.$implicit;a(3),v(e.name),a(),C(e.description?4:-1),a(),_("disabled",e.name==="ADMIN")}}var xt=(()=>{class t{fb;userService;snackBar;dialog;rolesColumns=["name","privileges","actions"];rolesDataSource=new ge([]);privileges=[];showAddRole=!1;showAddPrivilege=!1;editingRole=null;roleForm;privilegeForm;paginator;sort;constructor(e,l,o,s){this.fb=e,this.userService=l,this.snackBar=o,this.dialog=s,this.roleForm=this.fb.group({name:["",D.required],description:[""],privilegeIds:[[]]}),this.privilegeForm=this.fb.group({name:["",D.required],description:[""]})}ngOnInit(){this.loadRoles(),this.loadPrivileges()}ngAfterViewInit(){this.rolesDataSource.paginator=this.paginator,this.rolesDataSource.sort=this.sort}loadRoles(){this.userService.getRoles().subscribe(e=>{e.success&&(this.rolesDataSource.data=e.data)})}loadPrivileges(){this.userService.getPrivileges().subscribe(e=>{e.success&&(this.privileges=e.data)})}editRole(e){this.editingRole=e,this.showAddRole=!0,this.roleForm.patchValue({name:e.name,description:e.description,privilegeIds:e.privilegeIds||[]})}cancelEdit(){this.showAddRole=!1,this.editingRole=null,this.roleForm.reset()}saveRole(){if(this.roleForm.invalid)return;let e=this.roleForm.value;(this.editingRole?this.userService.updateRole(this.editingRole.id,e):this.userService.createRole(e)).subscribe({next:o=>{o.success&&(this.snackBar.open(this.editingRole?"Role updated successfully":"Role created successfully","Close",{duration:3e3}),this.cancelEdit(),this.loadRoles())},error:o=>{this.snackBar.open(o.error?.message||"Operation failed","Close",{duration:3e3})}})}deleteRole(e){confirm(`Are you sure you want to delete the role "${e.name}"?`)&&this.userService.deleteRole(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Role deleted successfully","Close",{duration:3e3}),this.loadRoles())},error:l=>{this.snackBar.open(l.error?.message||"Failed to delete role","Close",{duration:3e3})}})}savePrivilege(){this.privilegeForm.invalid||this.userService.createPrivilege(this.privilegeForm.value).subscribe({next:e=>{e.success&&(this.snackBar.open("Privilege created successfully","Close",{duration:3e3}),this.showAddPrivilege=!1,this.privilegeForm.reset(),this.loadPrivileges())},error:e=>{this.snackBar.open(e.error?.message||"Failed to create privilege","Close",{duration:3e3})}})}deletePrivilege(e){if(e.name==="ADMIN"){this.snackBar.open("Cannot delete system privilege","Close",{duration:3e3});return}confirm(`Are you sure you want to delete the privilege "${e.name}"?`)&&this.userService.deletePrivilege(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Privilege deleted successfully","Close",{duration:3e3}),this.loadPrivileges())},error:l=>{this.snackBar.open(l.error?.message||"Failed to delete privilege","Close",{duration:3e3})}})}static \u0275fac=function(l){return new(l||t)(h(H),h(he),h(ve),h(Pe))};static \u0275cmp=T({type:t,selectors:[["app-role-list"]],viewQuery:function(l,o){if(l&1&&(E(Se,5),E(w,5)),l&2){let s;y(s=P())&&(o.paginator=s.first),y(s=P())&&(o.sort=s.first)}},decls:39,vars:5,consts:[[1,"role-list-container"],[1,"header"],["mat-raised-button","","color","primary",3,"click"],[1,"content-grid"],[1,"roles-card"],[1,"add-role-form"],["mat-table","","matSort","",1,"data-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","privileges"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"privileges-card"],["mat-icon-button","",3,"click"],[1,"add-privilege-form"],[1,"privilege-list"],[1,"privilege-item"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"form-field"],["matInput","","formControlName","name"],["matInput","","formControlName","description"],["formControlName","privilegeIds","multiple",""],[3,"value"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"description"],["mat-header-cell",""],[1,"more"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"privilege-info"],["mat-icon-button","","color","warn",3,"click","disabled"]],template:function(l,o){l&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),r(3,"Roles & Privileges"),n(),i(4,"button",2),p("click",function(){return o.showAddRole=!0}),i(5,"mat-icon"),r(6,"add"),n(),r(7," Add Role "),n()(),i(8,"div",3)(9,"mat-card",4)(10,"mat-card-header")(11,"mat-card-title"),r(12,"Roles"),n()(),i(13,"mat-card-content"),c(14,Fe,21,2,"div",5),i(15,"table",6),R(16,7),c(17,Te,2,0,"th",8)(18,Ie,4,2,"td",9),b(),R(19,10),c(20,Ve,2,0,"th",11)(21,Be,4,1,"td",9),b(),R(22,12),c(23,$e,1,0,"th",11)(24,Ne,7,0,"td",9),b(),c(25,He,1,0,"tr",13)(26,je,1,0,"tr",14),n()()(),i(27,"mat-card",15)(28,"mat-card-header")(29,"mat-card-title"),r(30,"Privileges"),n(),i(31,"button",16),p("click",function(){return o.showAddPrivilege=!0}),i(32,"mat-icon"),r(33,"add"),n()()(),i(34,"mat-card-content"),c(35,qe,15,1,"div",17),i(36,"div",18),M(37,Ge,8,3,"div",19,F),n()()()()()),l&2&&(a(14),C(o.showAddRole?14:-1),a(),_("dataSource",o.rolesDataSource),a(10),_("matHeaderRowDef",o.rolesColumns),a(),_("matRowDefColumns",o.rolesColumns),a(9),C(o.showAddPrivilege?35:-1),a(2),S(o.privileges))},dependencies:[L,j,B,V,O,A,q,$,N,Z,K,X,Y,W,_e,re,ae,ce,me,le,pe,se,de,ue,fe,Re,we,w,be,ie,te,ee,oe,ne,J,U,z,G,Q,ye,Ee,Me,xe,I,ke,Ce],styles:[".role-list-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:1rem}.add-role-form[_ngcontent-%COMP%], .add-privilege-form[_ngcontent-%COMP%]{background:#f5f5f5;padding:1rem;border-radius:4px;margin-bottom:1rem}.form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:.5rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}.data-table[_ngcontent-%COMP%]{width:100%}.description[_ngcontent-%COMP%]{font-size:.75rem;color:#666}.more[_ngcontent-%COMP%]{font-size:.75rem;color:#666;margin-left:.25rem}.privilege-list[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.privilege-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border-bottom:1px solid #eee}.privilege-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.privilege-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.privilege-info[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:.75rem;color:#666}"]})}return t})();export{xt as RoleListComponent};
