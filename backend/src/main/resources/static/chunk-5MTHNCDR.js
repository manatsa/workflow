import"./chunk-F5X5MWHG.js";import{a as Fe,b as Te}from"./chunk-G556JK2P.js";import"./chunk-MS4AQ6UA.js";import{a as Ie,b as ye}from"./chunk-ZCDPLTK7.js";import{a as Le}from"./chunk-2FXL3LXH.js";import{d as N}from"./chunk-C2RIDQE5.js";import{a as de,b as pe}from"./chunk-L6PTED5A.js";import"./chunk-NDFZT543.js";import{a as fe,b as _e,c as Ce,d as Se,e as be,f as xe,g as ge,h as Be,i as ve,j as we,k as Ee}from"./chunk-XSCQ4HOZ.js";import"./chunk-2HMVGF7U.js";import{a as Me}from"./chunk-42YYXDJQ.js";import{b as ue,c as he}from"./chunk-LNAKRYVP.js";import"./chunk-3WEQTSJY.js";import{b as re,c as ae,d as oe,i as le,j as me,l as ce,m as se}from"./chunk-W7HGFPQV.js";import{d as A,f as I,h as q,i as $,l as U,m as R,p as H,q as j,t as W,u as G,v as z}from"./chunk-MFE2U5AV.js";import{a as Z,b as ee,c as te,f as ie,h as ne}from"./chunk-XRACF4N4.js";import"./chunk-KNH3VKXQ.js";import"./chunk-OWVO723I.js";import{p as O,ta as J,ua as K,va as Q,wa as X,ya as Y}from"./chunk-ZJGSEVKG.js";import{Cb as u,Eb as P,Hb as x,Kb as w,Lb as E,Mb as n,Nb as t,Ob as S,Pb as g,Qb as B,Sb as y,Wb as f,Xb as b,cb as o,ec as D,fc as r,gc as C,hb as v,hc as M,jc as T,kc as L,lc as k,oa as d,ob as V,pa as p,ub as h}from"./chunk-BMOUMNDR.js";var F=(i,l)=>l.id;function ke(i,l){if(i&1&&(n(0,"mat-option",11),r(1),t()),i&2){let e=l.$implicit;u("value",e.id),o(),C(e.name)}}function Ve(i,l){if(i&1&&(n(0,"mat-option",11),r(1),t()),i&2){let e=l.$implicit;u("value",e.id),o(),C(e.name)}}function Pe(i,l){i&1&&(n(0,"th",28),r(1,"Code"),t())}function De(i,l){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=l.$implicit;o(),C(e.code)}}function Oe(i,l){i&1&&(n(0,"th",28),r(1,"Name"),t())}function Ne(i,l){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=l.$implicit;o(),C(e.name)}}function Ae(i,l){i&1&&(n(0,"th",28),r(1,"SBU"),t())}function qe(i,l){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=l.$implicit;o(),C(e.sbuName||"-")}}function $e(i,l){i&1&&(n(0,"th",28),r(1,"Corporate"),t())}function Ue(i,l){if(i&1&&(n(0,"td",29),r(1),t()),i&2){let e=l.$implicit;o(),C(e.corporateName||"-")}}function Re(i,l){i&1&&(n(0,"th",28),r(1,"Status"),t())}function He(i,l){if(i&1&&(n(0,"td",29)(1,"mat-chip",30),r(2),t()()),i&2){let e=l.$implicit;o(),u("color",e.isActive?"primary":"warn"),o(),M(" ",e.isActive?"Active":"Inactive"," ")}}function je(i,l){i&1&&(n(0,"th",28),r(1,"Actions"),t())}function We(i,l){if(i&1){let e=y();n(0,"td",29)(1,"button",31),f("click",function(){let a=d(e).$implicit,c=b();return p(c.editBranch(a))}),n(2,"mat-icon"),r(3,"edit"),t()(),n(4,"button",32),f("click",function(){let a=d(e).$implicit,c=b();return p(c.toggleStatus(a))}),n(5,"mat-icon"),r(6),t()(),n(7,"button",33),f("click",function(){let a=d(e).$implicit,c=b();return p(c.deleteBranch(a))}),n(8,"mat-icon"),r(9,"delete"),t()()()}if(i&2){let e=l.$implicit;o(4),u("matTooltip",e.isActive?"Deactivate":"Activate"),o(2),C(e.isActive?"visibility_off":"visibility")}}function Ge(i,l){i&1&&S(0,"tr",34)}function ze(i,l){i&1&&S(0,"tr",35)}function Je(i,l){i&1&&(n(0,"div",26)(1,"mat-icon"),r(2,"store"),t(),n(3,"p"),r(4,"No branches found. Add your first branch."),t()())}function Ke(i,l){i&1&&(n(0,"mat-error"),r(1,"Code is required"),t())}function Qe(i,l){i&1&&(n(0,"mat-error"),r(1,"Name is required"),t())}function Xe(i,l){if(i&1&&(n(0,"mat-option",11),r(1),t()),i&2){let e=l.$implicit;u("value",e.id),o(),C(e.name)}}function Ye(i,l){if(i&1&&r(0),i&2){let e=b().$implicit;M(" (",e.corporateName,") ")}}function Ze(i,l){if(i&1&&(n(0,"mat-option",11),r(1),h(2,Ye,1,1),t()),i&2){let e=l.$implicit;u("value",e.id),o(),M("",e.name," "),o(),x(e.corporateName?2:-1)}}function et(i,l){i&1&&(n(0,"mat-error"),r(1,"SBU is required"),t())}function tt(i,l){i&1&&(n(0,"mat-error"),r(1,"Invalid email format"),t())}function it(i,l){if(i&1){let e=y();n(0,"mat-card",27)(1,"mat-card-header")(2,"mat-card-title"),r(3),t()(),n(4,"mat-card-content")(5,"form",36),f("ngSubmit",function(){d(e);let a=b();return p(a.saveBranch())}),n(6,"div",37)(7,"mat-form-field",38)(8,"mat-label"),r(9,"Code"),t(),S(10,"input",39),h(11,Ke,2,0,"mat-error"),t(),n(12,"mat-form-field",38)(13,"mat-label"),r(14,"Name"),t(),S(15,"input",40),h(16,Qe,2,0,"mat-error"),t()(),n(17,"mat-form-field",41)(18,"mat-label"),r(19,"Corporate (Optional Filter)"),t(),n(20,"mat-select",42),f("selectionChange",function(){d(e);let a=b();return p(a.onFormCorporateChange())}),n(21,"mat-option",11),r(22,"-- Select to filter SBUs --"),t(),w(23,Xe,2,2,"mat-option",11,F),t(),n(25,"mat-hint"),r(26,"Select to filter available SBUs"),t()(),n(27,"mat-form-field",41)(28,"mat-label"),r(29,"SBU"),t(),n(30,"mat-select",43)(31,"mat-option",11),r(32,"-- Select SBU --"),t(),w(33,Ze,3,3,"mat-option",11,F),t(),h(35,et,2,0,"mat-error"),t(),n(36,"mat-form-field",41)(37,"mat-label"),r(38,"Description"),t(),S(39,"textarea",44),t(),n(40,"mat-form-field",41)(41,"mat-label"),r(42,"Address"),t(),S(43,"textarea",45),t(),n(44,"div",37)(45,"mat-form-field",38)(46,"mat-label"),r(47,"Contact Email"),t(),S(48,"input",46),h(49,tt,2,0,"mat-error"),t(),n(50,"mat-form-field",38)(51,"mat-label"),r(52,"Contact Phone"),t(),S(53,"input",47),t()(),n(54,"div",48)(55,"button",49),f("click",function(){d(e);let a=b();return p(a.showForm=!1)}),r(56,"Cancel"),t(),n(57,"button",50),r(58),t()()()()()}if(i&2){let e,m,a,c,s=b();o(3),C(s.editingBranch?"Edit Branch":"Add Branch"),o(2),u("formGroup",s.branchForm),o(6),x((e=s.branchForm.get("code"))!=null&&e.hasError("required")?11:-1),o(5),x((m=s.branchForm.get("name"))!=null&&m.hasError("required")?16:-1),o(5),u("value",null),o(2),E(s.corporates),o(8),u("value",null),o(2),E(s.formSbus),o(2),x((a=s.branchForm.get("sbuId"))!=null&&a.hasError("required")?35:-1),o(14),x((c=s.branchForm.get("contactEmail"))!=null&&c.hasError("email")?49:-1),o(8),u("disabled",s.loading||s.branchForm.invalid),o(),M(" ",s.editingBranch?"Update":"Create"," ")}}var Ft=(()=>{class i{fb;userService;importExportService;snackBar;branches=[];displayedBranches=[];corporates=[];allSbus=[];filteredSbus=[];formSbus=[];displayedColumns=["code","name","sbu","corporate","status","actions"];showForm=!1;editingBranch=null;loading=!1;branchForm;filterCorporateId=null;filterSbuId=null;constructor(e,m,a,c){this.fb=e,this.userService=m,this.importExportService=a,this.snackBar=c,this.branchForm=this.fb.group({code:["",I.required],name:["",I.required],description:[""],address:[""],corporateId:[null],sbuId:[null,I.required],contactEmail:["",I.email],contactPhone:[""]})}ngOnInit(){this.loadBranches(),this.loadCorporates(),this.loadSbus()}loadBranches(){this.userService.getBranches().subscribe(e=>{e.success&&(this.branches=e.data,this.applyFilters())})}loadCorporates(){this.userService.getActiveCorporates().subscribe(e=>{e.success&&(this.corporates=e.data)})}loadSbus(){this.userService.getSBUs().subscribe(e=>{e.success&&(this.allSbus=e.data,this.filteredSbus=[...this.allSbus],this.formSbus=[...this.allSbus])})}onFilterCorporateChange(){this.filterCorporateId?this.filteredSbus=this.allSbus.filter(e=>e.corporateId===this.filterCorporateId):this.filteredSbus=[...this.allSbus],this.filterSbuId=null,this.applyFilters()}applyFilters(){let e=[...this.branches];this.filterCorporateId&&(e=e.filter(m=>m.corporateId===this.filterCorporateId)),this.filterSbuId&&(e=e.filter(m=>m.sbuId===this.filterSbuId)),this.displayedBranches=e}clearFilters(){this.filterCorporateId=null,this.filterSbuId=null,this.filteredSbus=[...this.allSbus],this.applyFilters()}openNewForm(){this.showForm=!0,this.editingBranch=null,this.branchForm.reset(),this.formSbus=[...this.allSbus]}onFormCorporateChange(){let e=this.branchForm.get("corporateId")?.value;e?this.formSbus=this.allSbus.filter(m=>m.corporateId===e):this.formSbus=[...this.allSbus],this.branchForm.patchValue({sbuId:null})}editBranch(e){this.editingBranch=e,this.showForm=!0,e.corporateId?this.formSbus=this.allSbus.filter(m=>m.corporateId===e.corporateId):this.formSbus=[...this.allSbus],this.branchForm.patchValue({code:e.code,name:e.name,description:e.description,address:e.address,corporateId:e.corporateId||null,sbuId:e.sbuId,contactEmail:e.contactEmail,contactPhone:e.contactPhone})}saveBranch(){if(this.branchForm.invalid)return;this.loading=!0;let e=this.branchForm.value,m={code:e.code,name:e.name,description:e.description,address:e.address,sbuId:e.sbuId,contactEmail:e.contactEmail,contactPhone:e.contactPhone};(this.editingBranch?this.userService.updateBranch(this.editingBranch.id,m):this.userService.createBranch(m)).subscribe({next:c=>{this.loading=!1,c.success&&(this.snackBar.open(this.editingBranch?"Branch updated":"Branch created","Close",{duration:3e3}),this.showForm=!1,this.editingBranch=null,this.branchForm.reset(),this.loadBranches())},error:c=>{this.loading=!1,this.snackBar.open(c.error?.message||"Operation failed","Close",{duration:3e3})}})}toggleStatus(e){(e.isActive?this.userService.deactivateBranch(e.id):this.userService.activateBranch(e.id)).subscribe({next:()=>{this.snackBar.open(e.isActive?"Branch deactivated":"Branch activated","Close",{duration:3e3}),this.loadBranches()},error:a=>{this.snackBar.open(a.error?.message||"Operation failed","Close",{duration:3e3})}})}deleteBranch(e){confirm(`Are you sure you want to delete "${e.name}"?`)&&this.userService.deleteBranch(e.id).subscribe({next:()=>{this.snackBar.open("Branch deleted","Close",{duration:3e3}),this.loadBranches()},error:m=>{this.snackBar.open(m.error?.message||"Failed to delete","Close",{duration:3e3})}})}downloadTemplate(){this.importExportService.downloadTemplate("branches").subscribe({next:e=>{this.importExportService.downloadFile(e,"Branches_Template.xlsx"),this.snackBar.open("Template downloaded","Close",{duration:3e3})},error:()=>this.snackBar.open("Failed to download template","Close",{duration:3e3})})}importFromExcel(e){let m=e.target;if(!m.files?.length)return;let a=m.files[0];this.importExportService.importFromExcel("branches",a).subscribe({next:c=>{c.success?(this.snackBar.open(c.message||"Branches imported","Close",{duration:3e3}),this.loadBranches()):this.snackBar.open(c.message||"Failed to import","Close",{duration:3e3}),m.value=""},error:c=>{this.snackBar.open(c.error?.message||"Failed to import","Close",{duration:3e3}),m.value=""}})}exportToExcel(){this.importExportService.exportToExcel("branches").subscribe({next:e=>{this.importExportService.downloadFile(e,"Branches_Export.xlsx"),this.snackBar.open("Branches exported","Close",{duration:3e3})},error:()=>this.snackBar.open("Failed to export","Close",{duration:3e3})})}static \u0275fac=function(m){return new(m||i)(v(W),v(Me),v(Le),v(ue))};static \u0275cmp=V({type:i,selectors:[["app-branch-list"]],decls:72,vars:11,consts:[["fileInput",""],[1,"branch-list-container"],[1,"header"],[1,"header-actions"],["mat-stroked-button","",3,"click"],["hidden","","type","file","accept",".xlsx",3,"change"],["mat-raised-button","","color","primary",3,"click"],[1,"filter-card"],[1,"filter-row"],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value"],["mat-button","",3,"click"],[1,"content-grid"],[1,"table-card"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","sbu"],["matColumnDef","corporate"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"no-data"],[1,"form-card"],["mat-header-cell",""],["mat-cell",""],["selected","",3,"color"],["mat-icon-button","","matTooltip","Edit",3,"click"],["mat-icon-button","",3,"click","matTooltip"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-header-row",""],["mat-row",""],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","code"],["matInput","","formControlName","name"],["appearance","outline",1,"form-field","full-width"],["formControlName","corporateId",3,"selectionChange"],["formControlName","sbuId"],["matInput","","formControlName","description","rows","2"],["matInput","","formControlName","address","rows","2"],["matInput","","formControlName","contactEmail","type","email"],["matInput","","formControlName","contactPhone"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(m,a){if(m&1){let c=y();n(0,"div",1)(1,"div",2)(2,"h1"),r(3,"Branches"),t(),n(4,"div",3)(5,"button",4),f("click",function(){return d(c),p(a.downloadTemplate())}),n(6,"mat-icon"),r(7,"description"),t(),r(8," Template "),t(),n(9,"button",4),f("click",function(){d(c);let _=D(14);return p(_.click())}),n(10,"mat-icon"),r(11,"upload"),t(),r(12," Import "),t(),n(13,"input",5,0),f("change",function(_){return d(c),p(a.importFromExcel(_))}),t(),n(15,"button",4),f("click",function(){return d(c),p(a.exportToExcel())}),n(16,"mat-icon"),r(17,"download"),t(),r(18," Export "),t(),n(19,"button",6),f("click",function(){return d(c),p(a.openNewForm())}),n(20,"mat-icon"),r(21,"add"),t(),r(22," Add Branch "),t()()(),n(23,"mat-card",7)(24,"mat-card-content")(25,"div",8)(26,"mat-form-field",9)(27,"mat-label"),r(28,"Filter by Corporate"),t(),n(29,"mat-select",10),k("ngModelChange",function(_){return d(c),L(a.filterCorporateId,_)||(a.filterCorporateId=_),p(_)}),f("selectionChange",function(){return d(c),p(a.onFilterCorporateChange())}),n(30,"mat-option",11),r(31,"-- All Corporates --"),t(),w(32,ke,2,2,"mat-option",11,F),t()(),n(34,"mat-form-field",9)(35,"mat-label"),r(36,"Filter by SBU"),t(),n(37,"mat-select",10),k("ngModelChange",function(_){return d(c),L(a.filterSbuId,_)||(a.filterSbuId=_),p(_)}),f("selectionChange",function(){return d(c),p(a.applyFilters())}),n(38,"mat-option",11),r(39,"-- All SBUs --"),t(),w(40,Ve,2,2,"mat-option",11,F),t()(),n(42,"button",12),f("click",function(){return d(c),p(a.clearFilters())}),n(43,"mat-icon"),r(44,"clear"),t(),r(45," Clear Filters "),t()()()(),n(46,"div",13)(47,"mat-card",14)(48,"mat-card-content")(49,"table",15),g(50,16),h(51,Pe,2,0,"th",17)(52,De,2,1,"td",18),B(),g(53,19),h(54,Oe,2,0,"th",17)(55,Ne,2,1,"td",18),B(),g(56,20),h(57,Ae,2,0,"th",17)(58,qe,2,1,"td",18),B(),g(59,21),h(60,$e,2,0,"th",17)(61,Ue,2,1,"td",18),B(),g(62,22),h(63,Re,2,0,"th",17)(64,He,3,2,"td",18),B(),g(65,23),h(66,je,2,0,"th",17)(67,We,10,2,"td",18),B(),h(68,Ge,1,0,"tr",24)(69,ze,1,0,"tr",25),t(),h(70,Je,5,0,"div",26),t()(),h(71,it,59,10,"mat-card",27),t()()}m&2&&(o(29),T("ngModel",a.filterCorporateId),o(),u("value",null),o(2),E(a.corporates),o(5),T("ngModel",a.filterSbuId),o(),u("value",null),o(2),E(a.filteredSbus),o(6),P("with-form",a.showForm),o(3),u("dataSource",a.displayedBranches),o(19),u("matHeaderRowDef",a.displayedColumns),o(),u("matRowDefColumns",a.displayedColumns),o(),x(a.displayedBranches.length===0?70:-1),o(),x(a.showForm?71:-1))},dependencies:[O,G,R,A,q,$,U,z,H,j,ne,Z,te,ie,ee,Ee,fe,Ce,ge,Se,_e,Be,be,xe,ve,we,me,le,re,oe,ae,se,ce,Y,X,Q,K,J,he,pe,de,ye,Ie,N,Te,Fe],styles:[".branch-list-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.filter-card[_ngcontent-%COMP%]{margin-bottom:1rem}.filter-row[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}.filter-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:200px}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:1rem}.content-grid.with-form[_ngcontent-%COMP%]{grid-template-columns:1fr 500px}@media (max-width: 1100px){.content-grid.with-form[_ngcontent-%COMP%]{grid-template-columns:1fr}}.full-width[_ngcontent-%COMP%]{width:100%}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.form-field[_ngcontent-%COMP%]{flex:1;margin-bottom:.5rem}.form-field.full-width[_ngcontent-%COMP%]{width:100%}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;margin-top:1rem}table[_ngcontent-%COMP%]{width:100%}.mat-column-actions[_ngcontent-%COMP%]{width:150px;text-align:center}"]})}return i})();export{Ft as BranchListComponent};
