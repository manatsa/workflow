import{a as pt,b as _t,c as ft}from"./chunk-IGTQ3GOP.js";import{a as $}from"./chunk-V6VZ6TGW.js";import{a as X,b as Y}from"./chunk-D7R5IUPR.js";import{b as Z}from"./chunk-LUBHRDD6.js";import{a as q,b as Q}from"./chunk-UYHUY2FW.js";import{a as et,b as nt,c as it,d as at,e as ot,f as lt,g as rt,h as ct,i as mt,j as dt,k as st}from"./chunk-S7OVDIVJ.js";import{a as tt}from"./chunk-AIEGMQYC.js";import"./chunk-KPLEND2O.js";import"./chunk-M3GLKEYP.js";import"./chunk-FHBRY4FZ.js";import"./chunk-JITRQZ7S.js";import{a as U,b as G,c as W,f as J,h as K}from"./chunk-LB6LFADN.js";import"./chunk-Q5RCCGFX.js";import"./chunk-W4XF3NOO.js";import{a as L,c as R,d as F,g as B}from"./chunk-PKMLTJ2J.js";import{j as k,m as A,qa as N,ra as H,sa as j,ta as V,va as z}from"./chunk-LBWRLA47.js";import{Ab as C,Db as u,Fb as _,Ib as h,Jb as M,Kb as i,Lb as n,Mb as x,Nb as g,Ob as v,Qb as D,Ub as P,Vb as s,bb as o,dc as a,ec as c,fc as S,gb as f,gc as O,na as I,nb as y,nc as T,oa as w,pc as b,rc as E,tb as m}from"./chunk-5XIHPI6O.js";var ut=t=>["/approvals",t],xt=(t,l)=>l.fieldName,Ct=(t,l)=>l.id;function gt(t,l){t&1&&(i(0,"div",1),x(1,"mat-spinner",2),n())}function vt(t,l){if(t&1&&(i(0,"div",12)(1,"span",13),a(2,"Current Approval Level"),n(),i(3,"span",14),a(4),n()()),t&2){let e=s(2);o(4),S("Level ",e.instance.currentApprovalLevel,"")}}function ht(t,l){if(t&1&&(i(0,"div",12)(1,"span",13),a(2),n(),i(3,"span",14),a(4),n()()),t&2){let e=l.$implicit;o(2),c(e.fieldLabel),o(2),c(e.value||"-")}}function Mt(t,l){if(t&1&&(x(0,"mat-divider"),i(1,"div",12)(2,"span",13),a(3,"Comments"),n(),i(4,"span",14),a(5),n()()),t&2){let e=s(2);o(5),c(e.instance.comments)}}function St(t,l){if(t&1){let e=D();i(0,"div",23)(1,"mat-icon"),a(2,"description"),n(),i(3,"span",24),a(4),n(),i(5,"span",25),a(6),n(),i(7,"button",4),P("click",function(){let d=I(e).$implicit,p=s(3);return w(p.downloadAttachment(d))}),i(8,"mat-icon"),a(9,"download"),n()()()}if(t&2){let e=l.$implicit,r=s(3);o(4),c(e.originalFileName),o(2),S("(",r.formatFileSize(e.fileSize),")")}}function bt(t,l){if(t&1&&(i(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),a(3,"Attachments"),n()(),i(4,"mat-card-content")(5,"div",22),h(6,St,10,2,"div",23,Ct),n()()()),t&2){let e=s(2);o(6),M(e.instance.attachments)}}function Et(t,l){t&1&&(i(0,"div",17)(1,"mat-icon"),a(2,"history"),n(),i(3,"p"),a(4,"No approval actions yet"),n()())}function It(t,l){t&1&&(i(0,"mat-icon"),a(1,"check"),n())}function wt(t,l){t&1&&(i(0,"mat-icon"),a(1,"close"),n())}function Dt(t,l){t&1&&(i(0,"mat-icon"),a(1,"arrow_upward"),n())}function Pt(t,l){t&1&&(i(0,"mat-icon"),a(1,"pending"),n())}function yt(t,l){if(t&1&&(i(0,"div",31),a(1),n()),t&2){let e=s().$implicit;o(),S(' "',e.comments,'" ')}}function Ot(t,l){if(t&1&&(i(0,"div",26)(1,"div",27),m(2,It,2,0,"mat-icon")(3,wt,2,0,"mat-icon")(4,Dt,2,0,"mat-icon")(5,Pt,2,0,"mat-icon"),n(),i(6,"div",28)(7,"div",29)(8,"strong"),a(9),n(),i(10,"span",7),a(11),n()(),i(12,"div",30),a(13),b(14,"date"),n(),m(15,yt,2,1,"div",31),n()()),t&2){let e,r=l.$implicit;o(),u(r.action.toLowerCase()),o(),_((e=r.action)==="APPROVED"?2:e==="REJECTED"?3:e==="ESCALATED"?4:5),o(7),c(r.approverName),o(),u(r.action.toLowerCase()),o(),c(r.action),o(2),O(" Level ",r.level," - ",E(14,10,r.createdAt,"medium")," "),o(2),_(r.comments?15:-1)}}function Tt(t,l){if(t&1&&(i(0,"div",18),h(1,Ot,16,13,"div",26,Ct),n()),t&2){let e=s(2);o(),M(e.approvalHistory)}}function kt(t,l){t&1&&(i(0,"div",17)(1,"mat-icon"),a(2,"receipt_long"),n(),i(3,"p"),a(4,"No audit logs available"),n()())}function At(t,l){t&1&&(i(0,"th",40),a(1,"Date"),n())}function Lt(t,l){if(t&1&&(i(0,"td",41),a(1),b(2,"date"),n()),t&2){let e=l.$implicit;o(),c(E(2,1,e.createdAt,"medium"))}}function Rt(t,l){t&1&&(i(0,"th",40),a(1,"Action"),n())}function Ft(t,l){if(t&1&&(i(0,"td",41)(1,"span",7),a(2),n()()),t&2){let e=l.$implicit;o(2),c(e.action)}}function Bt(t,l){t&1&&(i(0,"th",40),a(1,"User"),n())}function Nt(t,l){if(t&1&&(i(0,"td",41),a(1),n()),t&2){let e=l.$implicit;o(),c(e.performedBy)}}function Ht(t,l){t&1&&(i(0,"th",40),a(1,"Details"),n())}function jt(t,l){if(t&1&&(i(0,"td",41),a(1),n()),t&2){let e=l.$implicit;o(),c(e.details)}}function Vt(t,l){t&1&&x(0,"tr",42)}function zt(t,l){t&1&&x(0,"tr",43)}function $t(t,l){if(t&1&&(i(0,"table",20),g(1,32),m(2,At,2,0,"th",33)(3,Lt,3,4,"td",34),v(),g(4,35),m(5,Rt,2,0,"th",33)(6,Ft,3,1,"td",34),v(),g(7,36),m(8,Bt,2,0,"th",33)(9,Nt,2,1,"td",34),v(),g(10,37),m(11,Ht,2,0,"th",33)(12,jt,2,1,"td",34),v(),m(13,Vt,1,0,"tr",38)(14,zt,1,0,"tr",39),n()),t&2){let e=s(2);C("dataSource",e.auditLogs),o(13),C("matHeaderRowDef",e.auditColumns),o(),C("matRowDefColumns",e.auditColumns)}}function Ut(t,l){if(t&1&&(i(0,"div",21)(1,"button",44)(2,"mat-icon"),a(3,"approval"),n(),a(4," Review & Approve "),n()()),t&2){let e=s(2);o(),C("routerLink",T(1,ut,e.instance.id))}}function Gt(t,l){if(t&1){let e=D();i(0,"div",3)(1,"button",4),P("click",function(){I(e);let d=s();return w(d.goBack())}),i(2,"mat-icon"),a(3,"arrow_back"),n()(),i(4,"div",5)(5,"h1"),a(6),n(),i(7,"p",6),a(8),n()(),i(9,"span",7),a(10),n()(),i(11,"mat-tab-group")(12,"mat-tab",8)(13,"div",9)(14,"div",10)(15,"mat-card",11)(16,"mat-card-header")(17,"mat-card-title"),a(18,"Submission Info"),n()(),i(19,"mat-card-content")(20,"div",12)(21,"span",13),a(22,"Reference Number"),n(),i(23,"span",14),a(24),n()(),i(25,"div",12)(26,"span",13),a(27,"Submitted By"),n(),i(28,"span",14),a(29),n()(),i(30,"div",12)(31,"span",13),a(32,"Submitted At"),n(),i(33,"span",14),a(34),b(35,"date"),n()(),i(36,"div",12)(37,"span",13),a(38,"Status"),n(),i(39,"span",7),a(40),n()(),m(41,vt,5,1,"div",12),n()(),i(42,"mat-card",15)(43,"mat-card-header")(44,"mat-card-title"),a(45,"Form Data"),n()(),i(46,"mat-card-content"),h(47,ht,5,2,"div",12,xt),m(49,Mt,6,1),n()()(),m(50,bt,8,0,"mat-card"),n()(),i(51,"mat-tab",16)(52,"div",9)(53,"mat-card")(54,"mat-card-content"),m(55,Et,5,0,"div",17)(56,Tt,3,0,"div",18),n()()()(),i(57,"mat-tab",19)(58,"div",9)(59,"mat-card")(60,"mat-card-content"),m(61,kt,5,0,"div",17)(62,$t,15,3,"table",20),n()()()()(),m(63,Ut,5,3,"div",21)}if(t&2){let e=s();o(6),c(e.instance.referenceNumber),o(2),c(e.instance.workflowName),o(),u(e.instance.status.toLowerCase()),o(),c(e.instance.status),o(14),c(e.instance.referenceNumber),o(5),c(e.instance.initiatorName),o(5),c(E(35,17,e.instance.createdAt,"medium")),o(5),u(e.instance.status.toLowerCase()),o(),c(e.instance.status),o(),_(e.instance.status==="PENDING"?41:-1),o(6),M(e.getFieldValuesArray()),o(2),_(e.instance.comments?49:-1),o(),_(e.instance.attachments&&e.instance.attachments.length>0?50:-1),o(5),_(e.approvalHistory.length===0?55:56),o(6),_(e.auditLogs.length===0?61:62),o(2),_(e.canTakeAction?63:-1)}}var fe=(()=>{class t{workflowService;settingService;route;router;instance=null;approvalHistory=[];auditLogs=[];loading=!0;canTakeAction=!1;auditColumns=["createdAt","action","performedBy","details"];getFieldValuesArray(){return this.instance?.fieldValues?Array.isArray(this.instance.fieldValues)?this.instance.fieldValues:Object.entries(this.instance.fieldValues).map(([e,r])=>({fieldName:e,fieldLabel:e,value:r})):[]}constructor(e,r,d,p){this.workflowService=e,this.settingService=r,this.route=d,this.router=p}ngOnInit(){let e=this.route.snapshot.paramMap.get("instanceId");e&&this.loadInstance(e)}loadInstance(e){this.workflowService.getInstance(e).subscribe({next:r=>{this.loading=!1,r.success&&(this.instance=r.data,this.approvalHistory=r.data.approvalHistory||[],this.canTakeAction=r.data.status==="PENDING",this.loadAuditLogs(e))},error:()=>{this.loading=!1}})}loadAuditLogs(e){this.settingService.getAuditLogs("WorkflowInstance",e).subscribe(r=>{r.success&&(this.auditLogs=r.data)})}goBack(){this.instance?this.router.navigate(["/workflows",this.instance.workflowCode,"instances"]):this.router.navigate(["/dashboard"])}formatFileSize(e){if(e===0)return"0 Bytes";let r=1024,d=["Bytes","KB","MB","GB"],p=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,p)).toFixed(2))+" "+d[p]}downloadAttachment(e){this.workflowService.downloadAttachment(e.id).subscribe(r=>{let d=window.URL.createObjectURL(r),p=document.createElement("a");p.href=d,p.download=e.originalFileName,p.click(),window.URL.revokeObjectURL(d)})}static \u0275fac=function(r){return new(r||t)(f(tt),f($),f(L),f(R))};static \u0275cmp=y({type:t,selectors:[["app-instance-detail"]],decls:3,vars:1,consts:[[1,"instance-detail-container"],[1,"loading"],["diameter","40"],[1,"header"],["mat-icon-button","",3,"click"],[1,"header-info"],[1,"subtitle"],[1,"badge"],["label","Details"],[1,"tab-content"],[1,"details-grid"],[1,"info-card"],[1,"info-row"],[1,"label"],[1,"value"],[1,"data-card"],["label","Approval History"],[1,"empty-state"],[1,"timeline"],["label","Audit"],["mat-table","",1,"audit-table",3,"dataSource"],[1,"action-bar"],[1,"attachments-list"],[1,"attachment-item"],[1,"name"],[1,"size"],[1,"timeline-item"],[1,"timeline-marker"],[1,"timeline-content"],[1,"timeline-header"],[1,"timeline-meta"],[1,"timeline-comments"],["matColumnDef","createdAt"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["matColumnDef","performedBy"],["matColumnDef","details"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],["mat-raised-button","","color","primary",3,"routerLink"]],template:function(r,d){r&1&&(i(0,"div",0),m(1,gt,2,0,"div",1)(2,Gt,64,20),n()),r&2&&(o(),_(d.loading?1:d.instance?2:-1))},dependencies:[A,k,B,F,K,U,W,J,G,ft,pt,_t,z,V,j,H,N,Z,st,et,it,rt,at,nt,ct,ot,lt,mt,dt,Y,X,Q,q],styles:[".instance-detail-container[_ngcontent-%COMP%]{padding:1rem;max-width:1200px;margin:0 auto}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.header-info[_ngcontent-%COMP%]{flex:1}.header-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.tab-content[_ngcontent-%COMP%]{padding:1rem 0}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #eee}.info-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#666;font-size:.875rem}.info-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.attachments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.attachment-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px}.attachment-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.attachment-item[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{color:#666;font-size:.75rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.timeline[_ngcontent-%COMP%]{padding:1rem 0}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem 0}.timeline-marker[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#f5f5f5}.timeline-marker.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.timeline-marker.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.timeline-marker.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.timeline-content[_ngcontent-%COMP%]{flex:1}.timeline-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.timeline-meta[_ngcontent-%COMP%]{font-size:.75rem;color:#666;margin-top:.25rem}.timeline-comments[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px;font-style:italic}.audit-table[_ngcontent-%COMP%]{width:100%}.action-bar[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding:1rem 0;margin-top:1rem;border-top:1px solid #eee}"]})}return t})();export{fe as InstanceDetailComponent};
