import{a as q,b as et,c as z,d as tt,e as nt}from"./chunk-WYL5XVCT.js";import"./chunk-F5X5MWHG.js";import{a as Ye,b as Ze}from"./chunk-4M7UJXFZ.js";import"./chunk-MS4AQ6UA.js";import{a as Ke,b as Xe}from"./chunk-B7S7HKPH.js";import{c as ue}from"./chunk-RP3FIGZU.js";import{a as ke,b as Se,c as ve,d as Ie}from"./chunk-ARJGZQI5.js";import{a as Me,b as xe}from"./chunk-D7R5IUPR.js";import{a as ye,b as Te,c as Ee,e as De,f as We,g as Re,h as H}from"./chunk-5TLSQL4E.js";import{b as Fe}from"./chunk-LUBHRDD6.js";import"./chunk-22QFHSXK.js";import{a as Ue}from"./chunk-UAAG5SLX.js";import{a as Le,b as Be,c as Ve,d as Ne,e as $e,f as je,g as He,h as qe,i as ze,j as Qe,k as Ge,l as Je}from"./chunk-S7OVDIVJ.js";import{a as Ae}from"./chunk-AIEGMQYC.js";import"./chunk-KPLEND2O.js";import{a as Pe,b as Oe}from"./chunk-XQHIDIE5.js";import"./chunk-LETYTNCA.js";import"./chunk-M3GLKEYP.js";import{a as N,c as $,d as j}from"./chunk-ZK2UDSKG.js";import{b as B,e as be,i as V}from"./chunk-FHBRY4FZ.js";import{d as W,h as R,k as F,q as fe,s as P}from"./chunk-JITRQZ7S.js";import{a as we,c as ge,h as he}from"./chunk-LB6LFADN.js";import"./chunk-Q5RCCGFX.js";import"./chunk-W4XF3NOO.js";import{a as ce,c as me,d as de,g as pe}from"./chunk-PKMLTJ2J.js";import{j as se,m as D,qa as _e,ra as O,sa as Ce,ta as A,va as L}from"./chunk-LBWRLA47.js";import{$b as U,Ab as p,Db as te,Fb as _,Hb as ne,Ib as ie,Jb as oe,Kb as n,Lb as o,Mb as S,Nb as M,Ob as x,Qb as h,Ub as u,Vb as m,W as ee,Zb as G,_b as J,bb as c,cc as ae,dc as r,ec as k,fc as b,gb as g,gc as re,hc as v,i as Z,ic as I,jc as y,mc as le,na as C,nb as T,nc as K,oa as w,oc as E,pc as X,rc as Y,tb as d}from"./chunk-5XIHPI6O.js";function dt(t,s){if(t&1){let e=h();n(0,"mat-form-field",1)(1,"mat-label"),r(2),o(),n(3,"textarea",5),y("ngModelChange",function(i){C(e);let l=m();return I(l.reason,i)||(l.reason=i),w(i)}),o()()}if(t&2){let e,a=m();c(2),k(a.data.reasonLabel||"Reason"),c(),v("ngModel",a.reason),p("required",(e=a.data.reasonRequired)!==null&&e!==void 0?e:!1)}}var Q=(()=>{class t{dialogRef;data;reason="";constructor(e,a){this.dialogRef=e,this.data=a}onCancel(){this.dialogRef.close(null)}onConfirm(){this.dialogRef.close({confirmed:!0,reason:this.reason})}static \u0275fac=function(a){return new(a||t)(g(ye),g(Te))};static \u0275cmp=T({type:t,selectors:[["app-confirm-dialog"]],decls:11,vars:7,consts:[["mat-dialog-title",""],["appearance","outline",1,"full-width"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","",3,"click","color","disabled"],["matInput","","rows","3",3,"ngModelChange","ngModel","required"]],template:function(a,i){a&1&&(n(0,"h2",0),r(1),o(),n(2,"mat-dialog-content")(3,"p"),r(4),o(),d(5,dt,4,3,"mat-form-field",1),o(),n(6,"mat-dialog-actions",2)(7,"button",3),u("click",function(){return i.onCancel()}),r(8),o(),n(9,"button",4),u("click",function(){return i.onConfirm()}),r(10),o()()),a&2&&(c(),k(i.data.title),c(3),k(i.data.message),c(),_(i.data.showReasonInput?5:-1),c(3),b(" ",i.data.cancelText||"Cancel"," "),c(),p("color",i.data.confirmColor||"primary")("disabled",i.data.reasonRequired&&!i.reason),c(),b(" ",i.data.confirmText||"Confirm"," "))},dependencies:[D,P,W,R,fe,F,H,De,Re,We,L,A,O,N,V,B,j,$],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-top:1rem}mat-dialog-content[_ngcontent-%COMP%]{min-width:300px}mat-dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#000000b3}"]})}return t})();var pt=t=>["/workflows",t,"new"],ut=()=>[10,25,50,100],it=(t,s)=>["/workflows",t,"instances",s],ft=(t,s)=>["/workflows",t,"edit",s],_t=t=>["/approvals",t];function Ct(t,s){if(t&1&&(n(0,"mat-option",14),r(1),o()),t&2){let e=s.$implicit;p("value",e),c(),k(e)}}function wt(t,s){t&1&&(n(0,"th",30),r(1,"Reference"),o())}function gt(t,s){if(t&1&&(n(0,"td",31)(1,"a",32),r(2),o()()),t&2){let e=s.$implicit,a=m();c(),p("routerLink",E(2,it,a.workflowCode,e.id)),c(),b(" ",e.referenceNumber," ")}}function ht(t,s){t&1&&(n(0,"th",30),r(1,"Submitted By"),o())}function bt(t,s){if(t&1&&(n(0,"td",31),r(1),o()),t&2){let e=s.$implicit;c(),k(e.initiatorName)}}function Mt(t,s){t&1&&(n(0,"th",30),r(1,"Status"),o())}function xt(t,s){if(t&1&&(n(0,"td",31)(1,"span",33),r(2),o()()),t&2){let e=s.$implicit;c(),te(e.status.toLowerCase()),c(),b(" ",e.status," ")}}function kt(t,s){t&1&&(n(0,"th",30),r(1,"Current Level"),o())}function St(t,s){if(t&1&&(S(0,"br"),n(1,"small",34),r(2),o()),t&2){let e=m(2).$implicit;c(2),re("(Approver ",(e.currentApproverOrder||0)+1," of ",e.totalApproversAtLevel,")")}}function vt(t,s){if(t&1&&(r(0),d(1,St,3,2)),t&2){let e=m().$implicit;b(" Level ",e.currentLevel||e.currentApprovalLevel," "),c(),_(e.totalApproversAtLevel&&e.totalApproversAtLevel>1?1:-1)}}function It(t,s){t&1&&r(0," - ")}function yt(t,s){if(t&1&&(n(0,"td",31),d(1,vt,2,2)(2,It,1,0),o()),t&2){let e=s.$implicit;c(),_(e.status==="PENDING"?1:2)}}function Tt(t,s){t&1&&(n(0,"th",30),r(1,"Submitted"),o())}function Et(t,s){if(t&1&&(n(0,"td",31),r(1),X(2,"date"),o()),t&2){let e=s.$implicit;c(),b(" ",Y(2,1,e.createdAt,"medium")," ")}}function Dt(t,s){t&1&&(n(0,"th",30),r(1,"Last Updated"),o())}function Wt(t,s){if(t&1&&(n(0,"td",31),r(1),X(2,"date"),o()),t&2){let e=s.$implicit;c(),b(" ",Y(2,1,e.updatedAt,"medium")," ")}}function Rt(t,s){t&1&&S(0,"th",35)}function Ft(t,s){if(t&1){let e=h();n(0,"button",37)(1,"mat-icon"),r(2,"edit"),o(),n(3,"span"),r(4,"Edit"),o()(),n(5,"button",39),u("click",function(){C(e);let i=m().$implicit,l=m();return w(l.submitForApproval(i))}),n(6,"mat-icon"),r(7,"send"),o(),n(8,"span"),r(9,"Submit for Approval"),o()()}if(t&2){let e=m().$implicit,a=m();p("routerLink",E(1,ft,a.workflowCode,e.id))}}function Pt(t,s){if(t&1){let e=h();n(0,"button",37)(1,"mat-icon"),r(2,"approval"),o(),n(3,"span"),r(4,"Review"),o()(),n(5,"button",39),u("click",function(){C(e);let i=m().$implicit,l=m();return w(l.recallSubmission(i))}),n(6,"mat-icon"),r(7,"undo"),o(),n(8,"span"),r(9,"Recall"),o()()}if(t&2){let e=m().$implicit;p("routerLink",K(1,_t,e.id))}}function Ot(t,s){if(t&1){let e=h();n(0,"button",39),u("click",function(){C(e);let i=m().$implicit,l=m();return w(l.resubmit(i))}),n(1,"mat-icon"),r(2,"replay"),o(),n(3,"span"),r(4,"Resubmit"),o()()}}function At(t,s){if(t&1){let e=h();n(0,"button",39),u("click",function(){C(e);let i=m().$implicit,l=m();return w(l.cancelSubmission(i))}),n(1,"mat-icon"),r(2,"cancel"),o(),n(3,"span"),r(4,"Cancel"),o()()}}function Lt(t,s){if(t&1){let e=h();n(0,"button",41),u("click",function(){C(e);let i=m().$implicit,l=m();return w(l.deleteSubmission(i))}),n(1,"mat-icon",42),r(2,"delete"),o(),n(3,"span"),r(4,"Delete"),o()()}}function Bt(t,s){if(t&1){let e=h();n(0,"td",31)(1,"button",36)(2,"mat-icon"),r(3,"more_vert"),o()(),n(4,"mat-menu",null,0)(6,"button",37)(7,"mat-icon"),r(8,"visibility"),o(),n(9,"span"),r(10,"View Details"),o()(),d(11,Ft,10,4)(12,Pt,10,3)(13,Ot,5,0,"button",38),S(14,"mat-divider"),n(15,"button",39),u("click",function(){let i=C(e).$implicit,l=m();return w(l.cloneSubmission(i))}),n(16,"mat-icon"),r(17,"content_copy"),o(),n(18,"span"),r(19,"Duplicate"),o()(),d(20,At,5,0,"button",38)(21,Lt,5,0,"button",40),o()()}if(t&2){let e=s.$implicit,a=ae(5),i=m();c(),p("matMenuTriggerFor",a),c(5),p("routerLink",E(7,it,i.workflowCode,e.id)),c(5),_(e.status==="DRAFT"?11:-1),c(),_(e.status==="PENDING"?12:-1),c(),_(e.status==="REJECTED"?13:-1),c(7),_(e.status!=="APPROVED"&&e.status!=="REJECTED"?20:-1),c(),_(e.status==="DRAFT"||e.status==="CANCELLED"?21:-1)}}function Vt(t,s){t&1&&S(0,"tr",43)}function Nt(t,s){t&1&&S(0,"tr",44)}function $t(t,s){t&1&&(n(0,"div",28)(1,"mat-icon"),r(2,"inbox"),o(),n(3,"p"),r(4,"No submissions found"),o()())}var Wn=(()=>{class t{workflowService;route;router;snackBar;dialog;displayedColumns=["referenceNumber","initiatorName","status","currentLevel","createdAt","updatedAt","actions"];dataSource=new Je([]);searchTerm="";statusFilter="";workflowCode="";workflowName="";statuses=Object.values(Ue);destroy$=new Z;paginator;sort;constructor(e,a,i,l,f){this.workflowService=e,this.route=a,this.router=i,this.snackBar=l,this.dialog=f}ngOnInit(){this.route.params.pipe(ee(this.destroy$)).subscribe(e=>{let a=e.workflowCode||"";(a!==this.workflowCode||!this.workflowCode)&&(this.workflowCode=a,this.searchTerm="",this.statusFilter="",this.loadWorkflow(),this.loadInstances())})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=this.createFilter()}loadWorkflow(){this.workflowService.getWorkflowByCode(this.workflowCode).subscribe(e=>{e.success&&(this.workflowName=e.data.name)})}loadInstances(){this.workflowService.getInstancesByWorkflow(this.workflowCode).subscribe(e=>{e.success&&e.data&&(this.dataSource.data=e.data.content||[])})}createFilter(){return(e,a)=>{let i=(e.referenceNumber||"").toLowerCase(),l=this.searchTerm.toLowerCase(),f=!this.statusFilter||e.status===this.statusFilter,ot=!l||i.includes(l);return f&&ot}}applyFilter(){this.dataSource.filter=Date.now().toString()}submitForApproval(e){this.workflowService.submitDraftInstance(e.id).subscribe({next:a=>{a.success&&(this.snackBar.open("Submitted for approval","Close",{duration:3e3}),this.loadInstances())},error:a=>{this.snackBar.open(a.error?.message||"Failed to submit","Close",{duration:3e3})}})}recallSubmission(e){this.dialog.open(Q,{data:{title:"Recall Submission",message:`Are you sure you want to recall "${e.referenceNumber}"? This will return it to draft status.`,confirmText:"Recall",cancelText:"Cancel",showReasonInput:!0,reasonLabel:"Reason for recall"}}).afterClosed().subscribe(i=>{i&&this.workflowService.recallInstance(e.id,i.reason).subscribe({next:l=>{l.success&&(this.snackBar.open("Submission recalled","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to recall","Close",{duration:3e3})}})})}resubmit(e){this.workflowService.resubmitInstance(e.id).subscribe({next:a=>{a.success&&(this.snackBar.open("Resubmitted for approval","Close",{duration:3e3}),this.loadInstances())},error:a=>{this.snackBar.open(a.error?.message||"Failed to resubmit","Close",{duration:3e3})}})}cloneSubmission(e){this.workflowService.cloneInstance(e.id).subscribe({next:a=>{a.success&&(this.snackBar.open("Submission duplicated","Close",{duration:3e3}),this.loadInstances())},error:a=>{this.snackBar.open(a.error?.message||"Failed to duplicate","Close",{duration:3e3})}})}cancelSubmission(e){this.dialog.open(Q,{data:{title:"Cancel Submission",message:`Are you sure you want to cancel "${e.referenceNumber}"?`,confirmText:"Cancel Submission",cancelText:"Keep",showReasonInput:!0,reasonLabel:"Reason for cancellation"}}).afterClosed().subscribe(i=>{i&&this.workflowService.cancelInstance(e.id,i.reason).subscribe({next:l=>{l.success&&(this.snackBar.open("Submission cancelled","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to cancel","Close",{duration:3e3})}})})}deleteSubmission(e){this.dialog.open(Q,{data:{title:"Delete Submission",message:`Are you sure you want to delete "${e.referenceNumber}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed().subscribe(i=>{i&&this.workflowService.deleteInstance(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Submission deleted","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to delete","Close",{duration:3e3})}})})}static \u0275fac=function(a){return new(a||t)(g(Ae),g(ce),g(me),g(Pe),g(Ee))};static \u0275cmp=T({type:t,selectors:[["app-workflow-instances"]],viewQuery:function(a,i){if(a&1&&(G(q,5),G(z,5)),a&2){let l;J(l=U())&&(i.paginator=l.first),J(l=U())&&(i.sort=l.first)}},decls:58,vars:12,consts:[["menu","matMenu"],[1,"instances-container"],[1,"header"],[1,"header-left"],["mat-icon-button","","routerLink","/dashboard"],[1,"subtitle"],["mat-raised-button","","color","primary",3,"routerLink"],[1,"table-toolbar"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Search by reference number",3,"ngModelChange","keyup","ngModel"],["matPrefix",""],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value"],["mat-table","","matSort","",1,"data-table",3,"dataSource"],["matColumnDef","referenceNumber"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","initiatorName"],["matColumnDef","status"],["matColumnDef","currentLevel"],["matColumnDef","createdAt"],["matColumnDef","updatedAt"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"empty-state"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink"],[1,"badge"],[1,"approver-progress"],["mat-header-cell",""],["mat-icon-button","","matTooltip","Actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"routerLink"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"delete-action"],["mat-menu-item","",1,"delete-action",3,"click"],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(a,i){a&1&&(n(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4)(4,"mat-icon"),r(5,"arrow_back"),o()(),n(6,"div")(7,"h1"),r(8),o(),n(9,"p",5),r(10,"All submissions for this workflow"),o()()(),n(11,"button",6)(12,"mat-icon"),r(13,"add"),o(),r(14," New Submission "),o()(),n(15,"mat-card")(16,"mat-card-content")(17,"div",7)(18,"mat-form-field",8)(19,"mat-label"),r(20,"Search"),o(),n(21,"input",9),y("ngModelChange",function(f){return I(i.searchTerm,f)||(i.searchTerm=f),f}),u("keyup",function(){return i.applyFilter()}),o(),n(22,"mat-icon",10),r(23,"search"),o()(),n(24,"mat-form-field",11)(25,"mat-label"),r(26,"Status"),o(),n(27,"mat-select",12),y("ngModelChange",function(f){return I(i.statusFilter,f)||(i.statusFilter=f),f}),u("selectionChange",function(){return i.applyFilter()}),n(28,"mat-option",13),r(29,"All"),o(),ie(30,Ct,2,2,"mat-option",14,ne),o()()(),n(32,"table",15),M(33,16),d(34,wt,2,0,"th",17)(35,gt,3,5,"td",18),x(),M(36,19),d(37,ht,2,0,"th",17)(38,bt,2,1,"td",18),x(),M(39,20),d(40,Mt,2,0,"th",17)(41,xt,3,3,"td",18),x(),M(42,21),d(43,kt,2,0,"th",17)(44,yt,3,1,"td",18),x(),M(45,22),d(46,Tt,2,0,"th",17)(47,Et,3,4,"td",18),x(),M(48,23),d(49,Dt,2,0,"th",17)(50,Wt,3,4,"td",18),x(),M(51,24),d(52,Rt,1,0,"th",25)(53,Bt,22,10,"td",18),x(),d(54,Vt,1,0,"tr",26)(55,Nt,1,0,"tr",27),o(),d(56,$t,5,0,"div",28),S(57,"mat-paginator",29),o()()()),a&2&&(c(8),k(i.workflowName),c(3),p("routerLink",K(9,pt,i.workflowCode)),c(10),v("ngModel",i.searchTerm),c(6),v("ngModel",i.statusFilter),c(3),oe(i.statuses),c(2),p("dataSource",i.dataSource),c(22),p("matHeaderRowDef",i.displayedColumns),c(),p("matRowDefColumns",i.displayedColumns),c(),_(i.dataSource.data.length===0?56:-1),c(),p("pageSizeOptions",le(11,ut)))},dependencies:[D,se,pe,de,P,W,R,F,he,we,ge,Ge,Le,Ve,He,Ne,Be,qe,$e,je,ze,Qe,et,q,nt,z,tt,N,V,B,be,j,$,Xe,Ke,ue,L,A,Ce,O,_e,Fe,Ie,Se,ke,ve,Oe,H,Ze,Ye,xe,Me],styles:[".instances-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.table-toolbar[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.search-field[_ngcontent-%COMP%]{flex:1;max-width:400px}.data-table[_ngcontent-%COMP%]{width:100%}.data-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#1976d2;text-decoration:none;font-weight:500}.data-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.draft[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.badge.cancelled[_ngcontent-%COMP%]{background:#fafafa;color:#9e9e9e}.badge.on_hold[_ngcontent-%COMP%]{background:#f3e5f5;color:#7b1fa2}.delete-action[_ngcontent-%COMP%]{color:#c62828}.approver-progress[_ngcontent-%COMP%]{color:#666;font-size:.7rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}"]})}return t})();export{Wn as WorkflowInstancesComponent};
