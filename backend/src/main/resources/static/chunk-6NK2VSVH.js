import{a as at,b as nt,c as ot}from"./chunk-ZMVFBH4E.js";import{a as et,b as tt,c as rt,d as it}from"./chunk-MSROSKVG.js";import{a as Xe,b as Ye,c as Ke,d as Qe,e as Ze}from"./chunk-NQ5ZHPOQ.js";import"./chunk-F5X5MWHG.js";import{b as Je}from"./chunk-26MIDNQT.js";import{c as re}from"./chunk-EC7BDYIR.js";import"./chunk-J43BGVIN.js";import"./chunk-MS4AQ6UA.js";import{b as ke}from"./chunk-DCGWK6OW.js";import{d as te}from"./chunk-WNUHNPS4.js";import{a as Be}from"./chunk-GKNOQT2V.js";import{f as Oe}from"./chunk-3QZG32TM.js";import{a as Pe,b as Ie,c as Ve,d as Te}from"./chunk-YWWQJANS.js";import{c as Ae}from"./chunk-INV3KQYA.js";import{b as De,c as Ee}from"./chunk-C5XODKZL.js";import"./chunk-LU6VCXUA.js";import"./chunk-AGZT6V36.js";import{a as Me,b as Re}from"./chunk-CDWC6WKW.js";import{b as we,f as ye,i as be,j as xe,l as ve,m as Se}from"./chunk-ZS434AQM.js";import{d as ie,i as ae,l as M,m as ne,p as oe,v as le,w as pe}from"./chunk-M3VCE5SG.js";import{a as Fe,b as $e,c as ze,d as We,e as Le,f as je,g as Ue,h as Ne,i as Ge,j as He,k as qe}from"./chunk-ZLHYE5PR.js";import{a as fe,b as he,c as ge,f as _e,h as Ce}from"./chunk-BTSRKJZZ.js";import"./chunk-UF7Y5AYJ.js";import"./chunk-PMYQJTBZ.js";import{a as K,c as Q,d as Z,g as ee}from"./chunk-M6HZK7Y7.js";import{Aa as ue,k as G,m as H,n as q,o as J,q as X,v as Y,va as me,wa as se,xa as de,ya as ce}from"./chunk-37H25STD.js";import{Eb as c,Fb as A,Hb as L,Jb as D,Mb as b,Nb as x,Ob as n,Pb as i,Qb as g,Rb as j,Sb as U,Ub as z,V as $,Yb as _,Zb as u,eb as o,gc as C,hc as l,ic as w,jb as k,jc as y,lc as P,mc as I,nc as V,oa as f,pa as h,qb as W,qc as N,s as F,tc as S,uc as T,vc as O,wb as E}from"./chunk-UYCZSUYP.js";var ht=()=>[10,25,50,100],R=(a,d)=>d.id,gt=(a,d)=>d.label,_t=(a,d)=>d.field;function Ct(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function wt(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function yt(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function bt(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function xt(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function vt(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function St(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function Mt(a,d){if(a&1&&(n(0,"mat-option",32),l(1),i()),a&2){let e=d.$implicit;c("value",e),o(),w(e.name)}}function Rt(a,d){a&1&&(n(0,"div",35),g(1,"mat-spinner",39),n(2,"p"),l(3,"Generating report..."),i()())}function kt(a,d){if(a&1&&(n(0,"mat-card",40)(1,"mat-card-content")(2,"div",41)(3,"mat-icon"),l(4),i()(),n(5,"div",42)(6,"span",43),l(7),i(),n(8,"span",44),l(9),i()()()()),a&2){let e=d.$implicit;o(2),A("background",e.color+"20")("color",e.color),o(2),w(e.icon),o(3),w(e.value),o(2),w(e.label)}}function Dt(a,d){if(a&1&&(n(0,"div",36),b(1,kt,10,7,"mat-card",40,gt),i()),a&2){let e=u();o(),x(e.getSummaryItems())}}function Et(a,d){if(a&1&&(n(0,"th",55),l(1),i()),a&2){let e=u().$implicit;A("text-align",e.align||"left"),o(),y(" ",e.header," ")}}function Pt(a,d){if(a&1&&(l(0),S(1,"date")),a&2){let e=u().$implicit,r=u().$implicit;y(" ",O(1,1,e[r.field],"mediumDate")," ")}}function It(a,d){if(a&1&&(l(0),S(1,"date")),a&2){let e=u().$implicit,r=u().$implicit;y(" ",O(1,1,e[r.field],"medium")," ")}}function Vt(a,d){if(a&1&&(l(0),S(1,"currency")),a&2){let e=u().$implicit,r=u().$implicit;y(" ",T(1,1,e[r.field])," ")}}function Tt(a,d){if(a&1&&(l(0),S(1,"number")),a&2){let e=u().$implicit,r=u().$implicit;y(" ",T(1,1,e[r.field])," ")}}function Ot(a,d){if(a&1&&(l(0),S(1,"number")),a&2){let e=u().$implicit,r=u().$implicit;y(" ",O(1,1,e[r.field],"1.1-1"),"% ")}}function At(a,d){if(a&1&&(n(0,"span",58),l(1),i()),a&2){let e=u().$implicit,r=u().$implicit;L(e[r.field]==null?null:e[r.field].toLowerCase()),o(),y(" ",e[r.field]," ")}}function Bt(a,d){if(a&1&&l(0),a&2){let e=u().$implicit,r=u().$implicit;y(" ",e[r.field]," ")}}function Ft(a,d){if(a&1&&(n(0,"td",56),E(1,Pt,2,4)(2,It,2,4)(3,Vt,2,3)(4,Tt,2,3)(5,Ot,2,4)(6,At,2,3,"span",57)(7,Bt,1,1),i()),a&2){let e=u().$implicit;A("text-align",e.align||"left"),o(),D(e.type==="date"?1:e.type==="datetime"?2:e.type==="currency"?3:e.type==="number"?4:e.type==="percentage"?5:e.type==="status"?6:7)}}function $t(a,d){if(a&1&&(j(0,49),E(1,Et,2,3,"th",53)(2,Ft,8,3,"td",54),U()),a&2){let e=d.$implicit;c("matColumnDef",e.field)}}function zt(a,d){a&1&&g(0,"tr",59)}function Wt(a,d){a&1&&g(0,"tr",60)}function Lt(a,d){if(a&1){let e=z();n(0,"mat-card",37)(1,"mat-card-header")(2,"mat-card-title")(3,"mat-icon"),l(4,"table_chart"),i(),l(5," Results "),n(6,"span",45),l(7),i()(),n(8,"span",46),l(9),S(10,"date"),i()(),n(11,"mat-card-content")(12,"div",47)(13,"table",48),_("matSortChange",function(t){f(e);let p=u();return h(p.sortData(t))}),b(14,$t,3,1,"ng-container",49,_t),E(16,zt,1,0,"tr",50)(17,Wt,1,0,"tr",51),i()(),n(18,"mat-paginator",52),_("page",function(t){f(e);let p=u();return h(p.onPageChange(t))}),i()()()}if(a&2){let e=u();o(7),y("(",e.reportResult.data.length," records)"),o(2),y("Generated: ",O(10,8,e.reportResult.generatedAt,"medium"),""),o(4),c("dataSource",e.paginatedData),o(),x(e.reportResult.columns),o(2),c("matHeaderRowDef",e.displayedColumns),o(),c("matRowDefColumns",e.displayedColumns),o(),c("length",e.reportResult.data.length)("pageSize",e.pageSize)("pageSizeOptions",N(11,ht))}}function jt(a,d){a&1&&(n(0,"div",38)(1,"mat-icon"),l(2,"assessment"),i(),n(3,"h3"),l(4,"Ready to Generate"),i(),n(5,"p"),l(6,'Configure the filters above and click "Run Report" to generate results'),i()())}var Ir=(()=>{class a{route;router;reportService;snackBar;http;reportId="";report=null;reportResult=null;loading=!1;exporting=!1;reportFontSize="14px";parameters={startDate:new Date(new Date().setMonth(new Date().getMonth()-1)),endDate:new Date,approvedStartDate:null,approvedEndDate:null,status:"",workflowId:"",userId:"",corporateId:"",sbuId:"",branchId:"",departmentId:"",groupBy:""};statusControl=new M("");workflowControl=new M("");userControl=new M("");corporateControl=new M("");sbuControl=new M("");branchControl=new M("");departmentControl=new M("");groupByControl=new M("");statuses=[{id:"",name:"All Statuses"},{id:"DRAFT",name:"Draft"},{id:"PENDING",name:"Pending"},{id:"APPROVED",name:"Approved"},{id:"REJECTED",name:"Rejected"},{id:"ESCALATED",name:"Escalated"},{id:"CANCELLED",name:"Cancelled"}];groupByOptions=[{id:"",name:"None"},{id:"day",name:"Day"},{id:"week",name:"Week"},{id:"month",name:"Month"},{id:"workflow",name:"Workflow"},{id:"user",name:"User"},{id:"sbu",name:"SBU"},{id:"status",name:"Status"}];filteredStatuses;filteredGroupByOptions;workflows=[];users=[];corporates=[];sbus=[];filteredSbus=[];branches=[];filteredBranches=[];departments=[];displayedColumns=[];paginatedData=[];pageSize=25;currentPage=0;apiUrl="/api";constructor(e,r,t,p,s){this.route=e,this.router=r,this.reportService=t,this.snackBar=p,this.http=s}ngOnInit(){this.route.params.subscribe(e=>{this.reportId=e.reportId,this.loadReportDefinition()}),this.loadLookupData(),this.loadReportSettings(),this.setupAutocompleteFilters()}setupAutocompleteFilters(){this.filteredStatuses=this.statusControl.valueChanges.pipe($(""),F(e=>this.filterOptions(this.statuses,e))),this.filteredGroupByOptions=this.groupByControl.valueChanges.pipe($(""),F(e=>this.filterOptions(this.groupByOptions,e)))}getFilteredWorkflows(){let e=this.workflowControl.value;return this.filterOptions([{id:"",name:"All Workflows"},...this.workflows],e)}getFilteredUsers(){let e=this.userControl.value;return this.filterOptions([{id:"",name:"All Users"},...this.users],e)}getFilteredCorporates(){let e=this.corporateControl.value;return this.filterOptions([{id:"",name:"All Corporates"},...this.corporates],e)}getFilteredSbuOptions(){let e=this.sbuControl.value;return this.filterOptions([{id:"",name:"All SBUs"},...this.filteredSbus],e)}getFilteredBranchOptions(){let e=this.branchControl.value;return this.filterOptions([{id:"",name:"All Branches"},...this.filteredBranches],e)}getFilteredDepartments(){let e=this.departmentControl.value;return this.filterOptions([{id:"",name:"All Departments"},...this.departments],e)}filterOptions(e,r){if(!r)return e;let t=typeof r=="string"?r.toLowerCase():r?.name?.toLowerCase()||"";return e.filter(p=>p.name.toLowerCase().includes(t))}displayLookup=e=>e?.name||"";displayStatus=e=>e?.name||"";onStatusSelected(e){let r=e.option.value;this.parameters.status=r?.id||""}onWorkflowSelected(e){let r=e.option.value;this.parameters.workflowId=r?.id||""}onUserSelected(e){let r=e.option.value;this.parameters.userId=r?.id||""}onCorporateSelected(e){let r=e.option.value;this.parameters.corporateId=r?.id||"",this.onCorporateChange()}onSbuSelected(e){let r=e.option.value;this.parameters.sbuId=r?.id||"",this.onSbuChange()}onBranchSelected(e){let r=e.option.value;this.parameters.branchId=r?.id||""}onDepartmentSelected(e){let r=e.option.value;this.parameters.departmentId=r?.id||""}onGroupBySelected(e){let r=e.option.value;this.parameters.groupBy=r?.id||""}loadReportSettings(){this.http.get(`${this.apiUrl}/settings/by-key/reporting.font.size`).subscribe({next:e=>{e.success&&e.data?.value&&(this.reportFontSize=e.data.value+"px",document.documentElement.style.setProperty("--report-font-size",this.reportFontSize))},error:()=>{document.documentElement.style.setProperty("--report-font-size","14px")}})}loadLookupData(){this.http.get(`${this.apiUrl}/workflows`).subscribe({next:e=>{if(e.success&&e.data){let r=e.data.content||e.data;Array.isArray(r)&&(this.workflows=r.map(t=>({id:t.id,name:t.name})))}}}),this.http.get(`${this.apiUrl}/users`).subscribe({next:e=>{if(e.success&&e.data){let r=e.data.content||e.data;Array.isArray(r)&&(this.users=r.map(t=>({id:t.id,name:t.fullName||t.username})))}}}),this.http.get(`${this.apiUrl}/corporates`).subscribe({next:e=>{e.success&&e.data&&(this.corporates=e.data.map(r=>({id:r.id,name:r.name})))}}),this.http.get(`${this.apiUrl}/sbus`).subscribe({next:e=>{e.success&&e.data&&(this.sbus=e.data.map(r=>({id:r.id,name:r.name,corporateId:r.corporateId})),this.filteredSbus=[...this.sbus])}}),this.http.get(`${this.apiUrl}/branches`).subscribe({next:e=>{e.success&&e.data&&(this.branches=e.data.map(r=>({id:r.id,name:r.name,sbuId:r.sbuId})),this.filteredBranches=[...this.branches])}}),this.http.get(`${this.apiUrl}/departments`).subscribe({next:e=>{e.success&&e.data&&(this.departments=e.data.map(r=>({id:r.id,name:r.name})))}})}onCorporateChange(){this.parameters.corporateId?this.filteredSbus=this.sbus.filter(e=>e.corporateId===this.parameters.corporateId):this.filteredSbus=[...this.sbus],this.parameters.sbuId="",this.parameters.branchId="",this.filteredBranches=[]}onSbuChange(){this.parameters.sbuId?this.filteredBranches=this.branches.filter(e=>e.sbuId===this.parameters.sbuId):this.filteredBranches=[...this.branches],this.parameters.branchId=""}clearFilters(){this.parameters={startDate:new Date(new Date().setMonth(new Date().getMonth()-1)),endDate:new Date,approvedStartDate:null,approvedEndDate:null,status:"",workflowId:"",userId:"",corporateId:"",sbuId:"",branchId:"",departmentId:"",groupBy:""},this.statusControl.setValue(""),this.workflowControl.setValue(""),this.userControl.setValue(""),this.corporateControl.setValue(""),this.sbuControl.setValue(""),this.branchControl.setValue(""),this.departmentControl.setValue(""),this.groupByControl.setValue(""),this.filteredSbus=[...this.sbus],this.filteredBranches=[...this.branches]}loadReportDefinition(){let e=this.reportService.getAllReports();this.report=e.find(r=>r.id===this.reportId)||null,this.report||(this.snackBar.open("Report not found","Close",{duration:3e3}),this.router.navigate(["/reports"]))}runReport(){this.loading=!0,this.reportService.generateReport(this.reportId,this.formatParameters()).subscribe({next:e=>{e.success?(this.reportResult=e.data,this.displayedColumns=e.data.columns.map(r=>r.field),this.updatePaginatedData()):this.generateMockData(),this.loading=!1},error:()=>{this.generateMockData(),this.loading=!1}})}generateMockData(){let e={columns:this.getMockColumns(),data:this.getMockData(),summary:this.getMockSummary(),generatedAt:new Date().toISOString()};this.reportResult=e,this.displayedColumns=e.columns.map(r=>r.field),this.updatePaginatedData()}getMockColumns(){switch(this.report?.category){case"submissions":return[{field:"referenceNumber",header:"Reference",type:"string"},{field:"workflow",header:"Workflow",type:"string"},{field:"submitter",header:"Submitted By",type:"string"},{field:"status",header:"Status",type:"status"},{field:"submittedAt",header:"Submitted Date",type:"date"},{field:"count",header:"Count",type:"number",align:"right"}];case"approvals":return[{field:"approver",header:"Approver",type:"string"},{field:"approved",header:"Approved",type:"number",align:"right"},{field:"rejected",header:"Rejected",type:"number",align:"right"},{field:"pending",header:"Pending",type:"number",align:"right"},{field:"avgResponseTime",header:"Avg Response (hrs)",type:"number",align:"right"}];case"performance":return[{field:"workflow",header:"Workflow",type:"string"},{field:"avgProcessingTime",header:"Avg Time (hrs)",type:"number",align:"right"},{field:"minTime",header:"Min Time",type:"number",align:"right"},{field:"maxTime",header:"Max Time",type:"number",align:"right"},{field:"completionRate",header:"Completion %",type:"percentage",align:"right"}];case"financial":return[{field:"category",header:"Category",type:"string"},{field:"totalAmount",header:"Total Amount",type:"currency",align:"right"},{field:"count",header:"Count",type:"number",align:"right"},{field:"avgAmount",header:"Average",type:"currency",align:"right"}];default:return[{field:"name",header:"Name",type:"string"},{field:"value",header:"Value",type:"number",align:"right"},{field:"percentage",header:"Percentage",type:"percentage",align:"right"}]}}getMockData(){let e=this.report?.category,r=["PENDING","APPROVED","REJECTED","DRAFT"],t=["Leave Request","Expense Claim","Purchase Order","Travel Request","Overtime Request"],p=["John Smith","Jane Doe","Bob Wilson","Alice Brown","Charlie Davis"];switch(e){case"submissions":return Array.from({length:20},(s,m)=>({referenceNumber:`REF-2024-${String(m+1).padStart(4,"0")}`,workflow:t[m%t.length],submitter:p[m%p.length],status:r[m%r.length],submittedAt:new Date(Date.now()-Math.random()*30*24*60*60*1e3),count:Math.floor(Math.random()*50)+1}));case"approvals":return p.map(s=>({approver:s,approved:Math.floor(Math.random()*50)+10,rejected:Math.floor(Math.random()*10),pending:Math.floor(Math.random()*15),avgResponseTime:(Math.random()*24+1).toFixed(1)}));case"performance":return t.map(s=>({workflow:s,avgProcessingTime:(Math.random()*48+2).toFixed(1),minTime:(Math.random()*2+.5).toFixed(1),maxTime:(Math.random()*72+24).toFixed(1),completionRate:(Math.random()*30+70).toFixed(1)}));case"financial":return t.map(s=>({category:s,totalAmount:Math.floor(Math.random()*1e5)+1e4,count:Math.floor(Math.random()*100)+20,avgAmount:Math.floor(Math.random()*5e3)+500}));default:return Array.from({length:10},(s,m)=>({name:`Item ${m+1}`,value:Math.floor(Math.random()*1e3),percentage:(Math.random()*100).toFixed(1)}))}}getMockSummary(){return{totalRecords:Math.floor(Math.random()*500)+100,totalAmount:Math.floor(Math.random()*5e5)+5e4,avgProcessingTime:(Math.random()*24+4).toFixed(1),completionRate:(Math.random()*20+80).toFixed(1)}}getSummaryItems(){if(!this.reportResult?.summary)return[];let e=this.reportResult.summary;return[{label:"Total Records",value:e.totalRecords?.toLocaleString()||"0",icon:"description",color:"#1976d2"},{label:"Total Amount",value:"$"+(e.totalAmount?.toLocaleString()||"0"),icon:"attach_money",color:"#2e7d32"},{label:"Avg Processing Time",value:(e.avgProcessingTime||"0")+" hrs",icon:"schedule",color:"#ed6c02"},{label:"Completion Rate",value:(e.completionRate||"0")+"%",icon:"check_circle",color:"#9c27b0"}]}formatParameters(){let e={};return this.parameters.startDate&&(e.startDate=this.parameters.startDate.toISOString().split("T")[0]),this.parameters.endDate&&(e.endDate=this.parameters.endDate.toISOString().split("T")[0]),this.parameters.approvedStartDate&&(e.approvedStartDate=this.parameters.approvedStartDate.toISOString().split("T")[0]),this.parameters.approvedEndDate&&(e.approvedEndDate=this.parameters.approvedEndDate.toISOString().split("T")[0]),this.parameters.status&&(e.status=this.parameters.status),this.parameters.workflowId&&(e.workflowId=this.parameters.workflowId),this.parameters.userId&&(e.userId=this.parameters.userId),this.parameters.corporateId&&(e.corporateId=this.parameters.corporateId),this.parameters.sbuId&&(e.sbuId=this.parameters.sbuId),this.parameters.branchId&&(e.branchId=this.parameters.branchId),this.parameters.departmentId&&(e.departmentId=this.parameters.departmentId),this.parameters.groupBy&&(e.groupBy=this.parameters.groupBy),e}updatePaginatedData(){if(!this.reportResult)return;let e=this.currentPage*this.pageSize;this.paginatedData=this.reportResult.data.slice(e,e+this.pageSize)}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.updatePaginatedData()}sortData(e){if(!this.reportResult)return;let r=[...this.reportResult.data];!e.active||e.direction===""||(r.sort((t,p)=>{let s=e.direction==="asc";return this.compare(t[e.active],p[e.active],s)}),this.reportResult.data=r,this.updatePaginatedData())}compare(e,r,t){return e==null?t?1:-1:r==null?t?-1:1:(e<r?-1:1)*(t?1:-1)}exportReport(e){if(!this.reportResult){this.snackBar.open("Please run the report first","Close",{duration:3e3});return}switch(this.exporting=!0,this.snackBar.open(`Exporting to ${e.toUpperCase()}...`,"",{duration:2e3}),e){case"excel":this.exportToExcel();break;case"csv":this.exportToCsv();break;case"pdf":this.exportToPdf();break}}exportToExcel(){let e=this.reportResult.columns,r=this.reportResult.data,t=`<?xml version="1.0"?>
`;t+=`<?mso-application progid="Excel.Sheet"?>
`,t+=`<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
`,t+=`  xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">
`,t+=`  <Worksheet ss:Name="Report">
`,t+=`    <Table>
`,t+=`      <Row>
`,e.forEach(s=>{t+=`        <Cell><Data ss:Type="String">${this.escapeXml(s.header)}</Data></Cell>
`}),t+=`      </Row>
`,r.forEach(s=>{t+=`      <Row>
`,e.forEach(m=>{let v=s[m.field];t+=`        <Cell><Data ss:Type="${typeof v=="number"?"Number":"String"}">${this.escapeXml(String(v??""))}</Data></Cell>
`}),t+=`      </Row>
`}),t+=`    </Table>
`,t+=`  </Worksheet>
`,t+="</Workbook>";let p=new Blob([t],{type:"application/vnd.ms-excel"});this.downloadBlob(p,`${this.report?.name||"report"}.xls`),this.exporting=!1,this.snackBar.open("Export completed","Close",{duration:3e3})}exportToCsv(){let e=this.reportResult.columns,r=this.reportResult.data,t=e.map(s=>`"${s.header}"`).join(",")+`
`;r.forEach(s=>{t+=e.map(m=>{let v=s[m.field];return v==null?'""':typeof v=="string"?`"${v.replace(/"/g,'""')}"`:`"${v}"`}).join(",")+`
`});let p=new Blob([t],{type:"text/csv;charset=utf-8;"});this.downloadBlob(p,`${this.report?.name||"report"}.csv`),this.exporting=!1,this.snackBar.open("Export completed","Close",{duration:3e3})}exportToPdf(){let e=this.reportResult.columns,r=this.reportResult.data,t=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>${this.report?.name||"Report"}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1 { color: #1976d2; font-size: 24px; margin-bottom: 5px; }
          .subtitle { color: #666; margin-bottom: 20px; }
          .meta { color: #999; font-size: 12px; margin-bottom: 20px; }
          table { border-collapse: collapse; width: 100%; font-size: 12px; }
          th { background: #1976d2; color: white; padding: 10px; text-align: left; }
          td { padding: 8px; border-bottom: 1px solid #ddd; }
          tr:nth-child(even) { background: #f9f9f9; }
          .summary { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; }
          .summary h3 { margin: 0 0 10px 0; color: #333; }
          .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
          .summary-item { text-align: center; }
          .summary-value { font-size: 18px; font-weight: bold; color: #1976d2; }
          .summary-label { font-size: 11px; color: #666; }
          @media print {
            body { margin: 0; }
            .no-print { display: none; }
          }
        </style>
      </head>
      <body>
        <h1>${this.report?.name||"Report"}</h1>
        <p class="subtitle">${this.report?.description||""}</p>
        <p class="meta">Generated: ${new Date().toLocaleString()} | Records: ${r.length}</p>

        <div class="summary">
          <h3>Summary</h3>
          <div class="summary-grid">
            ${this.getSummaryItems().map(s=>`
              <div class="summary-item">
                <div class="summary-value">${s.value}</div>
                <div class="summary-label">${s.label}</div>
              </div>
            `).join("")}
          </div>
        </div>

        <table>
          <thead>
            <tr>
              ${e.map(s=>`<th>${s.header}</th>`).join("")}
            </tr>
          </thead>
          <tbody>
            ${r.map(s=>`
              <tr>
                ${e.map(m=>`<td>${this.formatCellValue(s[m.field],m.type)}</td>`).join("")}
              </tr>
            `).join("")}
          </tbody>
        </table>
      </body>
      </html>
    `,p=window.open("","_blank");p&&(p.document.write(t),p.document.close(),p.focus(),setTimeout(()=>{p.print(),p.close()},250)),this.exporting=!1,this.snackBar.open("PDF opened for printing","Close",{duration:3e3})}formatCellValue(e,r){if(e==null)return"";switch(r){case"date":return new Date(e).toLocaleDateString();case"datetime":return new Date(e).toLocaleString();case"currency":return"$"+Number(e).toLocaleString();case"number":return Number(e).toLocaleString();case"percentage":return Number(e).toFixed(1)+"%";default:return String(e)}}escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}downloadBlob(e,r){let t=window.URL.createObjectURL(e),p=document.createElement("a");p.href=t,p.download=r,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(t)}static \u0275fac=function(r){return new(r||a)(k(K),k(Q),k(Be),k(De),k(Y))};static \u0275cmp=W({type:a,selectors:[["app-report-viewer"]],decls:176,vars:50,consts:[["exportMenu","matMenu"],["startPicker",""],["endPicker",""],["approvedStartPicker",""],["approvedEndPicker",""],["statusAuto","matAutocomplete"],["workflowAuto","matAutocomplete"],["userAuto","matAutocomplete"],["corporateAuto","matAutocomplete"],["sbuAuto","matAutocomplete"],["branchAuto","matAutocomplete"],["departmentAuto","matAutocomplete"],["groupByAuto","matAutocomplete"],[1,"report-viewer"],[1,"header"],[1,"header-left"],["mat-icon-button","","routerLink","/reports"],[1,"report-title"],[1,"subtitle"],[1,"header-actions"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-button","",3,"matMenuTriggerFor","disabled"],["mat-menu-item","",3,"click"],[1,"parameters-card"],[1,"parameters-form"],[1,"filter-field"],["appearance","outline"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],["type","text","matInput","",3,"formControl","matAutocomplete"],["matSuffix",""],[3,"optionSelected","displayWith"],[3,"value"],[1,"filter-actions"],["mat-button","",3,"click"],[1,"loading-state"],[1,"summary-cards"],[1,"results-card"],[1,"empty-state"],["diameter","40"],[1,"summary-card"],[1,"summary-icon"],[1,"summary-info"],[1,"summary-value"],[1,"summary-label"],[1,"result-count"],[1,"generated-at"],[1,"table-container"],["mat-table","","matSort","",3,"matSortChange","dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],["mat-header-cell","","mat-sort-header","",3,"text-align",4,"matHeaderCellDef"],["mat-cell","",3,"text-align",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"status-badge",3,"class"],[1,"status-badge"],["mat-header-row",""],["mat-row",""]],template:function(r,t){if(r&1){let p=z();n(0,"div",13)(1,"div",14)(2,"div",15)(3,"button",16)(4,"mat-icon"),l(5,"arrow_back"),i()(),n(6,"div",17)(7,"h1"),l(8),i(),n(9,"p",18),l(10),i()()(),n(11,"div",19)(12,"button",20),_("click",function(){return f(p),h(t.runReport())}),n(13,"mat-icon"),l(14,"play_arrow"),i(),l(15," Run Report "),i(),n(16,"button",21)(17,"mat-icon"),l(18,"download"),i(),l(19),i(),n(20,"mat-menu",null,0)(22,"button",22),_("click",function(){return f(p),h(t.exportReport("excel"))}),n(23,"mat-icon"),l(24,"table_chart"),i(),n(25,"span"),l(26,"Export to Excel (.xlsx)"),i()(),n(27,"button",22),_("click",function(){return f(p),h(t.exportReport("csv"))}),n(28,"mat-icon"),l(29,"description"),i(),n(30,"span"),l(31,"Export to CSV"),i()(),n(32,"button",22),_("click",function(){return f(p),h(t.exportReport("pdf"))}),n(33,"mat-icon"),l(34,"picture_as_pdf"),i(),n(35,"span"),l(36,"Export to PDF"),i()()()()(),n(37,"mat-card",23)(38,"mat-card-header")(39,"mat-card-title")(40,"mat-icon"),l(41,"tune"),i(),l(42," Report Filters "),i()(),n(43,"mat-card-content")(44,"div",24)(45,"div",25)(46,"mat-form-field",26)(47,"mat-label"),l(48,"Date Captured - From"),i(),n(49,"input",27),V("ngModelChange",function(m){return f(p),I(t.parameters.startDate,m)||(t.parameters.startDate=m),h(m)}),i(),g(50,"mat-datepicker-toggle",28)(51,"mat-datepicker",null,1),i()(),n(53,"div",25)(54,"mat-form-field",26)(55,"mat-label"),l(56,"Date Captured - To"),i(),n(57,"input",27),V("ngModelChange",function(m){return f(p),I(t.parameters.endDate,m)||(t.parameters.endDate=m),h(m)}),i(),g(58,"mat-datepicker-toggle",28)(59,"mat-datepicker",null,2),i()(),n(61,"div",25)(62,"mat-form-field",26)(63,"mat-label"),l(64,"Date Approved - From"),i(),n(65,"input",27),V("ngModelChange",function(m){return f(p),I(t.parameters.approvedStartDate,m)||(t.parameters.approvedStartDate=m),h(m)}),i(),g(66,"mat-datepicker-toggle",28)(67,"mat-datepicker",null,3),i()(),n(69,"div",25)(70,"mat-form-field",26)(71,"mat-label"),l(72,"Date Approved - To"),i(),n(73,"input",27),V("ngModelChange",function(m){return f(p),I(t.parameters.approvedEndDate,m)||(t.parameters.approvedEndDate=m),h(m)}),i(),g(74,"mat-datepicker-toggle",28)(75,"mat-datepicker",null,4),i()(),n(77,"div",25)(78,"mat-form-field",26)(79,"mat-label"),l(80,"Status"),i(),g(81,"input",29),n(82,"mat-icon",30),l(83,"arrow_drop_down"),i(),n(84,"mat-autocomplete",31,5),_("optionSelected",function(m){return f(p),h(t.onStatusSelected(m))}),b(86,Ct,2,2,"mat-option",32,R),S(88,"async"),i()()(),n(89,"div",25)(90,"mat-form-field",26)(91,"mat-label"),l(92,"Workflow"),i(),g(93,"input",29),n(94,"mat-icon",30),l(95,"arrow_drop_down"),i(),n(96,"mat-autocomplete",31,6),_("optionSelected",function(m){return f(p),h(t.onWorkflowSelected(m))}),b(98,wt,2,2,"mat-option",32,R),i()()(),n(100,"div",25)(101,"mat-form-field",26)(102,"mat-label"),l(103,"User"),i(),g(104,"input",29),n(105,"mat-icon",30),l(106,"arrow_drop_down"),i(),n(107,"mat-autocomplete",31,7),_("optionSelected",function(m){return f(p),h(t.onUserSelected(m))}),b(109,yt,2,2,"mat-option",32,R),i()()(),n(111,"div",25)(112,"mat-form-field",26)(113,"mat-label"),l(114,"Corporate"),i(),g(115,"input",29),n(116,"mat-icon",30),l(117,"arrow_drop_down"),i(),n(118,"mat-autocomplete",31,8),_("optionSelected",function(m){return f(p),h(t.onCorporateSelected(m))}),b(120,bt,2,2,"mat-option",32,R),i()()(),n(122,"div",25)(123,"mat-form-field",26)(124,"mat-label"),l(125,"SBU"),i(),g(126,"input",29),n(127,"mat-icon",30),l(128,"arrow_drop_down"),i(),n(129,"mat-autocomplete",31,9),_("optionSelected",function(m){return f(p),h(t.onSbuSelected(m))}),b(131,xt,2,2,"mat-option",32,R),i()()(),n(133,"div",25)(134,"mat-form-field",26)(135,"mat-label"),l(136,"Branch"),i(),g(137,"input",29),n(138,"mat-icon",30),l(139,"arrow_drop_down"),i(),n(140,"mat-autocomplete",31,10),_("optionSelected",function(m){return f(p),h(t.onBranchSelected(m))}),b(142,vt,2,2,"mat-option",32,R),i()()(),n(144,"div",25)(145,"mat-form-field",26)(146,"mat-label"),l(147,"Department"),i(),g(148,"input",29),n(149,"mat-icon",30),l(150,"arrow_drop_down"),i(),n(151,"mat-autocomplete",31,11),_("optionSelected",function(m){return f(p),h(t.onDepartmentSelected(m))}),b(153,St,2,2,"mat-option",32,R),i()()(),n(155,"div",25)(156,"mat-form-field",26)(157,"mat-label"),l(158,"Group By"),i(),g(159,"input",29),n(160,"mat-icon",30),l(161,"arrow_drop_down"),i(),n(162,"mat-autocomplete",31,12),_("optionSelected",function(m){return f(p),h(t.onGroupBySelected(m))}),b(164,Mt,2,2,"mat-option",32,R),S(166,"async"),i()()()(),n(167,"div",33)(168,"button",34),_("click",function(){return f(p),h(t.clearFilters())}),n(169,"mat-icon"),l(170,"clear"),i(),l(171," Clear Filters "),i()()()(),E(172,Rt,4,0,"div",35)(173,Dt,3,0,"div",36)(174,Lt,19,12,"mat-card",37)(175,jt,7,0,"div",38),i()}if(r&2){let p=C(21),s=C(52),m=C(60),v=C(68),B=C(76),lt=C(85),pt=C(97),mt=C(108),st=C(119),dt=C(130),ct=C(141),ut=C(152),ft=C(163);o(8),w((t.report==null?null:t.report.name)||"Report"),o(2),w(t.report==null?null:t.report.description),o(2),c("disabled",t.loading),o(4),c("matMenuTriggerFor",p)("disabled",!t.reportResult||t.exporting),o(3),y(" ",t.exporting?"Exporting...":"Export"," "),o(30),c("matDatepicker",s),P("ngModel",t.parameters.startDate),o(),c("for",s),o(7),c("matDatepicker",m),P("ngModel",t.parameters.endDate),o(),c("for",m),o(7),c("matDatepicker",v),P("ngModel",t.parameters.approvedStartDate),o(),c("for",v),o(7),c("matDatepicker",B),P("ngModel",t.parameters.approvedEndDate),o(),c("for",B),o(7),c("formControl",t.statusControl)("matAutocomplete",lt),o(3),c("displayWith",t.displayStatus),o(2),x(T(88,46,t.filteredStatuses)),o(7),c("formControl",t.workflowControl)("matAutocomplete",pt),o(3),c("displayWith",t.displayLookup),o(2),x(t.getFilteredWorkflows()),o(6),c("formControl",t.userControl)("matAutocomplete",mt),o(3),c("displayWith",t.displayLookup),o(2),x(t.getFilteredUsers()),o(6),c("formControl",t.corporateControl)("matAutocomplete",st),o(3),c("displayWith",t.displayLookup),o(2),x(t.getFilteredCorporates()),o(6),c("formControl",t.sbuControl)("matAutocomplete",dt),o(3),c("displayWith",t.displayLookup),o(2),x(t.getFilteredSbuOptions()),o(6),c("formControl",t.branchControl)("matAutocomplete",ct),o(3),c("displayWith",t.displayLookup),o(2),x(t.getFilteredBranchOptions()),o(6),c("formControl",t.departmentControl)("matAutocomplete",ut),o(3),c("displayWith",t.displayLookup),o(2),x(t.getFilteredDepartments()),o(6),c("formControl",t.groupByControl)("matAutocomplete",ft),o(3),c("displayWith",t.displayLookup),o(2),x(T(166,48,t.filteredGroupByOptions)),o(8),D(t.loading?172:-1),o(),D(t.reportResult!=null&&t.reportResult.summary&&!t.loading?173:-1),o(),D(t.reportResult&&!t.loading?174:-1),o(),D(!t.reportResult&&!t.loading?175:-1)}},dependencies:[X,G,q,J,H,ee,Z,le,ie,ae,ne,pe,oe,Ce,fe,ge,_e,he,ue,ce,de,se,me,xe,be,we,ye,Se,ve,ke,te,it,et,tt,rt,re,qe,Fe,ze,Ue,We,$e,Ne,Le,je,Ge,He,Ye,Xe,Ze,Ke,Qe,Re,Me,Ee,Te,Ie,Pe,Ve,Ae,Je,Oe,ot,at,nt],styles:[".report-viewer[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.5rem}.report-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.report-title[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:#666;font-size:.9rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.parameters-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.parameters-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:1rem}.parameters-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1rem;padding-top:.5rem}.filter-field[_ngcontent-%COMP%]{width:100%}.filter-field[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.parameters-form[_ngcontent-%COMP%]     .mat-mdc-form-field{width:100%}.parameters-form[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper{height:56px}.parameters-form[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{min-height:56px;display:flex;align-items:center}@media (max-width: 768px){.parameters-form[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}}@media (max-width: 600px){.parameters-form[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media (max-width: 400px){.parameters-form[_ngcontent-%COMP%]{grid-template-columns:1fr}}  .parameters-form .mat-mdc-form-field{font-size:var(--report-font-size, 14px)}  .parameters-form .mat-mdc-select-value,   .parameters-form .mat-mdc-input-element,   .parameters-form .mdc-floating-label,   .parameters-form .mat-mdc-floating-label,   .parameters-form .mat-mdc-select-placeholder,   .parameters-form .mat-mdc-form-field-hint,   .parameters-form .mat-mdc-form-field-error{font-size:var(--report-font-size, 14px)!important}  .parameters-form .mat-mdc-option{font-size:var(--report-font-size, 14px)!important;min-height:calc(var(--report-font-size, 14px) * 3)!important}  .parameters-form .mat-datepicker-toggle button{font-size:var(--report-font-size, 14px)}[_nghost-%COMP%]     .cdk-overlay-pane .mat-mdc-option{font-size:var(--report-font-size, 14px)!important}.filter-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:1rem;padding-top:1rem;border-top:1px solid #eee}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:4rem 2rem;color:#666}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:1rem}.summary-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}.summary-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem!important}.summary-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center}.summary-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px}.summary-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.summary-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#333}.summary-label[_ngcontent-%COMP%]{font-size:.8rem;color:#666}.results-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.results-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:1rem}.result-count[_ngcontent-%COMP%]{font-weight:400;color:#666;font-size:.9rem}.generated-at[_ngcontent-%COMP%]{font-size:.8rem;color:#666}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:.75rem;font-weight:500}.status-badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.status-badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.status-badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.status-badge.draft[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.status-badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.status-badge.cancelled[_ngcontent-%COMP%]{background:#fafafa;color:#9e9e9e}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;background:#fff;border-radius:8px;text-align:center}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#1976d2;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:1rem 0 .5rem;color:#333}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666}"]})}return a})();export{Ir as ReportViewerComponent};
