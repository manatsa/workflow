import{a as _e}from"./chunk-DVQGFA7F.js";import{a as he,b as be}from"./chunk-EO5WAGLV.js";import{a as pe,b as ue,c as fe}from"./chunk-IGTQ3GOP.js";import"./chunk-MS4AQ6UA.js";import{a as de,b as ce}from"./chunk-B7S7HKPH.js";import"./chunk-DVTP2NLI.js";import{c as A}from"./chunk-RP3FIGZU.js";import{b as oe}from"./chunk-LUBHRDD6.js";import"./chunk-22QFHSXK.js";import"./chunk-KPLEND2O.js";import{a as le}from"./chunk-3HKR6USX.js";import{a as se,b as me}from"./chunk-XQHIDIE5.js";import"./chunk-LETYTNCA.js";import"./chunk-M3GLKEYP.js";import{a as re,c as ne,d as ae}from"./chunk-ZK2UDSKG.js";import{b as W,c as Z,d as ee,e as te,i as ie}from"./chunk-FHBRY4FZ.js";import{d as k,f as C,h as D,i as q,l as R,n as $,o as L,r as V,t as G}from"./chunk-JITRQZ7S.js";import{a as J,c as K,h as Q}from"./chunk-LB6LFADN.js";import"./chunk-Q5RCCGFX.js";import"./chunk-W4XF3NOO.js";import{a as P,c as w,d as B,g as O}from"./chunk-PKMLTJ2J.js";import{m as U,qa as j,ra as z,sa as X,ta as Y,va as H}from"./chunk-LBWRLA47.js";import{Ab as b,Fb as u,Hb as N,Ib as g,Jb as S,Kb as r,Lb as i,Mb as _,Ub as y,Vb as x,bb as s,dc as n,ec as E,fc as v,gb as I,nb as T,tb as f}from"./chunk-5XIHPI6O.js";var F=function(t){return t.SYSTEM="SYSTEM",t.STAFF="STAFF",t.MANAGER="MANAGER",t.EXTERNAL="EXTERNAL",t}(F||{});var M=(t,m)=>m.id;function Ce(t,m){t&1&&(r(0,"mat-error"),n(1,"Username is required"),i())}function ge(t,m){t&1&&(r(0,"mat-error"),n(1,"Email is required"),i())}function Se(t,m){t&1&&(r(0,"mat-error"),n(1,"Please enter a valid email"),i())}function ve(t,m){t&1&&(r(0,"mat-error"),n(1,"Password is required"),i())}function Ie(t,m){t&1&&(r(0,"mat-error"),n(1,"Password must be at least 8 characters"),i())}function xe(t,m){t&1&&(r(0,"mat-error"),n(1,"Passwords do not match"),i())}function Ee(t,m){if(t&1&&(r(0,"div",7)(1,"mat-form-field",8)(2,"mat-label"),n(3,"Password"),i(),_(4,"input",37),r(5,"mat-icon",10),n(6,"lock"),i(),f(7,ve,2,0,"mat-error")(8,Ie,2,0,"mat-error"),i(),r(9,"mat-form-field",8)(10,"mat-label"),n(11,"Confirm Password"),i(),_(12,"input",38),r(13,"mat-icon",10),n(14,"lock_outline"),i(),f(15,xe,2,0,"mat-error"),i()()),t&2){let e,a,o=x();s(7),u((e=o.userForm.get("password"))!=null&&e.hasError("required")?7:-1),s(),u((a=o.userForm.get("password"))!=null&&a.hasError("minlength")?8:-1),s(7),u(o.userForm.hasError("passwordMismatch")?15:-1)}}function Fe(t,m){t&1&&(r(0,"mat-error"),n(1,"First name is required"),i())}function Me(t,m){t&1&&(r(0,"mat-error"),n(1,"Last name is required"),i())}function ye(t,m){if(t&1&&(r(0,"mat-option",19),n(1),i()),t&2){let e=m.$implicit;b("value",e),s(),E(e)}}function Ne(t,m){if(t&1&&(r(0,"mat-option",19),n(1),i()),t&2){let e=m.$implicit;b("value",e.id),s(),E(e.name)}}function Te(t,m){if(t&1&&(r(0,"mat-option",19),n(1),i()),t&2){let e=m.$implicit;b("value",e.id),s(),E(e.name)}}function Ue(t,m){if(t&1&&n(0),t&2){let e=x().$implicit;v(" (",e.corporateName,") ")}}function Pe(t,m){if(t&1&&(r(0,"mat-option",19),n(1),f(2,Ue,1,1),i()),t&2){let e=m.$implicit;b("value",e.id),s(),v("",e.name," "),s(),u(e.corporateName?2:-1)}}function we(t,m){if(t&1&&n(0),t&2){let e=x().$implicit;v(" (",e.sbuName,") ")}}function Be(t,m){if(t&1&&(r(0,"mat-option",19),n(1),f(2,we,1,1),i()),t&2){let e=m.$implicit;b("value",e.id),s(),v("",e.name," "),s(),u(e.sbuName?2:-1)}}function Oe(t,m){if(t&1&&n(0),t&2){let e=x().$implicit;v(" (",e.corporateName,") ")}}function Ae(t,m){if(t&1&&(r(0,"mat-option",19),n(1),f(2,Oe,1,1),i()),t&2){let e=m.$implicit;b("value",e.id),s(),v("",e.name," "),s(),u(e.corporateName?2:-1)}}function ke(t,m){t&1&&(r(0,"p",28),n(1,"No restrictions - User has global access to all data"),i())}function De(t,m){if(t&1&&(r(0,"span",39),n(1),i()),t&2){let e=m.$implicit;s(),E(e)}}function qe(t,m){if(t&1&&(r(0,"div",29),g(1,De,2,1,"span",39,N),i()),t&2){let e=x();s(),S(e.getAccessSummary())}}function Re(t,m){t&1&&n(0," Saving... ")}function $e(t,m){if(t&1&&n(0),t&2){let e=x();v(" ",e.isEdit?"Update User":"Create User"," ")}}var bt=(()=>{class t{fb;userService;departmentService;router;route;snackBar;userForm;isEdit=!1;loading=!1;userId=null;roles=[];sbus=[];filteredSbus=[];corporates=[];branches=[];filteredBranches=[];departments=[];filteredDepartments=[];userTypes=[F.SYSTEM,F.STAFF,F.MANAGER,F.EXTERNAL];constructor(e,a,o,d,p,l){this.fb=e,this.userService=a,this.departmentService=o,this.router=d,this.route=p,this.snackBar=l,this.userForm=this.fb.group({username:["",C.required],email:["",[C.required,C.email]],password:[""],confirmPassword:[""],firstName:["",C.required],lastName:["",C.required],phone:[""],staffId:[""],department:[""],userType:["STAFF",C.required],roleIds:[[]],corporateIds:[[]],sbuIds:[[]],branchIds:[[]],departmentIds:[[]],enabled:[!0],mustChangePassword:[!0]},{validators:this.passwordMatchValidator})}ngOnInit(){this.loadRoles(),this.loadCorporates(),this.loadSbus(),this.loadBranches(),this.loadDepartments(),this.userId=this.route.snapshot.paramMap.get("id"),this.userId&&this.userId!=="new"?(this.isEdit=!0,this.loadUser()):(this.userForm.get("password")?.setValidators([C.required,C.minLength(8)]),this.userForm.get("confirmPassword")?.setValidators([C.required]))}passwordMatchValidator(e){let a=e.get("password")?.value,o=e.get("confirmPassword")?.value;return!a&&!o||a===o?null:{passwordMismatch:!0}}loadRoles(){this.userService.getRoles().subscribe(e=>{e.success&&(this.roles=e.data)})}loadCorporates(){this.userService.getActiveCorporates().subscribe(e=>{e.success&&(this.corporates=e.data)})}loadSbus(){this.userService.getSbus().subscribe(e=>{e.success&&(this.sbus=e.data,this.filteredSbus=[...this.sbus])})}loadBranches(){this.userService.getActiveBranches().subscribe(e=>{e.success&&(this.branches=e.data,this.filteredBranches=[...this.branches])})}loadDepartments(){this.departmentService.getActiveDepartments().subscribe(e=>{e.success&&(this.departments=e.data,this.filteredDepartments=[...this.departments])})}onCorporateChange(){let e=this.userForm.get("corporateIds")?.value||[];e.length>0?(this.filteredSbus=this.sbus.filter(l=>e.includes(l.corporateId||"")),this.filteredDepartments=this.departments.filter(l=>e.includes(l.corporateId||""))):(this.filteredSbus=[...this.sbus],this.filteredDepartments=[...this.departments]);let a=this.userForm.get("sbuIds")?.value||[],o=a.filter(l=>this.filteredSbus.some(c=>c.id===l));o.length!==a.length&&this.userForm.patchValue({sbuIds:o});let d=this.userForm.get("departmentIds")?.value||[],p=d.filter(l=>this.filteredDepartments.some(c=>c.id===l));p.length!==d.length&&this.userForm.patchValue({departmentIds:p}),this.onSbuChange()}onSbuChange(){let e=this.userForm.get("sbuIds")?.value||[],a=this.userForm.get("corporateIds")?.value||[];if(e.length>0)this.filteredBranches=this.branches.filter(p=>e.includes(p.sbuId));else if(a.length>0){let p=this.sbus.filter(l=>a.includes(l.corporateId||"")).map(l=>l.id);this.filteredBranches=this.branches.filter(l=>p.includes(l.sbuId))}else this.filteredBranches=[...this.branches];let o=this.userForm.get("branchIds")?.value||[],d=o.filter(p=>this.filteredBranches.some(l=>l.id===p));d.length!==o.length&&this.userForm.patchValue({branchIds:d})}getAccessSummary(){let e=[],a=this.userForm.get("corporateIds")?.value||[],o=this.userForm.get("sbuIds")?.value||[],d=this.userForm.get("branchIds")?.value||[],p=this.userForm.get("departmentIds")?.value||[];return a.forEach(l=>{let c=this.corporates.find(h=>h.id===l);c&&e.push(`Corporate: ${c.name}`)}),o.forEach(l=>{let c=this.sbus.find(h=>h.id===l);c&&e.push(`SBU: ${c.name}`)}),d.forEach(l=>{let c=this.branches.find(h=>h.id===l);c&&e.push(`Branch: ${c.name}`)}),p.forEach(l=>{let c=this.departments.find(h=>h.id===l);c&&e.push(`Department: ${c.name}`)}),e}loadUser(){this.userId&&this.userService.getUser(this.userId).subscribe(e=>{if(e.success){let a=e.data;this.userForm.patchValue({username:a.username,email:a.email,firstName:a.firstName,lastName:a.lastName,phone:a.phoneNumber,staffId:a.staffId,department:a.department,userType:a.userType,roleIds:a.roleIds||[],corporateIds:a.corporateIds||[],sbuIds:a.sbuIds||[],branchIds:a.branchIds||[],departmentIds:a.departmentIds||[],enabled:a.enabled??a.isActive,mustChangePassword:a.mustChangePassword}),setTimeout(()=>{this.onCorporateChange()},100)}})}onSubmit(){if(this.userForm.invalid)return;this.loading=!0;let e=this.userForm.value,a={username:e.username,email:e.email,password:e.password||void 0,firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phone,staffId:e.staffId,department:e.department,userType:e.userType,roleIds:e.roleIds,corporateIds:e.corporateIds,sbuIds:e.sbuIds,branchIds:e.branchIds,departmentIds:e.departmentIds,enabled:e.enabled,mustChangePassword:e.mustChangePassword};(this.isEdit?this.userService.updateUser(this.userId,a):this.userService.createUser(a)).subscribe({next:d=>{this.loading=!1,d.success?(this.snackBar.open(this.isEdit?"User updated successfully":"User created successfully","Close",{duration:3e3}),this.router.navigate(["/users"])):this.snackBar.open(d.message||"Operation failed","Close",{duration:3e3})},error:d=>{this.loading=!1,this.snackBar.open(d.error?.message||"An error occurred","Close",{duration:3e3})}})}static \u0275fac=function(a){return new(a||t)(I(V),I(le),I(_e),I(w),I(P),I(se))};static \u0275cmp=T({type:t,selectors:[["app-user-form"]],decls:140,vars:12,consts:[[1,"user-form-container"],[1,"header"],["mat-icon-button","","routerLink","/users"],[3,"ngSubmit","formGroup"],["label","User Details"],[1,"tab-content"],[1,"form-section"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","username",3,"readonly"],["matPrefix",""],["matInput","","formControlName","email","type","email"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["matInput","","formControlName","phone"],["matInput","","formControlName","staffId"],["appearance","outline",1,"form-field","full-width"],["matInput","","formControlName","department"],["formControlName","userType"],[3,"value"],["formControlName","roleIds","multiple",""],["label","Access Permissions"],[1,"access-info"],["formControlName","corporateIds","multiple","",3,"selectionChange"],["formControlName","sbuIds","multiple","",3,"selectionChange"],["formControlName","branchIds","multiple",""],["formControlName","departmentIds","multiple",""],[1,"access-summary"],[1,"no-restrictions"],[1,"restriction-chips"],[1,"global-options"],[1,"checkbox-row"],["formControlName","enabled"],["formControlName","mustChangePassword"],[1,"form-actions"],["mat-button","","type","button","routerLink","/users"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["matInput","","formControlName","password","type","password"],["matInput","","formControlName","confirmPassword","type","password"],[1,"access-chip"]],template:function(a,o){if(a&1&&(r(0,"div",0)(1,"div",1)(2,"button",2)(3,"mat-icon"),n(4,"arrow_back"),i()(),r(5,"h1"),n(6),i()(),r(7,"mat-card")(8,"mat-card-content")(9,"form",3),y("ngSubmit",function(){return o.onSubmit()}),r(10,"mat-tab-group")(11,"mat-tab",4)(12,"div",5)(13,"div",6)(14,"h3"),n(15,"Account Information"),i(),r(16,"div",7)(17,"mat-form-field",8)(18,"mat-label"),n(19,"Username"),i(),_(20,"input",9),r(21,"mat-icon",10),n(22,"person"),i(),f(23,Ce,2,0,"mat-error"),i(),r(24,"mat-form-field",8)(25,"mat-label"),n(26,"Email"),i(),_(27,"input",11),r(28,"mat-icon",10),n(29,"email"),i(),f(30,ge,2,0,"mat-error")(31,Se,2,0,"mat-error"),i()(),f(32,Ee,16,3,"div",7),i(),r(33,"div",6)(34,"h3"),n(35,"Personal Information"),i(),r(36,"div",7)(37,"mat-form-field",8)(38,"mat-label"),n(39,"First Name"),i(),_(40,"input",12),f(41,Fe,2,0,"mat-error"),i(),r(42,"mat-form-field",8)(43,"mat-label"),n(44,"Last Name"),i(),_(45,"input",13),f(46,Me,2,0,"mat-error"),i()(),r(47,"div",7)(48,"mat-form-field",8)(49,"mat-label"),n(50,"Phone"),i(),_(51,"input",14),r(52,"mat-icon",10),n(53,"phone"),i()(),r(54,"mat-form-field",8)(55,"mat-label"),n(56,"Staff ID"),i(),_(57,"input",15),r(58,"mat-icon",10),n(59,"badge"),i()()(),r(60,"mat-form-field",16)(61,"mat-label"),n(62,"Department"),i(),_(63,"input",17),r(64,"mat-icon",10),n(65,"business"),i()()(),r(66,"div",6)(67,"h3"),n(68,"Roles & User Type"),i(),r(69,"div",7)(70,"mat-form-field",8)(71,"mat-label"),n(72,"User Type"),i(),r(73,"mat-select",18),g(74,ye,2,2,"mat-option",19,N),i()(),r(76,"mat-form-field",8)(77,"mat-label"),n(78,"Roles"),i(),r(79,"mat-select",20),g(80,Ne,2,2,"mat-option",19,M),i()()()()()(),r(82,"mat-tab",21)(83,"div",5)(84,"div",22)(85,"mat-icon"),n(86,"info"),i(),r(87,"p"),n(88,"Leave all fields empty to grant the user global access to all data. Select specific corporates, SBUs, branches, or departments to restrict access."),i()(),r(89,"div",7)(90,"mat-form-field",8)(91,"mat-label"),n(92,"Corporates"),i(),r(93,"mat-select",23),y("selectionChange",function(){return o.onCorporateChange()}),g(94,Te,2,2,"mat-option",19,M),i(),r(96,"mat-hint"),n(97,"User can access data from selected corporates"),i()(),r(98,"mat-form-field",8)(99,"mat-label"),n(100,"SBUs"),i(),r(101,"mat-select",24),y("selectionChange",function(){return o.onSbuChange()}),g(102,Pe,3,3,"mat-option",19,M),i(),r(104,"mat-hint"),n(105,"Filtered by Corporate if selected"),i()()(),r(106,"div",7)(107,"mat-form-field",8)(108,"mat-label"),n(109,"Branches"),i(),r(110,"mat-select",25),g(111,Be,3,3,"mat-option",19,M),i(),r(113,"mat-hint"),n(114,"Filtered by SBU if selected"),i()(),r(115,"mat-form-field",8)(116,"mat-label"),n(117,"Departments"),i(),r(118,"mat-select",26),g(119,Ae,3,3,"mat-option",19,M),i(),r(121,"mat-hint"),n(122,"Filtered by Corporate if selected"),i()()(),r(123,"div",27)(124,"h4"),n(125,"Current Access Summary"),i(),f(126,ke,2,0,"p",28)(127,qe,3,0,"div",29),i()()()(),r(128,"div",30)(129,"div",31)(130,"mat-checkbox",32),n(131,"Account Enabled"),i(),r(132,"mat-checkbox",33),n(133,"Must Change Password on Next Login"),i()(),r(134,"div",34)(135,"button",35),n(136,"Cancel"),i(),r(137,"button",36),f(138,Re,1,0)(139,$e,1,1),i()()()()()()()),a&2){let d,p,l,c,h;s(6),E(o.isEdit?"Edit User":"Create User"),s(3),b("formGroup",o.userForm),s(11),b("readonly",o.isEdit),s(3),u((d=o.userForm.get("username"))!=null&&d.hasError("required")?23:-1),s(7),u((p=o.userForm.get("email"))!=null&&p.hasError("required")?30:-1),s(),u((l=o.userForm.get("email"))!=null&&l.hasError("email")?31:-1),s(),u(o.isEdit?-1:32),s(9),u((c=o.userForm.get("firstName"))!=null&&c.hasError("required")?41:-1),s(5),u((h=o.userForm.get("lastName"))!=null&&h.hasError("required")?46:-1),s(28),S(o.userTypes),s(6),S(o.roles),s(14),S(o.corporates),s(8),S(o.filteredSbus),s(9),S(o.filteredBranches),s(8),S(o.filteredDepartments),s(7),u(o.getAccessSummary().length===0?126:127),s(11),b("disabled",o.loading),s(),u(o.loading?138:139)}},dependencies:[U,G,R,k,D,q,$,L,O,B,Q,J,K,fe,pe,ue,re,ie,W,ee,Z,te,ae,ne,ce,de,A,H,Y,X,z,j,be,he,oe,me],styles:[".user-form-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.tab-content[_ngcontent-%COMP%]{padding:1.5rem 0}.form-section[_ngcontent-%COMP%]{margin-bottom:1.5rem;padding-bottom:1.5rem;border-bottom:1px solid #eee}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#333}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.form-field[_ngcontent-%COMP%]{flex:1}.full-width[_ngcontent-%COMP%]{width:100%}.global-options[_ngcontent-%COMP%]{border-top:1px solid #e0e0e0;padding-top:1.5rem;margin-top:1rem}.checkbox-row[_ngcontent-%COMP%]{display:flex;gap:2rem;margin-bottom:1rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1rem}.access-info[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;padding:1rem;background:#e3f2fd;border-radius:8px;margin-bottom:1.5rem}.access-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#1976d2;flex-shrink:0}.access-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#1565c0;font-size:.9rem}.access-summary[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid #e0e0e0}.access-summary[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1rem;font-weight:500;color:#333}.no-restrictions[_ngcontent-%COMP%]{color:#4caf50;font-weight:500}.restriction-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.access-chip[_ngcontent-%COMP%]{padding:.375rem .75rem;background:#e3f2fd;color:#1565c0;border-radius:16px;font-size:.85rem;font-weight:500}"]})}return t})();export{bt as UserFormComponent};
