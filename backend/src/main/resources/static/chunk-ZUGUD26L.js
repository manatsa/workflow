import{a as k}from"./chunk-7DLVJKCC.js";import{b as kt,c as Tt,d as Ot}from"./chunk-SNBLP2IG.js";import{a as J}from"./chunk-46GLNUOE.js";import{a as pt,b as _t,c as ut,d as ft}from"./chunk-YWWQJANS.js";import{a as st,b as mt}from"./chunk-I4PAJBBT.js";import{c as Ct}from"./chunk-IVI3BL2S.js";import{c as ct,h as dt}from"./chunk-ZLEDUOR5.js";import{b as rt,c as lt}from"./chunk-C5XODKZL.js";import"./chunk-LU6VCXUA.js";import{a as at,b as ot}from"./chunk-CDWC6WKW.js";import"./chunk-2AGPTHDJ.js";import"./chunk-QGDZCCER.js";import{a as gt,b as ht,c as bt,d as vt,e as St,f as Mt,g as Et,h as wt,i as Dt,j as It,k as yt}from"./chunk-ZLHYE5PR.js";import{a as X,b as tt,c as et,f as nt,h as it}from"./chunk-BTSRKJZZ.js";import{a as xt}from"./chunk-2UBRB5ZZ.js";import"./chunk-MNRHFUYD.js";import"./chunk-UF7Y5AYJ.js";import"./chunk-PMYQJTBZ.js";import{a as Q}from"./chunk-W7JX3HPD.js";import{a as z,c as $,d as U,g as G}from"./chunk-M6HZK7Y7.js";import{Aa as q,a as B,m as j,q as H,va as K,wa as Z,xa as W,ya as Y}from"./chunk-37H25STD.js";import{Eb as h,Hb as b,Jb as p,Mb as E,Nb as w,Ob as i,Pb as a,Qb as v,Rb as S,Sb as M,Ub as g,Yb as u,Zb as d,aa as O,ba as P,eb as l,ga as R,gc as L,hc as o,ic as s,jb as x,jc as D,kc as N,oa as f,pa as C,qb as A,rb as F,rc as V,tc as I,vc as y,wb as m}from"./chunk-UYCZSUYP.js";var T=class{_document;_textarea;constructor(r,e){this._document=e;let n=this._textarea=this._document.createElement("textarea"),c=n.style;c.position="fixed",c.top=c.opacity="0",c.left="-999em",n.setAttribute("aria-hidden","true"),n.value=r,n.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(n)}copy(){let r=this._textarea,e=!1;try{if(r){let n=this._document.activeElement;r.select(),r.setSelectionRange(0,r.value.length),e=this._document.execCommand("copy"),n&&n.focus()}}catch{}return e}destroy(){let r=this._textarea;r&&(r.remove(),this._textarea=void 0)}},Pt=(()=>{class t{_document=R(B);constructor(){}copy(e){let n=this.beginCopy(e),c=n.copy();return n.destroy(),c}beginCopy(e){return new T(e,this._document)}static \u0275fac=function(n){return new(n||t)};static \u0275prov=O({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Rt=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=F({type:t});static \u0275inj=P({})}return t})();var Ht=t=>["/approvals",t],zt=(t,r)=>r.fieldName,At=(t,r)=>r.id;function $t(t,r){t&1&&(i(0,"div",2),v(1,"mat-spinner",3),a())}function Ut(t,r){if(t&1){let e=g();i(0,"button",12),u("click",function(){f(e);let c=d(2);return C(c.editSubmission())}),i(1,"mat-icon"),o(2,"edit"),a(),i(3,"span"),o(4,"Edit Submission"),a()()}}function Gt(t,r){if(t&1){let e=g();i(0,"button",12),u("click",function(){f(e);let c=d(2);return C(c.deleteSubmission())}),i(1,"mat-icon"),o(2,"delete"),a(),i(3,"span"),o(4,"Delete Submission"),a()()}}function Kt(t,r){if(t&1){let e=g();i(0,"button",12),u("click",function(){f(e);let c=d(2);return C(c.recallSubmission())}),i(1,"mat-icon"),o(2,"undo"),a(),i(3,"span"),o(4,"Recall Submission"),a()()}}function Zt(t,r){if(t&1&&(i(0,"div",17)(1,"span",18),o(2,"Current Approval Level"),a(),i(3,"span",19),o(4),a()()),t&2){let e=d(2);l(4),D("Level ",e.instance.currentApprovalLevel,"")}}function Wt(t,r){if(t&1&&(i(0,"div",17)(1,"span",18),o(2),a(),i(3,"span",19),o(4),a()()),t&2){let e=r.$implicit;l(2),s(e.fieldLabel),l(2),s(e.value||"-")}}function Yt(t,r){if(t&1&&(v(0,"mat-divider"),i(1,"div",17)(2,"span",18),o(3,"Comments"),a(),i(4,"span",19),o(5),a()()),t&2){let e=d(2);l(5),s(e.instance.comments)}}function qt(t,r){if(t&1){let e=g();i(0,"div",28)(1,"mat-icon"),o(2,"description"),a(),i(3,"span",29),o(4),a(),i(5,"span",30),o(6),a(),i(7,"button",5),u("click",function(){let c=f(e).$implicit,_=d(3);return C(_.downloadAttachment(c))}),i(8,"mat-icon"),o(9,"download"),a()()()}if(t&2){let e=r.$implicit,n=d(3);l(4),s(e.originalFileName),l(2),D("(",n.formatFileSize(e.fileSize),")")}}function Jt(t,r){if(t&1&&(i(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),o(3,"Attachments"),a()(),i(4,"mat-card-content")(5,"div",27),E(6,qt,10,2,"div",28,At),a()()()),t&2){let e=d(2);l(6),w(e.instance.attachments)}}function Qt(t,r){t&1&&(i(0,"div",22)(1,"mat-icon"),o(2,"history"),a(),i(3,"p"),o(4,"No approval actions yet"),a()())}function Xt(t,r){t&1&&(i(0,"mat-icon"),o(1,"check"),a())}function te(t,r){t&1&&(i(0,"mat-icon"),o(1,"close"),a())}function ee(t,r){t&1&&(i(0,"mat-icon"),o(1,"arrow_upward"),a())}function ne(t,r){t&1&&(i(0,"mat-icon"),o(1,"undo"),a())}function ie(t,r){t&1&&(i(0,"mat-icon"),o(1,"pending"),a())}function ae(t,r){if(t&1&&(i(0,"div",36),o(1),a()),t&2){let e=d().$implicit;l(),D(' "',e.comments,'" ')}}function oe(t,r){if(t&1&&(i(0,"div",31)(1,"div",32),m(2,Xt,2,0,"mat-icon")(3,te,2,0,"mat-icon")(4,ee,2,0,"mat-icon")(5,ne,2,0,"mat-icon")(6,ie,2,0,"mat-icon"),a(),i(7,"div",33)(8,"div",34)(9,"strong"),o(10),a(),i(11,"span",8),o(12),a()(),i(13,"div",35),o(14),I(15,"date"),a(),m(16,ae,2,1,"div",36),a()()),t&2){let e,n=r.$implicit;l(),b(n.action.toLowerCase()),l(),p((e=n.action)==="APPROVED"?2:e==="REJECTED"?3:e==="ESCALATED"?4:e==="RECALLED"?5:6),l(8),s(n.approverName),l(),b(n.action.toLowerCase()),l(),s(n.action),l(2),N(" Level ",n.level," - ",y(15,10,n.createdAt,"medium")," "),l(2),p(n.comments?16:-1)}}function re(t,r){if(t&1&&(i(0,"div",23),E(1,oe,17,13,"div",31,At),a()),t&2){let e=d(2);l(),w(e.approvalHistory)}}function le(t,r){t&1&&(i(0,"div",22)(1,"mat-icon"),o(2,"receipt_long"),a(),i(3,"p"),o(4,"No audit logs available"),a()())}function ce(t,r){t&1&&(i(0,"th",45),o(1,"Date"),a())}function de(t,r){if(t&1&&(i(0,"td",46),o(1),I(2,"date"),a()),t&2){let e=r.$implicit;l(),s(y(2,1,e.actionDate,"medium"))}}function se(t,r){t&1&&(i(0,"th",45),o(1,"Action"),a())}function me(t,r){if(t&1&&(i(0,"td",46)(1,"span",8),o(2),a()()),t&2){let e=r.$implicit;l(2),s(e.action)}}function pe(t,r){t&1&&(i(0,"th",45),o(1,"User"),a())}function _e(t,r){if(t&1&&(i(0,"td",46),o(1),a()),t&2){let e=r.$implicit;l(),s(e.userFullName||e.username)}}function ue(t,r){t&1&&(i(0,"th",45),o(1,"Details"),a())}function fe(t,r){if(t&1&&(i(0,"td",46),o(1),a()),t&2){let e=r.$implicit;l(),s(e.summary||e.details)}}function Ce(t,r){t&1&&v(0,"tr",47)}function xe(t,r){t&1&&v(0,"tr",48)}function ge(t,r){if(t&1&&(i(0,"table",25),S(1,37),m(2,ce,2,0,"th",38)(3,de,3,4,"td",39),M(),S(4,40),m(5,se,2,0,"th",38)(6,me,3,1,"td",39),M(),S(7,41),m(8,pe,2,0,"th",38)(9,_e,2,1,"td",39),M(),S(10,42),m(11,ue,2,0,"th",38)(12,fe,2,1,"td",39),M(),m(13,Ce,1,0,"tr",43)(14,xe,1,0,"tr",44),a()),t&2){let e=d(2);h("dataSource",e.auditLogs),l(13),h("matHeaderRowDef",e.auditColumns),l(),h("matRowDefColumns",e.auditColumns)}}function he(t,r){if(t&1){let e=g();i(0,"button",51),u("click",function(){f(e);let c=d(3);return C(c.editSubmission())}),i(1,"mat-icon"),o(2,"edit"),a(),o(3," Edit Submission "),a()}}function be(t,r){if(t&1&&(i(0,"button",50)(1,"mat-icon"),o(2,"approval"),a(),o(3," Review & Approve "),a()),t&2){let e=d(3);h("routerLink",V(1,Ht,e.instance.id))}}function ve(t,r){if(t&1&&(i(0,"div",26),m(1,he,4,0,"button",49)(2,be,4,3,"button",50),a()),t&2){let e=d(2);l(),p(e.canEdit?1:-1),l(),p(e.canTakeAction?2:-1)}}function Se(t,r){if(t&1){let e=g();i(0,"div",4)(1,"button",5),u("click",function(){f(e);let c=d();return C(c.goBack())}),i(2,"mat-icon"),o(3,"arrow_back"),a()(),i(4,"div",6)(5,"h1"),o(6),a(),i(7,"p",7),o(8),a()(),i(9,"span",8),o(10),a(),i(11,"button",9)(12,"mat-icon"),o(13,"more_vert"),a()(),i(14,"mat-menu",10,0),m(16,Ut,5,0,"button",11)(17,Gt,5,0,"button",11)(18,Kt,5,0,"button",11),i(19,"button",12),u("click",function(){f(e);let c=d();return C(c.printSubmission())}),i(20,"mat-icon"),o(21,"print"),a(),i(22,"span"),o(23,"Print"),a()(),i(24,"button",12),u("click",function(){f(e);let c=d();return C(c.copyReferenceNumber())}),i(25,"mat-icon"),o(26,"content_copy"),a(),i(27,"span"),o(28,"Copy Reference"),a()()()(),i(29,"mat-tab-group")(30,"mat-tab",13)(31,"div",14)(32,"div",15)(33,"mat-card",16)(34,"mat-card-header")(35,"mat-card-title"),o(36,"Submission Info"),a()(),i(37,"mat-card-content")(38,"div",17)(39,"span",18),o(40,"Reference Number"),a(),i(41,"span",19),o(42),a()(),i(43,"div",17)(44,"span",18),o(45,"Submitted By"),a(),i(46,"span",19),o(47),a()(),i(48,"div",17)(49,"span",18),o(50,"Submitted At"),a(),i(51,"span",19),o(52),I(53,"date"),a()(),i(54,"div",17)(55,"span",18),o(56,"Status"),a(),i(57,"span",8),o(58),a()(),m(59,Zt,5,1,"div",17),a()(),i(60,"mat-card",20)(61,"mat-card-header")(62,"mat-card-title"),o(63,"Form Data"),a()(),i(64,"mat-card-content"),E(65,Wt,5,2,"div",17,zt),m(67,Yt,6,1),a()()(),m(68,Jt,8,0,"mat-card"),a()(),i(69,"mat-tab",21)(70,"div",14)(71,"mat-card")(72,"mat-card-content"),m(73,Qt,5,0,"div",22)(74,re,3,0,"div",23),a()()()(),i(75,"mat-tab",24)(76,"div",14)(77,"mat-card")(78,"mat-card-content"),m(79,le,5,0,"div",22)(80,ge,15,3,"table",25),a()()()()(),m(81,ve,3,2,"div",26)}if(t&2){let e=L(15),n=d();l(6),s(n.instance.referenceNumber),l(2),s(n.instance.workflowName),l(),b(n.instance.status.toLowerCase()),l(),s(n.instance.status),l(),h("matMenuTriggerFor",e),l(5),p(n.canEdit?16:-1),l(),p(n.canDelete?17:-1),l(),p(n.canRecall?18:-1),l(24),s(n.instance.referenceNumber),l(5),s(n.instance.initiatorName),l(5),s(y(53,21,n.instance.createdAt,"medium")),l(5),b(n.instance.status.toLowerCase()),l(),s(n.instance.status),l(),p(n.instance.status==="PENDING"?59:-1),l(6),w(n.getFieldValuesArray()),l(2),p(n.instance.comments?67:-1),l(),p(n.instance.attachments&&n.instance.attachments.length>0?68:-1),l(5),p(n.approvalHistory.length===0?73:74),l(6),p(n.auditLogs.length===0?79:80),l(2),p(n.canTakeAction||n.canEdit?81:-1)}}var mn=(()=>{class t{workflowService;settingService;authService;route;router;dialog;snackBar;clipboard;instance=null;approvalHistory=[];auditLogs=[];loading=!0;canTakeAction=!1;canEdit=!1;canDelete=!1;canRecall=!1;currentUserId="";auditColumns=["actionDate","action","userFullName","summary"];getFieldValuesArray(){return this.instance?.fieldValues?Array.isArray(this.instance.fieldValues)?this.instance.fieldValues:Object.entries(this.instance.fieldValues).map(([e,n])=>({fieldName:e,fieldLabel:e,value:n})):[]}constructor(e,n,c,_,Ft,Lt,Nt,Vt){this.workflowService=e,this.settingService=n,this.authService=c,this.route=_,this.router=Ft,this.dialog=Lt,this.snackBar=Nt,this.clipboard=Vt,this.currentUserId=this.authService.currentUser?.userId||""}ngOnInit(){let e=this.route.snapshot.paramMap.get("instanceId");e&&this.loadInstance(e)}loadInstance(e){this.workflowService.getInstance(e).subscribe({next:n=>{this.loading=!1,n.success&&(this.instance=n.data,this.approvalHistory=n.data.approvalHistory||[],this.canTakeAction=n.data.status==="PENDING",this.canEdit=n.data.status==="DRAFT"||n.data.status==="RECALLED",this.canDelete=n.data.status==="DRAFT"||n.data.status==="RECALLED",this.canRecall=n.data.status==="PENDING"&&n.data.initiatorId===this.currentUserId,this.loadAuditLogs(e))},error:()=>{this.loading=!1}})}loadAuditLogs(e){this.settingService.getAuditLogs("WorkflowInstance",e).subscribe(n=>{n.success&&(this.auditLogs=n.data)})}goBack(){this.instance?this.router.navigate(["/workflows",this.instance.workflowCode,"instances"]):this.router.navigate(["/dashboard"])}formatFileSize(e){if(e===0)return"0 Bytes";let n=1024,c=["Bytes","KB","MB","GB"],_=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,_)).toFixed(2))+" "+c[_]}downloadAttachment(e){this.workflowService.downloadAttachment(e.id).subscribe(n=>{let c=window.URL.createObjectURL(n),_=document.createElement("a");_.href=c,_.download=e.originalFileName,_.click(),window.URL.revokeObjectURL(c)})}editSubmission(){this.instance&&this.router.navigate(["/workflows",this.instance.workflowCode,"edit",this.instance.id])}deleteSubmission(){if(!this.instance)return;this.dialog.open(k,{width:"400px",data:{title:"Delete Submission",message:`Are you sure you want to delete submission "${this.instance.referenceNumber}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed().subscribe(n=>{n&&this.instance&&this.workflowService.deleteInstance(this.instance.id).subscribe({next:c=>{c.success&&(this.snackBar.open("Submission deleted successfully","Close",{duration:3e3}),this.router.navigate(["/my-submissions"]))},error:()=>{this.snackBar.open("Failed to delete submission","Close",{duration:3e3})}})})}recallSubmission(){if(!this.instance)return;this.dialog.open(k,{width:"400px",data:{title:"Recall Submission",message:`Are you sure you want to recall submission "${this.instance.referenceNumber}"? This will remove it from the approval queue.`,confirmText:"Recall",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed().subscribe(n=>{n&&this.instance&&this.workflowService.recallInstance(this.instance.id).subscribe({next:c=>{c.success&&(this.snackBar.open("Submission recalled successfully","Close",{duration:3e3}),this.loadInstance(this.instance.id))},error:()=>{this.snackBar.open("Failed to recall submission","Close",{duration:3e3})}})})}printSubmission(){window.print()}copyReferenceNumber(){this.instance&&(this.clipboard.copy(this.instance.referenceNumber),this.snackBar.open("Reference number copied to clipboard","Close",{duration:2e3}))}static \u0275fac=function(n){return new(n||t)(x(xt),x(J),x(Q),x(z),x($),x(ct),x(rt),x(Pt))};static \u0275cmp=A({type:t,selectors:[["app-instance-detail"]],decls:3,vars:1,consts:[["actionsMenu","matMenu"],[1,"instance-detail-container"],[1,"loading"],["diameter","40"],[1,"header"],["mat-icon-button","",3,"click"],[1,"header-info"],[1,"subtitle"],[1,"badge"],["mat-icon-button","",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["label","Details"],[1,"tab-content"],[1,"details-grid"],[1,"info-card"],[1,"info-row"],[1,"label"],[1,"value"],[1,"data-card"],["label","Approval History"],[1,"empty-state"],[1,"timeline"],["label","Audit"],["mat-table","",1,"audit-table",3,"dataSource"],[1,"action-bar"],[1,"attachments-list"],[1,"attachment-item"],[1,"name"],[1,"size"],[1,"timeline-item"],[1,"timeline-marker"],[1,"timeline-content"],[1,"timeline-header"],[1,"timeline-meta"],[1,"timeline-comments"],["matColumnDef","actionDate"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["matColumnDef","userFullName"],["matColumnDef","summary"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],["mat-raised-button","","color","accent"],["mat-raised-button","","color","primary",3,"routerLink"],["mat-raised-button","","color","accent",3,"click"]],template:function(n,c){n&1&&(i(0,"div",1),m(1,$t,2,0,"div",2)(2,Se,82,24),a()),n&2&&(l(),p(c.loading?1:c.instance?2:-1))},dependencies:[H,j,G,U,it,X,et,nt,tt,Ot,kt,Tt,q,Y,W,Z,K,Ct,yt,gt,bt,Et,vt,ht,wt,St,Mt,Dt,It,mt,st,ot,at,ft,_t,pt,ut,dt,lt,Rt],styles:[".instance-detail-container[_ngcontent-%COMP%]{padding:1rem;max-width:1200px;margin:0 auto}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem;position:relative;z-index:1}.header-info[_ngcontent-%COMP%]{flex:1;min-width:0}.header[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]{flex-shrink:0;z-index:2}.header-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.tab-content[_ngcontent-%COMP%]{padding:1rem 0}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #eee}.info-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.info-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#666;font-size:.875rem}.info-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.badge.recalled[_ngcontent-%COMP%]{background:#fce4ec;color:#c2185b}.badge.cancelled[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.badge.on_hold[_ngcontent-%COMP%]{background:#fff8e1;color:#f57f17}.attachments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.attachment-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px}.attachment-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.attachment-item[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{color:#666;font-size:.75rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.timeline[_ngcontent-%COMP%]{padding:1rem 0}.timeline-item[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem 0}.timeline-marker[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#f5f5f5}.timeline-marker.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.timeline-marker.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.timeline-marker.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.timeline-marker.recalled[_ngcontent-%COMP%]{background:#fce4ec;color:#c2185b}.timeline-content[_ngcontent-%COMP%]{flex:1}.timeline-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.timeline-meta[_ngcontent-%COMP%]{font-size:.75rem;color:#666;margin-top:.25rem}.timeline-comments[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem;background:#f5f5f5;border-radius:4px;font-style:italic}.audit-table[_ngcontent-%COMP%]{width:100%}.action-bar[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;padding:1rem 0;margin-top:1rem;border-top:1px solid #eee}"]})}return t})();export{mn as InstanceDetailComponent};
