import{a as E}from"./chunk-KCZEURGJ.js";import{a as I,b as Je,c as y,d as Ue,e as Ke}from"./chunk-SR2TIT5O.js";import"./chunk-F5X5MWHG.js";import{a as qe,b as Ge}from"./chunk-G556JK2P.js";import"./chunk-MS4AQ6UA.js";import{a as ze,b as Qe}from"./chunk-ZCDPLTK7.js";import{d as ee}from"./chunk-C2RIDQE5.js";import{a as ge,b as ke,c as Se,d as Me}from"./chunk-GTA6LP7E.js";import{a as be,b as xe}from"./chunk-RORH5LGT.js";import{c as ve,h as Ie}from"./chunk-K3UXCVE5.js";import{b as ye}from"./chunk-L6PTED5A.js";import"./chunk-NDFZT543.js";import{a as He}from"./chunk-VWSHZ65D.js";import{a as De,b as Pe,c as Fe,d as Re,e as Oe,f as Ae,g as Le,h as Be,i as Ve,j as Ne,k as $e,l as je}from"./chunk-XSCQ4HOZ.js";import{a as We}from"./chunk-3AZ62B2F.js";import"./chunk-2HMVGF7U.js";import{b as Ee,c as Te}from"./chunk-LNAKRYVP.js";import"./chunk-3WEQTSJY.js";import{b as ue,e as fe,i as _e,j as Ce,l as we,m as he}from"./chunk-W7HGFPQV.js";import{d as te,h as ne,l as ie,u as oe}from"./chunk-MFE2U5AV.js";import{a as me,c as de,h as pe}from"./chunk-XRACF4N4.js";import"./chunk-KNH3VKXQ.js";import"./chunk-OWVO723I.js";import{a as K,c as X,d as Y,g as Z}from"./chunk-GMPFJIFP.js";import{l as J,p as U,ta as ae,ua as re,va as le,wa as se,ya as ce}from"./chunk-ZJGSEVKG.js";import{$b as T,Cb as p,Fb as $,Hb as f,Jb as j,Kb as H,Lb as z,Mb as n,Nb as i,Ob as x,Pb as _,Qb as C,Sb as g,Wb as w,X as V,Xb as m,ac as W,bc as D,cb as c,ec as Q,fc as o,gc as M,hb as k,hc as S,i as B,ic as q,jc as P,kc as F,lc as R,oa as h,ob as N,oc as G,pa as b,pc as O,qc as v,rc as A,tc as L,ub as d}from"./chunk-BMOUMNDR.js";var Ze=t=>["/workflows",t,"new"],et=()=>[10,25,50,100],Xe=(t,r)=>["/workflows",t,"instances",r],tt=(t,r)=>["/workflows",t,"edit",r],nt=t=>["/approvals",t];function it(t,r){if(t&1&&(n(0,"mat-option",14),o(1),i()),t&2){let e=r.$implicit;p("value",e),c(),M(e)}}function ot(t,r){t&1&&(n(0,"th",31),o(1,"Reference"),i())}function at(t,r){if(t&1&&(n(0,"td",32)(1,"a",33),o(2),i()()),t&2){let e=r.$implicit,l=m();c(),p("routerLink",v(2,Xe,l.workflowCode,e.id)),c(),S(" ",e.referenceNumber," ")}}function rt(t,r){t&1&&(n(0,"th",31),o(1,"Title"),i())}function lt(t,r){if(t&1&&(n(0,"td",32),o(1),i()),t&2){let e=r.$implicit;c(),M(e.title||"-")}}function st(t,r){t&1&&(n(0,"th",31),o(1,"Submitted By"),i())}function ct(t,r){if(t&1&&(n(0,"td",32),o(1),i()),t&2){let e=r.$implicit;c(),M(e.initiatorName)}}function mt(t,r){t&1&&(n(0,"th",31),o(1,"Status"),i())}function dt(t,r){if(t&1&&(n(0,"td",32)(1,"span",34),o(2),i()()),t&2){let e=r.$implicit;c(),$(e.status.toLowerCase()),c(),S(" ",e.status," ")}}function pt(t,r){t&1&&(n(0,"th",31),o(1,"Current Level"),i())}function ut(t,r){if(t&1&&(x(0,"br"),n(1,"small",35),o(2),i()),t&2){let e=m(2).$implicit;c(2),q("(Approver ",(e.currentApproverOrder||0)+1," of ",e.totalApproversAtLevel,")")}}function ft(t,r){if(t&1&&(o(0),d(1,ut,3,2)),t&2){let e=m().$implicit;S(" Level ",e.currentLevel||e.currentApprovalLevel," "),c(),f(e.totalApproversAtLevel&&e.totalApproversAtLevel>1?1:-1)}}function _t(t,r){t&1&&o(0," - ")}function Ct(t,r){if(t&1&&(n(0,"td",32),d(1,ft,2,2)(2,_t,1,0),i()),t&2){let e=r.$implicit;c(),f(e.status==="PENDING"?1:2)}}function wt(t,r){t&1&&(n(0,"th",31),o(1,"Submitted"),i())}function ht(t,r){if(t&1&&(n(0,"td",32),o(1),A(2,"date"),i()),t&2){let e=r.$implicit;c(),S(" ",L(2,1,e.createdAt,"medium")," ")}}function bt(t,r){t&1&&(n(0,"th",31),o(1,"Last Updated"),i())}function xt(t,r){if(t&1&&(n(0,"td",32),o(1),A(2,"date"),i()),t&2){let e=r.$implicit;c(),S(" ",L(2,1,e.updatedAt,"medium")," ")}}function gt(t,r){t&1&&x(0,"th",36)}function kt(t,r){if(t&1){let e=g();n(0,"button",38)(1,"mat-icon"),o(2,"edit"),i(),n(3,"span"),o(4,"Edit"),i()(),n(5,"button",40),w("click",function(){h(e);let a=m().$implicit,s=m();return b(s.submitForApproval(a))}),n(6,"mat-icon"),o(7,"send"),i(),n(8,"span"),o(9,"Submit for Approval"),i()()}if(t&2){let e=m().$implicit,l=m();p("routerLink",v(1,tt,l.workflowCode,e.id))}}function St(t,r){if(t&1){let e=g();n(0,"button",38)(1,"mat-icon"),o(2,"approval"),i(),n(3,"span"),o(4,"Review"),i()(),n(5,"button",40),w("click",function(){h(e);let a=m().$implicit,s=m();return b(s.recallSubmission(a))}),n(6,"mat-icon"),o(7,"undo"),i(),n(8,"span"),o(9,"Recall"),i()()}if(t&2){let e=m().$implicit;p("routerLink",O(1,nt,e.id))}}function Mt(t,r){if(t&1){let e=g();n(0,"button",40),w("click",function(){h(e);let a=m().$implicit,s=m();return b(s.resubmit(a))}),n(1,"mat-icon"),o(2,"replay"),i(),n(3,"span"),o(4,"Resubmit"),i()()}}function vt(t,r){if(t&1){let e=g();n(0,"button",40),w("click",function(){h(e);let a=m().$implicit,s=m();return b(s.cancelSubmission(a))}),n(1,"mat-icon"),o(2,"cancel"),i(),n(3,"span"),o(4,"Cancel"),i()()}}function It(t,r){if(t&1){let e=g();n(0,"button",42),w("click",function(){h(e);let a=m().$implicit,s=m();return b(s.deleteSubmission(a))}),n(1,"mat-icon",43),o(2,"delete"),i(),n(3,"span"),o(4,"Delete"),i()()}}function yt(t,r){if(t&1){let e=g();n(0,"td",32)(1,"button",37)(2,"mat-icon"),o(3,"more_vert"),i()(),n(4,"mat-menu",null,0)(6,"button",38)(7,"mat-icon"),o(8,"visibility"),i(),n(9,"span"),o(10,"View Details"),i()(),d(11,kt,10,4)(12,St,10,3)(13,Mt,5,0,"button",39),x(14,"mat-divider"),n(15,"button",40),w("click",function(){let a=h(e).$implicit,s=m();return b(s.cloneSubmission(a))}),n(16,"mat-icon"),o(17,"content_copy"),i(),n(18,"span"),o(19,"Duplicate"),i()(),d(20,vt,5,0,"button",39)(21,It,5,0,"button",41),i()()}if(t&2){let e=r.$implicit,l=Q(5),a=m();c(),p("matMenuTriggerFor",l),c(5),p("routerLink",v(7,Xe,a.workflowCode,e.id)),c(5),f(e.status==="DRAFT"?11:-1),c(),f(e.status==="PENDING"?12:-1),c(),f(e.status==="REJECTED"?13:-1),c(7),f(e.status!=="APPROVED"&&e.status!=="REJECTED"?20:-1),c(),f(e.status==="DRAFT"||e.status==="CANCELLED"?21:-1)}}function Et(t,r){t&1&&x(0,"tr",44)}function Tt(t,r){t&1&&x(0,"tr",45)}function Wt(t,r){t&1&&(n(0,"div",29)(1,"mat-icon"),o(2,"inbox"),i(),n(3,"p"),o(4,"No submissions found"),i()())}var hn=(()=>{class t{workflowService;route;router;snackBar;dialog;displayedColumns=["referenceNumber","title","initiatorName","status","currentLevel","createdAt","updatedAt","actions"];dataSource=new je([]);searchTerm="";statusFilter="";workflowCode="";workflowName="";statuses=Object.values(He);destroy$=new B;paginator;sort;constructor(e,l,a,s,u){this.workflowService=e,this.route=l,this.router=a,this.snackBar=s,this.dialog=u}ngOnInit(){this.route.params.pipe(V(this.destroy$)).subscribe(e=>{let l=e.workflowCode||"";(l!==this.workflowCode||!this.workflowCode)&&(this.workflowCode=l,this.searchTerm="",this.statusFilter="",this.loadWorkflow(),this.loadInstances())})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=this.createFilter()}loadWorkflow(){this.workflowService.getWorkflowByCode(this.workflowCode).subscribe(e=>{e.success&&(this.workflowName=e.data.name)})}loadInstances(){this.workflowService.getInstancesByWorkflow(this.workflowCode).subscribe(e=>{e.success&&e.data&&(this.dataSource.data=e.data.content||[])})}createFilter(){return(e,l)=>{let a=(e.referenceNumber||"").toLowerCase(),s=this.searchTerm.toLowerCase(),u=!this.statusFilter||e.status===this.statusFilter,Ye=!s||a.includes(s);return u&&Ye}}applyFilter(){this.dataSource.filter=Date.now().toString()}submitForApproval(e){this.workflowService.submitDraftInstance(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Submitted for approval","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to submit","Close",{duration:3e3})}})}recallSubmission(e){this.dialog.open(E,{data:{title:"Recall Submission",message:`Are you sure you want to recall "${e.referenceNumber}"? This will return it to draft status.`,confirmText:"Recall",cancelText:"Cancel",showReasonInput:!0,reasonLabel:"Reason for recall"}}).afterClosed().subscribe(a=>{a&&this.workflowService.recallInstance(e.id,a.reason).subscribe({next:s=>{s.success&&(this.snackBar.open("Submission recalled","Close",{duration:3e3}),this.loadInstances())},error:s=>{this.snackBar.open(s.error?.message||"Failed to recall","Close",{duration:3e3})}})})}resubmit(e){this.workflowService.resubmitInstance(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Resubmitted for approval","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to resubmit","Close",{duration:3e3})}})}cloneSubmission(e){this.workflowService.cloneInstance(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Submission duplicated","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to duplicate","Close",{duration:3e3})}})}cancelSubmission(e){this.dialog.open(E,{data:{title:"Cancel Submission",message:`Are you sure you want to cancel "${e.referenceNumber}"?`,confirmText:"Cancel Submission",cancelText:"Keep",showReasonInput:!0,reasonLabel:"Reason for cancellation"}}).afterClosed().subscribe(a=>{a&&this.workflowService.cancelInstance(e.id,a.reason).subscribe({next:s=>{s.success&&(this.snackBar.open("Submission cancelled","Close",{duration:3e3}),this.loadInstances())},error:s=>{this.snackBar.open(s.error?.message||"Failed to cancel","Close",{duration:3e3})}})})}deleteSubmission(e){this.dialog.open(E,{data:{title:"Delete Submission",message:`Are you sure you want to delete "${e.referenceNumber}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed().subscribe(a=>{a&&this.workflowService.deleteInstance(e.id).subscribe({next:s=>{s.success&&(this.snackBar.open("Submission deleted","Close",{duration:3e3}),this.loadInstances())},error:s=>{this.snackBar.open(s.error?.message||"Failed to delete","Close",{duration:3e3})}})})}static \u0275fac=function(l){return new(l||t)(k(We),k(K),k(X),k(Ee),k(ve))};static \u0275cmp=N({type:t,selectors:[["app-workflow-instances"]],viewQuery:function(l,a){if(l&1&&(T(I,5),T(y,5)),l&2){let s;W(s=D())&&(a.paginator=s.first),W(s=D())&&(a.sort=s.first)}},decls:61,vars:12,consts:[["menu","matMenu"],[1,"instances-container"],[1,"header"],[1,"header-left"],["mat-icon-button","","routerLink","/dashboard"],[1,"subtitle"],["mat-raised-button","","color","primary",3,"routerLink"],[1,"table-toolbar"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Search by reference number",3,"ngModelChange","keyup","ngModel"],["matPrefix",""],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value"],["mat-table","","matSort","",1,"data-table",3,"dataSource"],["matColumnDef","referenceNumber"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","title"],["matColumnDef","initiatorName"],["matColumnDef","status"],["matColumnDef","currentLevel"],["matColumnDef","createdAt"],["matColumnDef","updatedAt"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"empty-state"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink"],[1,"badge"],[1,"approver-progress"],["mat-header-cell",""],["mat-icon-button","","matTooltip","Actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"routerLink"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"delete-action"],["mat-menu-item","",1,"delete-action",3,"click"],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(l,a){l&1&&(n(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4)(4,"mat-icon"),o(5,"arrow_back"),i()(),n(6,"div")(7,"h1"),o(8),i(),n(9,"p",5),o(10,"All submissions for this workflow"),i()()(),n(11,"button",6)(12,"mat-icon"),o(13,"add"),i(),o(14," New Submission "),i()(),n(15,"mat-card")(16,"mat-card-content")(17,"div",7)(18,"mat-form-field",8)(19,"mat-label"),o(20,"Search"),i(),n(21,"input",9),R("ngModelChange",function(u){return F(a.searchTerm,u)||(a.searchTerm=u),u}),w("keyup",function(){return a.applyFilter()}),i(),n(22,"mat-icon",10),o(23,"search"),i()(),n(24,"mat-form-field",11)(25,"mat-label"),o(26,"Status"),i(),n(27,"mat-select",12),R("ngModelChange",function(u){return F(a.statusFilter,u)||(a.statusFilter=u),u}),w("selectionChange",function(){return a.applyFilter()}),n(28,"mat-option",13),o(29,"All"),i(),H(30,it,2,2,"mat-option",14,j),i()()(),n(32,"table",15),_(33,16),d(34,ot,2,0,"th",17)(35,at,3,5,"td",18),C(),_(36,19),d(37,rt,2,0,"th",17)(38,lt,2,1,"td",18),C(),_(39,20),d(40,st,2,0,"th",17)(41,ct,2,1,"td",18),C(),_(42,21),d(43,mt,2,0,"th",17)(44,dt,3,3,"td",18),C(),_(45,22),d(46,pt,2,0,"th",17)(47,Ct,3,1,"td",18),C(),_(48,23),d(49,wt,2,0,"th",17)(50,ht,3,4,"td",18),C(),_(51,24),d(52,bt,2,0,"th",17)(53,xt,3,4,"td",18),C(),_(54,25),d(55,gt,1,0,"th",26)(56,yt,22,10,"td",18),C(),d(57,Et,1,0,"tr",27)(58,Tt,1,0,"tr",28),i(),d(59,Wt,5,0,"div",29),x(60,"mat-paginator",30),i()()()),l&2&&(c(8),M(a.workflowName),c(3),p("routerLink",O(9,Ze,a.workflowCode)),c(10),P("ngModel",a.searchTerm),c(6),P("ngModel",a.statusFilter),c(3),z(a.statuses),c(2),p("dataSource",a.dataSource),c(25),p("matHeaderRowDef",a.displayedColumns),c(),p("matRowDefColumns",a.displayedColumns),c(),f(a.dataSource.data.length===0?59:-1),c(),p("pageSizeOptions",G(11,et)))},dependencies:[U,J,Z,Y,oe,te,ne,ie,pe,me,de,$e,De,Fe,Le,Re,Pe,Be,Oe,Ae,Ve,Ne,Je,I,Ke,y,Ue,Ce,_e,ue,fe,he,we,Qe,ze,ee,ce,se,le,re,ae,ye,Me,ke,ge,Se,Te,Ie,Ge,qe,xe,be],styles:[".instances-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.table-toolbar[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.search-field[_ngcontent-%COMP%]{flex:1;max-width:400px}.data-table[_ngcontent-%COMP%]{width:100%}.data-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#1976d2;text-decoration:none;font-weight:500}.data-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.draft[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.badge.cancelled[_ngcontent-%COMP%]{background:#fafafa;color:#9e9e9e}.badge.on_hold[_ngcontent-%COMP%]{background:#f3e5f5;color:#7b1fa2}.delete-action[_ngcontent-%COMP%]{color:#c62828}.approver-progress[_ngcontent-%COMP%]{color:#666;font-size:.7rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}"]})}return t})();export{hn as WorkflowInstancesComponent};
