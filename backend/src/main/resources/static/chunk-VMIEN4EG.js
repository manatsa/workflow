import{a as We,b as ze,c as Ue,d as He}from"./chunk-B7KLRJ4Y.js";import"./chunk-MS4AQ6UA.js";import{c as v,d as Ve,e as A,f as Be,g as Fe}from"./chunk-JR55QIKH.js";import{b as Re}from"./chunk-OJT3OVWQ.js";import{a as Ie,b as Oe}from"./chunk-M4AVZ6G2.js";import{c as K}from"./chunk-5I3ZFOT5.js";import{a as re}from"./chunk-3PMLAS3Y.js";import"./chunk-WPDQKNTD.js";import{c as J}from"./chunk-5LBLILVL.js";import{a as _e,b as Ce,c as xe,d as ye,e as Me}from"./chunk-CPENUMIN.js";import"./chunk-LAGNR76Q.js";import{a as he,b as Se,c as Ee,d as we,e as Le,f as be,g as Te,h as ve,i as Ae,j as De,k as Pe,l as ke}from"./chunk-FEDFXP2D.js";import"./chunk-T6FL6ZBG.js";import{a as fe,c as ge,d as ue}from"./chunk-XZVKBWV7.js";import{b as pe,f as se,i as ce}from"./chunk-IGML5J3D.js";import"./chunk-DLMMVLF7.js";import"./chunk-X4PFBHKL.js";import"./chunk-ORAJKTE5.js";import{b as X,f as Y,i as Z,p as ee}from"./chunk-DUSDXFBS.js";import{a as le,c as de,h as me}from"./chunk-PWNKGTLH.js";import"./chunk-PSOPTTCW.js";import"./chunk-NMO4AZKI.js";import{j as $,l as q,m as G,qa as te,ra as ie,sa as ne,ta as ae,va as oe}from"./chunk-A3I6STGM.js";import{$b as B,Ab as _,Cb as U,Db as H,Fb as L,Hb as D,Ib as P,Jb as k,Kb as n,Lb as i,Mb as M,Nb as x,Ob as y,Qb as I,Ub as h,Vb as C,Zb as O,_b as V,bb as r,cc as F,dc as a,ec as s,fc as b,gb as W,gc as j,hc as S,ic as E,jc as w,mc as Q,na as g,nb as z,oa as u,pc as T,rc as N,sc as R,tb as c}from"./chunk-2HR56SRD.js";var je=()=>[25,50,100,200];function Qe(t,l){if(t&1&&a(0),t&2){let e=C();b(" ",e.activeFilterCount," filter(s) active ")}}function Ne(t,l){if(t&1&&(n(0,"mat-option",11),a(1),i()),t&2){let e=l.$implicit;_("value",e),r(),s(e)}}function $e(t,l){if(t&1&&(n(0,"mat-option",11),a(1),i()),t&2){let e=l.$implicit;_("value",e),r(),s(e)}}function qe(t,l){t&1&&(n(0,"th",33),a(1,"Timestamp"),i())}function Ge(t,l){if(t&1&&(n(0,"td",34),a(1),T(2,"date"),i()),t&2){let e=l.$implicit;r(),b(" ",N(2,1,e.createdAt,"medium")," ")}}function Je(t,l){t&1&&(n(0,"th",33),a(1,"User"),i())}function Ke(t,l){if(t&1&&(n(0,"td",34)(1,"div",35)(2,"div",36),a(3),i(),n(4,"span"),a(5),i()()()),t&2){let e=l.$implicit,d=C();r(3),s(d.getInitials(e.performedBy)),r(2),s(e.performedBy)}}function Xe(t,l){t&1&&(n(0,"th",33),a(1,"Action"),i())}function Ye(t,l){if(t&1&&(n(0,"td",34)(1,"span",37),a(2),i()()),t&2){let e=l.$implicit,d=C();r(),H(d.getActionClass(e.action)),r(),s(e.action)}}function Ze(t,l){t&1&&(n(0,"th",33),a(1,"Entity Type"),i())}function et(t,l){if(t&1&&(n(0,"td",34),a(1),i()),t&2){let e=l.$implicit;r(),s(e.entityType)}}function tt(t,l){t&1&&(n(0,"th",38),a(1,"Entity ID"),i())}function it(t,l){if(t&1&&(n(0,"td",34)(1,"span",39),a(2),T(3,"slice"),i()()),t&2){let e=l.$implicit;r(2),b("",R(3,1,e.entityId,0,8),"...")}}function nt(t,l){t&1&&(n(0,"th",38),a(1,"Details"),i())}function at(t,l){if(t&1&&(n(0,"td",34),a(1),T(2,"slice"),i()),t&2){let e=l.$implicit;r(),j(" ",R(2,2,e.details,0,50),"",(e.details==null?null:e.details.length)>50?"...":""," ")}}function ot(t,l){t&1&&(n(0,"th",38),a(1,"IP Address"),i())}function rt(t,l){if(t&1&&(n(0,"td",34),a(1),i()),t&2){let e=l.$implicit;r(),s(e.ipAddress)}}function lt(t,l){t&1&&M(0,"th",38)}function dt(t,l){if(t&1){let e=I();n(0,"td",34)(1,"button",40),h("click",function(){let o=g(e).$implicit,p=C();return u(p.toggleDetails(o))}),n(2,"mat-icon"),a(3),i()()()}if(t&2){let e=l.$implicit,d=C();r(3),s(d.expandedLog===e?"expand_less":"expand_more")}}function mt(t,l){t&1&&M(0,"tr",41)}function pt(t,l){if(t&1&&M(0,"tr",42),t&2){let e=l.$implicit,d=C();U("expanded",d.expandedLog===e)}}function st(t,l){if(t&1&&(n(0,"div",44)(1,"span",45),a(2,"Old Value:"),i(),n(3,"pre",46),a(4),i()()),t&2){let e=C(2);r(4),s(e.expandedLog.oldValue)}}function ct(t,l){if(t&1&&(n(0,"div",44)(1,"span",45),a(2,"New Value:"),i(),n(3,"pre",46),a(4),i()()),t&2){let e=C(2);r(4),s(e.expandedLog.newValue)}}function ft(t,l){if(t&1&&(n(0,"div",31)(1,"h4"),a(2,"Full Details"),i(),n(3,"div",43)(4,"div",44)(5,"span",45),a(6,"Entity Type:"),i(),n(7,"span",46),a(8),i()(),n(9,"div",44)(10,"span",45),a(11,"Entity ID:"),i(),n(12,"span",46),a(13),i()(),n(14,"div",44)(15,"span",45),a(16,"Details:"),i(),n(17,"span",46),a(18),i()(),c(19,st,5,1,"div",44)(20,ct,5,1,"div",44),i()()),t&2){let e=C();r(8),s(e.expandedLog.entityType),r(5),s(e.expandedLog.entityId),r(5),s(e.expandedLog.details),r(),L(e.expandedLog.oldValue?19:-1),r(),L(e.expandedLog.newValue?20:-1)}}var Qt=(()=>{class t{settingService;displayedColumns=["createdAt","performedBy","action","entityType","entityId","details","ipAddress","expand"];dataSource=new ke([]);totalElements=0;pageSize=25;currentPage=0;expandedLog=null;filters={performedBy:"",action:"",entityType:"",fromDate:null,toDate:null};actions=["CREATE","UPDATE","DELETE","LOGIN","LOGOUT","APPROVE","REJECT","ESCALATE","SUBMIT"];entityTypes=["User","Role","Workflow","WorkflowInstance","Setting","SBU"];paginator;sort;constructor(e){this.settingService=e}ngOnInit(){this.loadLogs()}ngAfterViewInit(){this.dataSource.sort=this.sort}get hasFilters(){return!!(this.filters.performedBy||this.filters.action||this.filters.entityType||this.filters.fromDate||this.filters.toDate)}get activeFilterCount(){let e=0;return this.filters.performedBy&&e++,this.filters.action&&e++,this.filters.entityType&&e++,this.filters.fromDate&&e++,this.filters.toDate&&e++,e}loadLogs(){this.settingService.getAuditLogsPaged(this.currentPage,this.pageSize,this.filters).subscribe(e=>{e.success&&(this.dataSource.data=e.data.content,this.totalElements=e.data.totalElements)})}applyFilters(){this.currentPage=0,this.loadLogs()}clearFilters(){this.filters={performedBy:"",action:"",entityType:"",fromDate:null,toDate:null},this.applyFilters()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadLogs()}getInitials(e){return e?e.split(" ").map(d=>d[0]).join("").substring(0,2).toUpperCase():"?"}getActionClass(e){return e.toLowerCase()}toggleDetails(e){this.expandedLog=this.expandedLog===e?null:e}exportLogs(){this.settingService.exportAuditLogs(this.filters).subscribe(e=>{let d=window.URL.createObjectURL(e),o=document.createElement("a");o.href=d,o.download=`audit_logs_${new Date().toISOString().split("T")[0]}.xlsx`,o.click(),window.URL.revokeObjectURL(d)})}static \u0275fac=function(d){return new(d||t)(W(re))};static \u0275cmp=z({type:t,selectors:[["app-audit-log"]],viewQuery:function(d,o){if(d&1&&(O(v,5),O(A,5)),d&2){let p;V(p=B())&&(o.paginator=p.first),V(p=B())&&(o.sort=p.first)}},decls:87,vars:18,consts:[["fromPicker",""],["toPicker",""],[1,"audit-log-container"],[1,"header"],["mat-raised-button","",3,"click"],[1,"filter-panel"],[1,"filter-grid"],["appearance","outline"],["matInput","","placeholder","Search by username",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],[3,"value"],["matInput","",3,"ngModelChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],[1,"filter-actions"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["mat-table","","matSort","",1,"data-table",3,"dataSource"],["matColumnDef","createdAt"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","performedBy"],["matColumnDef","action"],["matColumnDef","entityType"],["matColumnDef","entityId"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","details"],["matColumnDef","ipAddress"],["matColumnDef","expand"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"expanded",4,"matRowDef","matRowDefColumns"],[1,"log-details"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"user-info"],[1,"avatar"],[1,"badge"],["mat-header-cell",""],[1,"entity-id"],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""],[1,"details-content"],[1,"detail-row"],[1,"label"],[1,"value"]],template:function(d,o){if(d&1){let p=I();n(0,"div",2)(1,"div",3)(2,"h1"),a(3,"Audit Logs"),i(),n(4,"button",4),h("click",function(){return g(p),u(o.exportLogs())}),n(5,"mat-icon"),a(6,"download"),i(),a(7," Export "),i()(),n(8,"mat-card")(9,"mat-card-content")(10,"mat-expansion-panel",5)(11,"mat-expansion-panel-header")(12,"mat-panel-title")(13,"mat-icon"),a(14,"filter_list"),i(),a(15," Filters "),i(),n(16,"mat-panel-description"),c(17,Qe,1,1),i()(),n(18,"div",6)(19,"mat-form-field",7)(20,"mat-label"),a(21,"User"),i(),n(22,"input",8),w("ngModelChange",function(m){return g(p),E(o.filters.performedBy,m)||(o.filters.performedBy=m),u(m)}),i()(),n(23,"mat-form-field",7)(24,"mat-label"),a(25,"Action"),i(),n(26,"mat-select",9),w("ngModelChange",function(m){return g(p),E(o.filters.action,m)||(o.filters.action=m),u(m)}),n(27,"mat-option",10),a(28,"All"),i(),P(29,Ne,2,2,"mat-option",11,D),i()(),n(31,"mat-form-field",7)(32,"mat-label"),a(33,"Entity Type"),i(),n(34,"mat-select",9),w("ngModelChange",function(m){return g(p),E(o.filters.entityType,m)||(o.filters.entityType=m),u(m)}),n(35,"mat-option",10),a(36,"All"),i(),P(37,$e,2,2,"mat-option",11,D),i()(),n(39,"mat-form-field",7)(40,"mat-label"),a(41,"From Date"),i(),n(42,"input",12),w("ngModelChange",function(m){return g(p),E(o.filters.fromDate,m)||(o.filters.fromDate=m),u(m)}),i(),M(43,"mat-datepicker-toggle",13)(44,"mat-datepicker",null,0),i(),n(46,"mat-form-field",7)(47,"mat-label"),a(48,"To Date"),i(),n(49,"input",12),w("ngModelChange",function(m){return g(p),E(o.filters.toDate,m)||(o.filters.toDate=m),u(m)}),i(),M(50,"mat-datepicker-toggle",13)(51,"mat-datepicker",null,1),i()(),n(53,"div",14)(54,"button",15),h("click",function(){return g(p),u(o.clearFilters())}),a(55,"Clear"),i(),n(56,"button",16),h("click",function(){return g(p),u(o.applyFilters())}),a(57,"Apply Filters"),i()()(),n(58,"table",17),x(59,18),c(60,qe,2,0,"th",19)(61,Ge,3,4,"td",20),y(),x(62,21),c(63,Je,2,0,"th",19)(64,Ke,6,2,"td",20),y(),x(65,22),c(66,Xe,2,0,"th",19)(67,Ye,3,3,"td",20),y(),x(68,23),c(69,Ze,2,0,"th",19)(70,et,2,1,"td",20),y(),x(71,24),c(72,tt,2,0,"th",25)(73,it,4,5,"td",20),y(),x(74,26),c(75,nt,2,0,"th",25)(76,at,3,6,"td",20),y(),x(77,27),c(78,ot,2,0,"th",25)(79,rt,2,1,"td",20),y(),x(80,28),c(81,lt,1,0,"th",25)(82,dt,4,1,"td",20),y(),c(83,mt,1,0,"tr",29)(84,pt,1,2,"tr",30),i(),c(85,ft,21,5,"div",31),n(86,"mat-paginator",32),h("page",function(m){return g(p),u(o.onPageChange(m))}),i()()()()}if(d&2){let p=F(45),f=F(52);r(17),L(o.hasFilters?17:-1),r(5),S("ngModel",o.filters.performedBy),r(4),S("ngModel",o.filters.action),r(3),k(o.actions),r(5),S("ngModel",o.filters.entityType),r(3),k(o.entityTypes),r(5),_("matDatepicker",p),S("ngModel",o.filters.fromDate),r(),_("for",p),r(6),_("matDatepicker",f),S("ngModel",o.filters.toDate),r(),_("for",f),r(8),_("dataSource",o.dataSource),r(25),_("matHeaderRowDef",o.displayedColumns),r(),_("matRowDefColumns",o.displayedColumns),r(),L(o.expandedLog?85:-1),r(),_("length",o.totalElements)("pageSize",o.pageSize)("pageSizeOptions",Q(17,je))}},dependencies:[G,q,$,ee,X,Y,Z,me,le,de,Pe,he,Ee,Te,we,Se,ve,Le,be,Ae,De,Ve,v,Fe,A,Be,fe,ce,pe,se,ue,ge,Oe,Ie,J,He,We,ze,Ue,K,oe,ae,ne,ie,te,Re,Me,_e,Ce,ye,xe],styles:[".audit-log-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.filter-panel[_ngcontent-%COMP%]{margin-bottom:1rem}.filter-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;padding:1rem 0}.filter-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}.data-table[_ngcontent-%COMP%]{width:100%}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.avatar[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:#1976d2;color:#fff;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:500}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.create[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.update[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.badge.delete[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.login[_ngcontent-%COMP%]{background:#f3e5f5;color:#7b1fa2}.badge.logout[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.badge.approve[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.reject[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.entity-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;background:#f5f5f5;padding:.125rem .25rem;border-radius:2px}.log-details[_ngcontent-%COMP%]{background:#f5f5f5;padding:1rem;margin:.5rem 0;border-radius:4px}.log-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem}.detail-row[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:.5rem}.detail-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;min-width:100px;color:#666}.detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{flex:1}.detail-row[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;word-break:break-all;font-size:.75rem;background:#fff;padding:.5rem;border-radius:4px}tr.expanded[_ngcontent-%COMP%]{background:#e3f2fd}"]})}return t})();export{Qt as AuditLogComponent};
