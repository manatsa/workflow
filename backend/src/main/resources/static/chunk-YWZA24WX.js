import{a as ut,b as Ct}from"./chunk-ABZG7EXB.js";import{b as mt,c as pt,d as _t}from"./chunk-NCIUZOAL.js";import"./chunk-MS4AQ6UA.js";import{a as ct,b as dt}from"./chunk-ZCDPLTK7.js";import{a as gt}from"./chunk-2FXL3LXH.js";import{a as $}from"./chunk-EZFPBO3O.js";import"./chunk-XIC57EJO.js";import{d as I}from"./chunk-C2RIDQE5.js";import{a as lt}from"./chunk-4LJSTQBG.js";import{a as it,b as nt}from"./chunk-RORH5LGT.js";import{h as ot}from"./chunk-K3UXCVE5.js";import{b as rt}from"./chunk-L6PTED5A.js";import"./chunk-NDFZT543.js";import{a as tt,b as et}from"./chunk-D7HGT47B.js";import"./chunk-2HMVGF7U.js";import{b as at,c as st}from"./chunk-LNAKRYVP.js";import"./chunk-3WEQTSJY.js";import{b as K,i as Q,j as X,l as Y,m as Z}from"./chunk-W7HGFPQV.js";import{d as W,h as A,l as j,n as L,u as G}from"./chunk-MFE2U5AV.js";import{a as U,c as H,h as q}from"./chunk-XRACF4N4.js";import"./chunk-KNH3VKXQ.js";import"./chunk-OWVO723I.js";import{p as R,ta as J,u as B,ua as N,wa as z,ya as D}from"./chunk-ZJGSEVKG.js";import{Cb as _,Hb as S,Jb as T,Kb as F,Lb as O,Mb as a,Nb as r,Ob as E,Sb as u,Wb as C,Xb as d,cb as l,ec as V,fc as c,gc as y,hb as b,jc as f,kc as h,lc as x,oa as m,ob as k,oc as M,pa as p,ub as w}from"./chunk-BMOUMNDR.js";var v=()=>({standalone:!0}),ft=(e,s)=>s.category,ht=(e,s)=>s.id,xt=(e,s)=>s.key;function Mt(e,s){e&1&&(a(0,"mat-card")(1,"mat-card-content",7),E(2,"mat-spinner",8),a(3,"p"),c(4,"Loading settings..."),r()()())}function St(e,s){if(e&1){let t=u();a(0,"mat-card")(1,"mat-card-content",9)(2,"mat-icon"),c(3,"error_outline"),r(),a(4,"p"),c(5),r(),a(6,"button",10),C("click",function(){m(t);let n=d();return p(n.loadSettings())}),a(7,"mat-icon"),c(8,"refresh"),r(),c(9," Retry "),r()()()}if(e&2){let t=d();l(5),y(t.error)}}function yt(e,s){e&1&&(a(0,"mat-card")(1,"mat-card-content",11)(2,"mat-icon"),c(3,"settings"),r(),a(4,"p"),c(5,"No settings found."),r(),a(6,"p",12),c(7,"Settings will be automatically created when the system initializes."),r()()())}function vt(e,s){e&1&&E(0,"mat-spinner",21)}function bt(e,s){e&1&&(a(0,"mat-icon"),c(1,"send"),r())}function wt(e,s){if(e&1){let t=u();a(0,"div",17)(1,"mat-form-field",18)(2,"mat-label"),c(3,"Test Email Address"),r(),a(4,"input",19),x("ngModelChange",function(n){m(t);let o=d(3);return h(o.testEmailAddress,n)||(o.testEmailAddress=n),p(n)}),r()(),a(5,"button",20),C("click",function(){m(t);let n=d(3);return p(n.sendTestEmail())}),w(6,vt,1,0,"mat-spinner",21)(7,bt,2,0,"mat-icon"),c(8," Send Test Email "),r()(),E(9,"mat-divider")}if(e&2){let t=d(3);l(4),f("ngModel",t.testEmailAddress),l(),_("disabled",t.sendingTestEmail||!t.testEmailAddress),l(),S(t.sendingTestEmail?6:7)}}function Ft(e,s){if(e&1&&(a(0,"mat-option",29),c(1),r()),e&2){let t=s.$implicit;_("value",t.name),l(),y(t.name)}}function Ot(e,s){if(e&1){let t=u();a(0,"div",15)(1,"h3",22),c(2,"Access Control"),r(),a(3,"div",23)(4,"div",24)(5,"strong"),c(6,"Report Roles"),r(),a(7,"span",25),c(8,"Select roles that can access reports"),r()(),a(9,"div",26)(10,"mat-form-field",27)(11,"mat-label"),c(12,"Select Roles"),r(),a(13,"mat-select",28),x("ngModelChange",function(n){m(t);let o=d(3);return h(o.selectedReportRoles,n)||(o.selectedReportRoles=n),p(n)}),C("selectionChange",function(){m(t);let n=d(3);return p(n.onReportRolesChange())}),F(14,Ft,2,2,"mat-option",29,ht),r()()()(),E(16,"mat-divider"),r()}if(e&2){let t=d(3);l(13),f("ngModel",t.selectedReportRoles),_("ngModelOptions",M(2,v)),l(),O(t.availableRoles)}}function Et(e,s){if(e&1&&(a(0,"span",25),c(1),r()),e&2){let t=d().$implicit;l(),y(t.description)}}function Pt(e,s){if(e&1){let t=u();a(0,"mat-slide-toggle",36),C("change",function(n){m(t);let o=d().$implicit;return p(o.value=n.checked?"true":"false")}),r()}if(e&2){let t=d().$implicit;_("checked",t.value==="true")}}function Tt(e,s){if(e&1){let t=u();a(0,"div",34)(1,"input",37),x("ngModelChange",function(n){m(t);let o=d().$implicit;return h(o.value,n)||(o.value=n),p(n)}),r(),a(2,"input",38),x("ngModelChange",function(n){m(t);let o=d().$implicit;return h(o.value,n)||(o.value=n),p(n)}),r()()}if(e&2){let t=d().$implicit;l(),f("ngModel",t.value),_("ngModelOptions",M(4,v)),l(),f("ngModel",t.value),_("ngModelOptions",M(5,v))}}function kt(e,s){if(e&1){let t=u();a(0,"mat-form-field",35)(1,"input",39),x("ngModelChange",function(n){m(t);let o=d().$implicit;return h(o.value,n)||(o.value=n),p(n)}),r()()}if(e&2){let t=d().$implicit;l(),f("ngModel",t.value),_("ngModelOptions",M(2,v))}}function Vt(e,s){if(e&1){let t=u();a(0,"mat-form-field",35)(1,"input",40),x("ngModelChange",function(n){m(t);let o=d().$implicit;return h(o.value,n)||(o.value=n),p(n)}),r()()}if(e&2){let t=d().$implicit;l(),f("ngModel",t.value),_("ngModelOptions",M(2,v))}}function Rt(e,s){if(e&1&&(a(0,"mat-option",29),c(1),r()),e&2){let t=s.$implicit;_("value",t),l(),y(t)}}function Bt(e,s){if(e&1){let t=u();a(0,"mat-form-field",35)(1,"mat-select",41),x("ngModelChange",function(n){m(t);let o=d().$implicit;return h(o.value,n)||(o.value=n),p(n)}),F(2,Rt,2,2,"mat-option",29,T),r()()}if(e&2){let t=d().$implicit,i=d(4);l(),f("ngModel",t.value),_("ngModelOptions",M(2,v)),l(),O(i.getSelectOptions(t))}}function It(e,s){if(e&1){let t=u();a(0,"mat-form-field",35)(1,"input",42),x("ngModelChange",function(n){m(t);let o=d().$implicit;return h(o.value,n)||(o.value=n),p(n)}),r()()}if(e&2){let t=d().$implicit;l(),f("ngModel",t.value),_("ngModelOptions",M(2,v))}}function Wt(e,s){if(e&1&&(a(0,"div",31)(1,"div",24)(2,"strong"),c(3),r(),w(4,Et,2,1,"span",25),r(),a(5,"div",32),w(6,Pt,1,1,"mat-slide-toggle",33)(7,Tt,3,6,"div",34)(8,kt,2,3,"mat-form-field",35)(9,Vt,2,3,"mat-form-field",35)(10,Bt,4,3,"mat-form-field",35)(11,It,2,3,"mat-form-field",35),r()()),e&2){let t,i=s.$implicit;l(3),y(i.label||i.key),l(),S(i.description?4:-1),l(2),S((t=i.type)==="BOOLEAN"?6:t==="COLOR"?7:t==="NUMBER"?8:t==="PASSWORD"?9:t==="SELECT"?10:11)}}function At(e,s){if(e&1&&(a(0,"div",16)(1,"h3",22),c(2),r(),a(3,"div",30),F(4,Wt,12,3,"div",31,xt),r()()),e&2){let t=s.$implicit;l(2),y(t.category),l(2),O(t.settings)}}function jt(e,s){if(e&1&&(a(0,"mat-tab",13)(1,"div",14),w(2,wt,10,3)(3,Ot,17,3,"div",15),F(4,At,6,1,"div",16,ft),r()()),e&2){let t=s.$implicit,i=d(2);_("label",t),l(2),S(t==="Mail Settings"?2:-1),l(),S(t==="Reporting"?3:-1),l(),O(i.getGroupedSettingsForTab(t))}}function Lt(e,s){if(e&1&&(a(0,"mat-card")(1,"mat-tab-group"),F(2,jt,6,3,"mat-tab",13,T),r()()),e&2){let t=d();l(2),O(t.tabs)}}var he=(()=>{class e{settingService;themeService;importExportService;snackBar;http;settings=[];tabs=[];settingsGrouped={};loading=!0;error=null;testEmailAddress="";sendingTestEmail=!1;availableRoles=[];selectedReportRoles=[];apiUrl="/api";constructor(t,i,n,o,g){this.settingService=t,this.themeService=i,this.importExportService=n,this.snackBar=o,this.http=g}ngOnInit(){this.loadSettings(),this.loadRoles()}loadRoles(){this.http.get(`${this.apiUrl}/roles`).subscribe({next:t=>{t.success&&t.data&&(this.availableRoles=t.data.map(i=>({id:i.id,name:i.name})))}})}initReportRolesFromSettings(){let t=this.settings.find(i=>i.key==="reporting.roles");t&&t.value&&(this.selectedReportRoles=t.value.split(",").map(i=>i.trim()).filter(i=>i.length>0))}onReportRolesChange(){let t=this.settings.find(i=>i.key==="reporting.roles");t&&(t.value=this.selectedReportRoles.join(","))}loadSettings(){this.loading=!0,this.error=null,this.settingService.getSettingsGrouped().subscribe({next:t=>{this.loading=!1,t.success&&t.data?(this.settingsGrouped=t.data,this.tabs=Object.keys(t.data),this.settings=Object.values(t.data).flat(),this.initReportRolesFromSettings()):this.error=t.message||"Failed to load settings"},error:t=>{this.loading=!1,this.error=t.error?.message||"Failed to load settings. Please check your permissions."}})}getSettingsForTab(t){return this.settingsGrouped[t]||[]}getGroupedSettingsForTab(t){let i=this.getSettingsForTab(t);t==="Reporting"&&(i=i.filter(o=>o.key!=="reporting.roles"));let n=new Map;return i.forEach(o=>{let g=o.category||"General";n.has(g)||n.set(g,[]),n.get(g).push(o)}),Array.from(n.entries()).map(([o,g])=>({category:o,settings:g})).sort((o,g)=>o.category.localeCompare(g.category))}getSelectOptions(t){return t.options?t.options.split(",").map(i=>i.trim()).filter(i=>i.length>0):[]}saveAll(){let t=this.settings.map(i=>({id:i.id,key:i.key,value:String(i.value),label:i.label,type:i.type,tab:i.tab,category:i.category}));this.settingService.saveSettings(t).subscribe({next:i=>{i.success&&(this.snackBar.open("Settings saved successfully","Close",{duration:3e3}),this.themeService.refreshTheme())},error:()=>{this.snackBar.open("Failed to save settings","Close",{duration:3e3})}})}sendTestEmail(){if(!this.testEmailAddress){this.snackBar.open("Please enter an email address","Close",{duration:3e3});return}this.sendingTestEmail=!0,this.settingService.sendTestEmail(this.testEmailAddress).subscribe({next:t=>{this.sendingTestEmail=!1,t.success?this.snackBar.open(t.message||"Test email sent successfully!","Close",{duration:5e3}):this.snackBar.open(t.message||"Failed to send test email","Close",{duration:5e3})},error:t=>{this.sendingTestEmail=!1,this.snackBar.open(t.error?.message||"Failed to send test email","Close",{duration:5e3})}})}exportSettingsJson(){this.importExportService.exportSettingsJson().subscribe({next:t=>{this.importExportService.downloadFile(t,"Settings_Export.json"),this.snackBar.open("Settings exported successfully","Close",{duration:3e3})},error:()=>{this.snackBar.open("Failed to export settings","Close",{duration:3e3})}})}importSettingsJson(t){let i=t.target;if(!i.files?.length)return;let n=i.files[0];this.importExportService.importSettingsJson(n).subscribe({next:o=>{o.success?(this.snackBar.open(o.message||"Settings imported successfully","Close",{duration:3e3}),this.loadSettings()):this.snackBar.open(o.message||"Failed to import settings","Close",{duration:3e3}),i.value=""},error:o=>{this.snackBar.open(o.error?.message||"Failed to import settings","Close",{duration:3e3}),i.value=""}})}static \u0275fac=function(i){return new(i||e)(b($),b(lt),b(gt),b(at),b(B))};static \u0275cmp=k({type:e,selectors:[["app-settings"]],decls:23,vars:4,consts:[["jsonFileInput",""],[1,"settings-container"],[1,"header"],[1,"header-actions"],["mat-stroked-button","",3,"click","disabled"],["hidden","","type","file","accept",".json",3,"change"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"loading-state"],["diameter","40"],[1,"error-state"],["mat-raised-button","","color","primary",3,"click"],[1,"empty-state"],[1,"hint"],[3,"label"],[1,"tab-content"],[1,"reporting-section"],[1,"category-section"],[1,"tab-actions"],["appearance","outline",1,"test-email-field"],["matInput","","placeholder","Enter email address",3,"ngModelChange","ngModel"],["mat-raised-button","","color","accent",3,"click","disabled"],["diameter","20"],[1,"category-title"],[1,"setting-item","full-width"],[1,"setting-label"],[1,"description"],[1,"setting-input","roles-select"],["appearance","outline",1,"full-width-field"],["multiple","",3,"ngModelChange","selectionChange","ngModel","ngModelOptions"],[3,"value"],[1,"settings-grid"],[1,"setting-item"],[1,"setting-input"],[3,"checked"],[1,"color-input"],["appearance","outline",1,"compact-field"],[3,"change","checked"],["type","color",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","",1,"color-text",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","type","number",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","type","password",3,"ngModelChange","ngModel","ngModelOptions"],[3,"ngModelChange","ngModel","ngModelOptions"],["matInput","",3,"ngModelChange","ngModel","ngModelOptions"]],template:function(i,n){if(i&1){let o=u();a(0,"div",1)(1,"div",2)(2,"h1"),c(3,"Settings"),r(),a(4,"div",3)(5,"button",4),C("click",function(){m(o);let P=V(10);return p(P.click())}),a(6,"mat-icon"),c(7,"upload"),r(),c(8," Import JSON "),r(),a(9,"input",5,0),C("change",function(P){return m(o),p(n.importSettingsJson(P))}),r(),a(11,"button",4),C("click",function(){return m(o),p(n.exportSettingsJson())}),a(12,"mat-icon"),c(13,"download"),r(),c(14," Export JSON "),r(),a(15,"button",6),C("click",function(){return m(o),p(n.saveAll())}),a(16,"mat-icon"),c(17,"save"),r(),c(18," Save Changes "),r()()(),w(19,Mt,5,0,"mat-card")(20,St,10,1,"mat-card")(21,yt,8,0,"mat-card")(22,Lt,4,0,"mat-card"),r()}i&2&&(l(5),_("disabled",n.loading),l(6),_("disabled",n.loading||n.tabs.length===0),l(4),_("disabled",n.loading||n.tabs.length===0),l(4),S(n.loading?19:n.error?20:n.tabs.length===0?21:22))},dependencies:[R,G,W,L,A,j,q,U,H,_t,mt,pt,X,Q,K,Z,Y,dt,ct,I,Ct,ut,D,z,N,J,st,et,tt,nt,it,ot,rt],styles:[".settings-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.tab-content[_ngcontent-%COMP%]{padding:1rem}.tab-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;margin-bottom:1rem;padding:1rem;background:#f5f5f5;border-radius:8px}.test-email-field[_ngcontent-%COMP%]{flex:1;max-width:400px}.tab-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:56px}.tab-actions[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{display:inline-block;margin-right:8px}.category-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.category-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#1976d2;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:2px solid #e0e0e0}.settings-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}@media (max-width: 1200px){.settings-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.setting-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#fafafa;border-radius:4px;border:1px solid #e0e0e0}.setting-label[_ngcontent-%COMP%]{flex:1;min-width:0;padding-right:1rem}.setting-label[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-size:.875rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.setting-label[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{display:block;font-size:.7rem;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.setting-input[_ngcontent-%COMP%]{flex-shrink:0;width:200px}.compact-field[_ngcontent-%COMP%]{width:100%}.compact-field[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}.color-input[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.color-input[_ngcontent-%COMP%]   input[type=color][_ngcontent-%COMP%]{width:40px;height:36px;border:none;cursor:pointer;border-radius:4px}.color-input[_ngcontent-%COMP%]   .color-text[_ngcontent-%COMP%]{flex:1;font-size:.8rem}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;text-align:center;color:#666}.loading-state[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:1rem;opacity:.5}.error-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#f44336}.error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem}.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:.875rem;opacity:.7;margin-top:.5rem}mat-divider[_ngcontent-%COMP%]{margin:1rem 0}.reporting-section[_ngcontent-%COMP%]{margin-bottom:1rem}.setting-item.full-width[_ngcontent-%COMP%]{grid-column:1/-1;flex-direction:column;align-items:stretch;gap:.5rem}.setting-item.full-width[_ngcontent-%COMP%]   .setting-label[_ngcontent-%COMP%]{padding-right:0}.setting-item.full-width[_ngcontent-%COMP%]   .setting-input[_ngcontent-%COMP%]{width:100%}.roles-select[_ngcontent-%COMP%]{max-width:500px}.full-width-field[_ngcontent-%COMP%]{width:100%}.full-width-field[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}"]})}return e})();export{he as SettingsComponent};
