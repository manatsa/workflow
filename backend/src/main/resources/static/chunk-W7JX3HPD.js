import{c as u}from"./chunk-M6HZK7Y7.js";import{Ba as r,v as l}from"./chunk-37H25STD.js";import{Fa as h,Z as a,a as o,aa as c,fa as n}from"./chunk-UYCZSUYP.js";var d=(()=>{class i{http;router;TOKEN_KEY="auth_token";REFRESH_TOKEN_KEY="refresh_token";USER_KEY="current_user";currentUserSignal=h(null);constructor(t,e){this.http=t,this.router=e,this.loadStoredUser()}get currentUser(){return this.currentUserSignal()}get token(){return localStorage.getItem(this.TOKEN_KEY)}get isAuthenticated(){return!!this.token}login(t){return this.http.post(`${r.apiUrl}/auth/login`,t).pipe(a(e=>{e.success&&e.data&&this.setSession(e.data)}))}logout(){this.http.post(`${r.apiUrl}/auth/logout`,{}).subscribe({complete:()=>this.clearSession()})}refreshToken(){let t=localStorage.getItem(this.REFRESH_TOKEN_KEY);return this.http.post(`${r.apiUrl}/auth/refresh?refreshToken=${t}`,{}).pipe(a(e=>{e.success&&e.data&&this.setSession(e.data)}))}hasRole(t){return this.currentUser?.roles?.includes(t)??!1}hasPrivilege(t){return this.currentUser?.privileges?.includes(t)??!1}hasAnyPrivilege(t){return t.some(e=>this.hasPrivilege(e))}changePassword(t,e,s){return this.http.post(`${r.apiUrl}/password/change`,{currentPassword:t,newPassword:e,confirmPassword:s||e})}forgotPassword(t){return this.http.post(`${r.apiUrl}/password/forgot`,{email:t})}resetPassword(t,e,s){return this.http.post(`${r.apiUrl}/password/reset`,{token:t,newPassword:e,confirmPassword:s||e})}refreshCurrentUser(){this.http.get(`${r.apiUrl}/auth/me`).subscribe({next:t=>{if(t.success&&t.data){let e=this.currentUser;if(e){let s=o(o({},e),t.data);localStorage.setItem(this.USER_KEY,JSON.stringify(s)),this.currentUserSignal.set(s)}}}})}setSession(t){localStorage.setItem(this.TOKEN_KEY,t.token),localStorage.setItem(this.REFRESH_TOKEN_KEY,t.refreshToken),localStorage.setItem(this.USER_KEY,JSON.stringify(t)),this.currentUserSignal.set(t)}clearSession(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSignal.set(null),this.router.navigate(["/login"])}loadStoredUser(){let t=localStorage.getItem(this.USER_KEY);if(t)try{let e=JSON.parse(t);this.currentUserSignal.set(e)}catch{this.clearSession()}}static \u0275fac=function(e){return new(e||i)(n(l),n(u))};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();export{d as a};
