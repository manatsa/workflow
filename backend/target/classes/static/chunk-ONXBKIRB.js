import{a as Ye,b as Ue,c as Je,d as Ke,e as Xe,f as Ze,g as z}from"./chunk-SHMTZN3K.js";import"./chunk-MS4AQ6UA.js";import{a as Z,b as ee,c as H,d as qe,e as q,f as ze,g as Ge}from"./chunk-JR55QIKH.js";import{b as Qe}from"./chunk-OJT3OVWQ.js";import{a as je,b as He}from"./chunk-M4AVZ6G2.js";import{c as pe}from"./chunk-5LBLILVL.js";import"./chunk-CZLTQM4N.js";import{a as be,b as he}from"./chunk-2CETHFK6.js";import{a as xe,b as Se,c as ke,d as Te}from"./chunk-6Y7BGRIJ.js";import"./chunk-LAGNR76Q.js";import{a as Ve}from"./chunk-UAAG5SLX.js";import{a as ve,b as ye,c as Ee,d as De,e as Oe,f as Re,g as Pe,h as We,i as Le,j as Fe,k as Ae,l as Be}from"./chunk-FEDFXP2D.js";import{a as Ie}from"./chunk-W77BPQM7.js";import"./chunk-T6FL6ZBG.js";import{a as Ne,b as $e}from"./chunk-AIS23OW2.js";import{a as N,c as $,d as j}from"./chunk-XZVKBWV7.js";import{b as B,e as Me,i as V}from"./chunk-IGML5J3D.js";import"./chunk-DLMMVLF7.js";import"./chunk-X4PFBHKL.js";import"./chunk-ORAJKTE5.js";import{b as O,f as R,i as P,n as ue,p as W}from"./chunk-DUSDXFBS.js";import{a as Ce,c as ge,h as we}from"./chunk-PWNKGTLH.js";import"./chunk-PSOPTTCW.js";import"./chunk-NMO4AZKI.js";import{a as se,c as me,d as ce,g as de}from"./chunk-JQUVUDJB.js";import{j as le,m as D,qa as fe,ra as L,sa as _e,ta as F,va as A}from"./chunk-A3I6STGM.js";import{$b as U,Ab as p,Db as te,Fb as _,Hb as ne,Ib as ie,Jb as oe,Kb as i,Lb as o,Mb as k,Nb as h,Ob as x,Qb as M,Ub as u,Vb as c,Zb as Q,_b as Y,bb as m,cc as ae,dc as a,ec as S,fc as b,gb as w,hc as T,ic as I,jc as v,mc as re,na as C,nb as y,nc as J,oa as g,oc as E,pc as K,rc as X,tb as d}from"./chunk-2HR56SRD.js";function mt(t,s){if(t&1){let e=M();i(0,"mat-form-field",1)(1,"mat-label"),a(2),o(),i(3,"textarea",5),v("ngModelChange",function(n){C(e);let l=c();return I(l.reason,n)||(l.reason=n),g(n)}),o()()}if(t&2){let e,r=c();m(2),S(r.data.reasonLabel||"Reason"),m(),T("ngModel",r.reason),p("required",(e=r.data.reasonRequired)!==null&&e!==void 0?e:!1)}}var G=(()=>{class t{dialogRef;data;reason="";constructor(e,r){this.dialogRef=e,this.data=r}onCancel(){this.dialogRef.close(null)}onConfirm(){this.dialogRef.close({confirmed:!0,reason:this.reason})}static \u0275fac=function(r){return new(r||t)(w(Ye),w(Ue))};static \u0275cmp=y({type:t,selectors:[["app-confirm-dialog"]],decls:11,vars:7,consts:[["mat-dialog-title",""],["appearance","outline",1,"full-width"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","",3,"click","color","disabled"],["matInput","","rows","3",3,"ngModelChange","ngModel","required"]],template:function(r,n){r&1&&(i(0,"h2",0),a(1),o(),i(2,"mat-dialog-content")(3,"p"),a(4),o(),d(5,mt,4,3,"mat-form-field",1),o(),i(6,"mat-dialog-actions",2)(7,"button",3),u("click",function(){return n.onCancel()}),a(8),o(),i(9,"button",4),u("click",function(){return n.onConfirm()}),a(10),o()()),r&2&&(m(),S(n.data.title),m(3),S(n.data.message),m(),_(n.data.showReasonInput?5:-1),m(3),b(" ",n.data.cancelText||"Cancel"," "),m(),p("color",n.data.confirmColor||"primary")("disabled",n.data.reasonRequired&&!n.reason),m(),b(" ",n.data.confirmText||"Confirm"," "))},dependencies:[D,W,O,R,ue,P,z,Ke,Ze,Xe,A,F,L,N,V,B,j,$],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-top:1rem}mat-dialog-content[_ngcontent-%COMP%]{min-width:300px}mat-dialog-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#000000b3}"]})}return t})();var ct=t=>["/workflows",t,"new"],dt=()=>[10,25,50,100],et=(t,s)=>["/workflows",t,"instances",s],pt=(t,s)=>["/workflows",t,"edit",s],ut=t=>["/approvals",t];function ft(t,s){if(t&1&&(i(0,"mat-option",14),a(1),o()),t&2){let e=s.$implicit;p("value",e),m(),S(e)}}function _t(t,s){t&1&&(i(0,"th",30),a(1,"Reference"),o())}function Ct(t,s){if(t&1&&(i(0,"td",31)(1,"a",32),a(2),o()()),t&2){let e=s.$implicit,r=c();m(),p("routerLink",E(2,et,r.workflowCode,e.id)),m(),b(" ",e.referenceNumber," ")}}function gt(t,s){t&1&&(i(0,"th",30),a(1,"Submitted By"),o())}function wt(t,s){if(t&1&&(i(0,"td",31),a(1),o()),t&2){let e=s.$implicit;m(),S(e.initiatorName)}}function Mt(t,s){t&1&&(i(0,"th",30),a(1,"Status"),o())}function bt(t,s){if(t&1&&(i(0,"td",31)(1,"span",33),a(2),o()()),t&2){let e=s.$implicit;m(),te(e.status.toLowerCase()),m(),b(" ",e.status," ")}}function ht(t,s){t&1&&(i(0,"th",30),a(1,"Current Level"),o())}function xt(t,s){if(t&1&&a(0),t&2){let e=c().$implicit;b(" Level ",e.currentApprovalLevel," ")}}function St(t,s){t&1&&a(0," - ")}function kt(t,s){if(t&1&&(i(0,"td",31),d(1,xt,1,1)(2,St,1,0),o()),t&2){let e=s.$implicit;m(),_(e.status==="PENDING"?1:2)}}function Tt(t,s){t&1&&(i(0,"th",30),a(1,"Submitted"),o())}function It(t,s){if(t&1&&(i(0,"td",31),a(1),K(2,"date"),o()),t&2){let e=s.$implicit;m(),b(" ",X(2,1,e.createdAt,"medium")," ")}}function vt(t,s){t&1&&(i(0,"th",30),a(1,"Last Updated"),o())}function yt(t,s){if(t&1&&(i(0,"td",31),a(1),K(2,"date"),o()),t&2){let e=s.$implicit;m(),b(" ",X(2,1,e.updatedAt,"medium")," ")}}function Et(t,s){t&1&&k(0,"th",34)}function Dt(t,s){if(t&1){let e=M();i(0,"button",36)(1,"mat-icon"),a(2,"edit"),o(),i(3,"span"),a(4,"Edit"),o()(),i(5,"button",38),u("click",function(){C(e);let n=c().$implicit,l=c();return g(l.submitForApproval(n))}),i(6,"mat-icon"),a(7,"send"),o(),i(8,"span"),a(9,"Submit for Approval"),o()()}if(t&2){let e=c().$implicit,r=c();p("routerLink",E(1,pt,r.workflowCode,e.id))}}function Ot(t,s){if(t&1){let e=M();i(0,"button",36)(1,"mat-icon"),a(2,"approval"),o(),i(3,"span"),a(4,"Review"),o()(),i(5,"button",38),u("click",function(){C(e);let n=c().$implicit,l=c();return g(l.recallSubmission(n))}),i(6,"mat-icon"),a(7,"undo"),o(),i(8,"span"),a(9,"Recall"),o()()}if(t&2){let e=c().$implicit;p("routerLink",J(1,ut,e.id))}}function Rt(t,s){if(t&1){let e=M();i(0,"button",38),u("click",function(){C(e);let n=c().$implicit,l=c();return g(l.resubmit(n))}),i(1,"mat-icon"),a(2,"replay"),o(),i(3,"span"),a(4,"Resubmit"),o()()}}function Pt(t,s){if(t&1){let e=M();i(0,"button",38),u("click",function(){C(e);let n=c().$implicit,l=c();return g(l.cancelSubmission(n))}),i(1,"mat-icon"),a(2,"cancel"),o(),i(3,"span"),a(4,"Cancel"),o()()}}function Wt(t,s){if(t&1){let e=M();i(0,"button",40),u("click",function(){C(e);let n=c().$implicit,l=c();return g(l.deleteSubmission(n))}),i(1,"mat-icon",41),a(2,"delete"),o(),i(3,"span"),a(4,"Delete"),o()()}}function Lt(t,s){if(t&1){let e=M();i(0,"td",31)(1,"button",35)(2,"mat-icon"),a(3,"more_vert"),o()(),i(4,"mat-menu",null,0)(6,"button",36)(7,"mat-icon"),a(8,"visibility"),o(),i(9,"span"),a(10,"View Details"),o()(),d(11,Dt,10,4)(12,Ot,10,3)(13,Rt,5,0,"button",37),k(14,"mat-divider"),i(15,"button",38),u("click",function(){let n=C(e).$implicit,l=c();return g(l.cloneSubmission(n))}),i(16,"mat-icon"),a(17,"content_copy"),o(),i(18,"span"),a(19,"Duplicate"),o()(),d(20,Pt,5,0,"button",37)(21,Wt,5,0,"button",39),o()()}if(t&2){let e=s.$implicit,r=ae(5),n=c();m(),p("matMenuTriggerFor",r),m(5),p("routerLink",E(7,et,n.workflowCode,e.id)),m(5),_(e.status==="DRAFT"?11:-1),m(),_(e.status==="PENDING"?12:-1),m(),_(e.status==="REJECTED"?13:-1),m(7),_(e.status!=="APPROVED"&&e.status!=="REJECTED"?20:-1),m(),_(e.status==="DRAFT"||e.status==="CANCELLED"?21:-1)}}function Ft(t,s){t&1&&k(0,"tr",42)}function At(t,s){t&1&&k(0,"tr",43)}function Bt(t,s){t&1&&(i(0,"div",28)(1,"mat-icon"),a(2,"inbox"),o(),i(3,"p"),a(4,"No submissions found"),o()())}var Fn=(()=>{class t{workflowService;route;router;snackBar;dialog;displayedColumns=["referenceNumber","initiatorName","status","currentLevel","createdAt","updatedAt","actions"];dataSource=new Be([]);searchTerm="";statusFilter="";workflowCode="";workflowName="";statuses=Object.values(Ve);paginator;sort;constructor(e,r,n,l,f){this.workflowService=e,this.route=r,this.router=n,this.snackBar=l,this.dialog=f}ngOnInit(){this.workflowCode=this.route.snapshot.paramMap.get("workflowCode")||"",this.loadWorkflow(),this.loadInstances()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=this.createFilter()}loadWorkflow(){this.workflowService.getWorkflowByCode(this.workflowCode).subscribe(e=>{e.success&&(this.workflowName=e.data.name)})}loadInstances(){this.workflowService.getInstancesByWorkflow(this.workflowCode).subscribe(e=>{e.success&&e.data&&(this.dataSource.data=e.data.content||[])})}createFilter(){return(e,r)=>{let n=(e.referenceNumber||"").toLowerCase(),l=this.searchTerm.toLowerCase(),f=!this.statusFilter||e.status===this.statusFilter,tt=!l||n.includes(l);return f&&tt}}applyFilter(){this.dataSource.filter=Date.now().toString()}submitForApproval(e){this.workflowService.submitDraftInstance(e.id).subscribe({next:r=>{r.success&&(this.snackBar.open("Submitted for approval","Close",{duration:3e3}),this.loadInstances())},error:r=>{this.snackBar.open(r.error?.message||"Failed to submit","Close",{duration:3e3})}})}recallSubmission(e){this.dialog.open(G,{data:{title:"Recall Submission",message:`Are you sure you want to recall "${e.referenceNumber}"? This will return it to draft status.`,confirmText:"Recall",cancelText:"Cancel",showReasonInput:!0,reasonLabel:"Reason for recall"}}).afterClosed().subscribe(n=>{n&&this.workflowService.recallInstance(e.id,n.reason).subscribe({next:l=>{l.success&&(this.snackBar.open("Submission recalled","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to recall","Close",{duration:3e3})}})})}resubmit(e){this.workflowService.resubmitInstance(e.id).subscribe({next:r=>{r.success&&(this.snackBar.open("Resubmitted for approval","Close",{duration:3e3}),this.loadInstances())},error:r=>{this.snackBar.open(r.error?.message||"Failed to resubmit","Close",{duration:3e3})}})}cloneSubmission(e){this.workflowService.cloneInstance(e.id).subscribe({next:r=>{r.success&&(this.snackBar.open("Submission duplicated","Close",{duration:3e3}),this.loadInstances())},error:r=>{this.snackBar.open(r.error?.message||"Failed to duplicate","Close",{duration:3e3})}})}cancelSubmission(e){this.dialog.open(G,{data:{title:"Cancel Submission",message:`Are you sure you want to cancel "${e.referenceNumber}"?`,confirmText:"Cancel Submission",cancelText:"Keep",showReasonInput:!0,reasonLabel:"Reason for cancellation"}}).afterClosed().subscribe(n=>{n&&this.workflowService.cancelInstance(e.id,n.reason).subscribe({next:l=>{l.success&&(this.snackBar.open("Submission cancelled","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to cancel","Close",{duration:3e3})}})})}deleteSubmission(e){this.dialog.open(G,{data:{title:"Delete Submission",message:`Are you sure you want to delete "${e.referenceNumber}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"warn"}}).afterClosed().subscribe(n=>{n&&this.workflowService.deleteInstance(e.id).subscribe({next:l=>{l.success&&(this.snackBar.open("Submission deleted","Close",{duration:3e3}),this.loadInstances())},error:l=>{this.snackBar.open(l.error?.message||"Failed to delete","Close",{duration:3e3})}})})}static \u0275fac=function(r){return new(r||t)(w(Ie),w(se),w(me),w(Ne),w(Je))};static \u0275cmp=y({type:t,selectors:[["app-workflow-instances"]],viewQuery:function(r,n){if(r&1&&(Q(H,5),Q(q,5)),r&2){let l;Y(l=U())&&(n.paginator=l.first),Y(l=U())&&(n.sort=l.first)}},decls:58,vars:12,consts:[["menu","matMenu"],[1,"instances-container"],[1,"header"],[1,"header-left"],["mat-icon-button","","routerLink","/dashboard"],[1,"subtitle"],["mat-raised-button","","color","primary",3,"routerLink"],[1,"table-toolbar"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Search by reference number",3,"ngModelChange","keyup","ngModel"],["matPrefix",""],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],["value",""],[3,"value"],["mat-table","","matSort","",1,"data-table",3,"dataSource"],["matColumnDef","referenceNumber"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","initiatorName"],["matColumnDef","status"],["matColumnDef","currentLevel"],["matColumnDef","createdAt"],["matColumnDef","updatedAt"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"empty-state"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"routerLink"],[1,"badge"],["mat-header-cell",""],["mat-icon-button","","matTooltip","Actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"routerLink"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"delete-action"],["mat-menu-item","",1,"delete-action",3,"click"],["color","warn"],["mat-header-row",""],["mat-row",""]],template:function(r,n){r&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4)(4,"mat-icon"),a(5,"arrow_back"),o()(),i(6,"div")(7,"h1"),a(8),o(),i(9,"p",5),a(10,"All submissions for this workflow"),o()()(),i(11,"button",6)(12,"mat-icon"),a(13,"add"),o(),a(14," New Submission "),o()(),i(15,"mat-card")(16,"mat-card-content")(17,"div",7)(18,"mat-form-field",8)(19,"mat-label"),a(20,"Search"),o(),i(21,"input",9),v("ngModelChange",function(f){return I(n.searchTerm,f)||(n.searchTerm=f),f}),u("keyup",function(){return n.applyFilter()}),o(),i(22,"mat-icon",10),a(23,"search"),o()(),i(24,"mat-form-field",11)(25,"mat-label"),a(26,"Status"),o(),i(27,"mat-select",12),v("ngModelChange",function(f){return I(n.statusFilter,f)||(n.statusFilter=f),f}),u("selectionChange",function(){return n.applyFilter()}),i(28,"mat-option",13),a(29,"All"),o(),ie(30,ft,2,2,"mat-option",14,ne),o()()(),i(32,"table",15),h(33,16),d(34,_t,2,0,"th",17)(35,Ct,3,5,"td",18),x(),h(36,19),d(37,gt,2,0,"th",17)(38,wt,2,1,"td",18),x(),h(39,20),d(40,Mt,2,0,"th",17)(41,bt,3,3,"td",18),x(),h(42,21),d(43,ht,2,0,"th",17)(44,kt,3,1,"td",18),x(),h(45,22),d(46,Tt,2,0,"th",17)(47,It,3,4,"td",18),x(),h(48,23),d(49,vt,2,0,"th",17)(50,yt,3,4,"td",18),x(),h(51,24),d(52,Et,1,0,"th",25)(53,Lt,22,10,"td",18),x(),d(54,Ft,1,0,"tr",26)(55,At,1,0,"tr",27),o(),d(56,Bt,5,0,"div",28),k(57,"mat-paginator",29),o()()()),r&2&&(m(8),S(n.workflowName),m(3),p("routerLink",J(9,ct,n.workflowCode)),m(10),T("ngModel",n.searchTerm),m(6),T("ngModel",n.statusFilter),m(3),oe(n.statuses),m(2),p("dataSource",n.dataSource),m(22),p("matHeaderRowDef",n.displayedColumns),m(),p("matRowDefColumns",n.displayedColumns),m(),_(n.dataSource.data.length===0?56:-1),m(),p("pageSizeOptions",re(11,dt)))},dependencies:[D,le,de,ce,W,O,R,P,we,Ce,ge,Ae,ve,Ee,Pe,De,ye,We,Oe,Re,Le,Fe,qe,H,Ge,q,ze,N,V,B,Me,j,$,He,je,pe,A,F,_e,L,fe,Qe,Te,Se,xe,ke,$e,z,ee,Z,he,be],styles:[".instances-container[_ngcontent-%COMP%]{padding:1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:#666}.table-toolbar[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.search-field[_ngcontent-%COMP%]{flex:1;max-width:400px}.data-table[_ngcontent-%COMP%]{width:100%}.data-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#1976d2;text-decoration:none;font-weight:500}.data-table[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.badge[_ngcontent-%COMP%]{padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge.pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge.approved[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge.rejected[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge.draft[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.badge.escalated[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.badge.cancelled[_ngcontent-%COMP%]{background:#fafafa;color:#9e9e9e}.badge.on_hold[_ngcontent-%COMP%]{background:#f3e5f5;color:#7b1fa2}.delete-action[_ngcontent-%COMP%]{color:#c62828}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}"]})}return t})();export{Fn as WorkflowInstancesComponent};
